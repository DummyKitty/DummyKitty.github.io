<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>ä»£ç å®¡è®¡å·¥å…· Semgrep - DumKiy's blog</title>

<meta name="description" content="æ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼šè½»é‡çº§ä»£ç å®¡è®¡å·¥å…·: Semgrep - å…ˆçŸ¥ç¤¾åŒºSemgrep ä»‹ç»ä»€ä¹ˆæ˜¯ Semgrepï¼Ÿ  Semgrep æ˜¯ä¸€ä¸ªå¼€æºçš„é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜å’Œå®‰å…¨ä¸“å®¶å‘ç°å’Œä¿®å¤è½¯ä»¶ä»£ç ä¸­çš„å®‰å…¨æ¼æ´ã€ä»£ç è´¨é‡é—®é¢˜å’Œæœ€ä½³å®è·µè¿è§„ç­‰ã€‚Semgrep æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Pythonã€...">
<link rel="canonical" href="http://localhost:4000/code%20audit/2023/07/11/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7-Semgrep.html"><link rel="alternate" type="application/rss+xml" title="DumKiy's blog" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3,h4'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root">
<div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner">
<div class="page__header d-print-none">
<header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand">
<?xml version="1.0" standalone="no"?>

<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewbox="0 0 512.000000 512.000000" preserveaspectratio="xMidYMid meet">
<metadata>
Created by potrace 1.14, written by Peter Selinger 2001-2017
</metadata>
<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path d="M825 4372 c-184 -12 -365 -129 -444 -287 -64 -129 -61 -53 -58 -1555
l2 -1365 29 -70 c58 -141 151 -240 280 -299 110 -51 50 -49 1941 -48 1722 0
1772 1 1837 20 183 52 330 209 373 395 13 58 15 235 13 1429 -2 995 -6 1370
-14 1388 -7 14 -20 45 -30 70 -66 161 -226 287 -401 316 -36 6 -3441 12 -3528
6z m3557 -236 c31 -13 70 -34 86 -47 42 -34 92 -113 107 -168 9 -35 11 -365
10 -1376 -1 -1473 4 -1368 -66 -1459 -19 -24 -52 -56 -75 -70 -94 -60 34 -56
-1883 -56 -1617 0 -1762 1 -1807 17 -27 9 -54 21 -61 27 -6 6 -27 22 -47 36
-46 33 -92 112 -104 180 -15 77 -9 2674 5 2716 36 104 126 190 224 212 28 6
684 10 1799 11 l1755 0 57 -23z"></path>
<path d="M1241 3509 c-27 -11 -47 -32 -61 -66 -22 -53 1 -81 409 -489 l395
-394 -395 -394 c-289 -290 -397 -404 -406 -430 -31 -90 68 -165 154 -117 10 5
215 207 455 448 291 291 439 447 443 466 4 15 4 39 0 55 -7 30 -860 893 -907
918 -31 16 -53 17 -87 3z"></path>
<path d="M2551 1809 c-105 -14 -133 -147 -41 -194 44 -23 1336 -23 1380 0 71
37 73 136 4 182 -23 15 -84 16 -662 17 -350 1 -657 -2 -681 -5z"></path>
</g>
</svg>
<a title="Watch And Learn
" href="/">DumKiy's blog</a>
</div>
<button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button>
</div>
<nav class="navigation">
        <ul>
<li class="navigation__item"><a href="/">Home</a></li>
<li class="navigation__item"><a href="/categories.html">Categories</a></li>
<li class="navigation__item"><a href="/tags.html">tags</a></li>
<li class="navigation__item"><a href="/about.html">About</a></li>
<li class="navigation__item"><a href="/Resources.html">Resources</a></li>
<li class="navigation__item"><a href="https://github.com/DummyKitty">GitHub</a></li>
<li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li>
</ul>
      </nav>
</div>
  </header>
</div>
<div class="page__content"><div class="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto">
<!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header">
<header><h1>ä»£ç å®¡è®¡å·¥å…· Semgrep</h1></header><span class="split-space">Â </span>
          <a class="edit-on-github" title="Edit on Github" href="https://github.com/user_name/repo_name/tree/master/_posts/2023-07-11-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7-Semgrep.md">
            <i class="far fa-edit"></i></a>
</div>
<meta itemprop="headline" content="ä»£ç å®¡è®¡å·¥å…· Semgrep">
<div class="article__info clearfix">
      <div class="right-col">
         <ul class="menu"> <span style="font-size: 1.2em;">ğŸ“‚</span><li>
              <a class="button button--secondary button--pill button--sm" href="/categories.html?tag=code+audit">code audit</a>
            </li>
</ul>
      </div>
      <div class="right-col"><ul class="left-col menu"> <span style="font-size: 1.2em;">ğŸ“Œ</span><li>
              <a class="button button--secondary button--pill button--sm" href="/tags.html?tag=%E5%B7%A5%E5%85%B7">å·¥å…·</a>
            </li>
</ul></div>
<ul class="left-col menu"><li>
<i class="far fa-calendar-alt"></i> <span>Jul 11, 2023</span>
            </li></ul>
</div>
<meta itemprop="author" content="DumKiy">
<meta itemprop="datePublished" content="2023-07-11T13:34:21+08:00">
    <meta itemprop="keywords" content="å·¥å…·">
<div class="js-article-content">
<div class="layout--article">
<!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody">
<blockquote>
  <p>æ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼š<a href="https://xz.aliyun.com/t/12696">è½»é‡çº§ä»£ç å®¡è®¡å·¥å…·: Semgrep - å…ˆçŸ¥ç¤¾åŒº</a></p>
</blockquote>

<h1 id="semgrep-ä»‹ç»">Semgrep ä»‹ç»</h1>

<p>ä»€ä¹ˆæ˜¯ Semgrepï¼Ÿ</p>
<blockquote>
  <p>Semgrep æ˜¯ä¸€ä¸ªå¼€æºçš„é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜å’Œå®‰å…¨ä¸“å®¶å‘ç°å’Œä¿®å¤è½¯ä»¶ä»£ç ä¸­çš„å®‰å…¨æ¼æ´ã€ä»£ç è´¨é‡é—®é¢˜å’Œæœ€ä½³å®è·µè¿è§„ç­‰ã€‚Semgrep æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Pythonã€JavaScriptã€Goã€Javaã€PHP ç­‰ã€‚</p>

  <p>ä»¥ä¸‹æ˜¯ Semgrep çš„ä¸€äº›ä¸»è¦ç‰¹ç‚¹å’Œä¼˜åŠ¿ï¼š</p>
  <ol>
    <li>
<strong>æ˜“äºä½¿ç”¨</strong>: Semgrep çš„è¯­æ³•ç®€å•ç›´è§‚ï¼Œä½¿ç”¨ YAML æˆ–è€…çº¯æ–‡æœ¬æ ¼å¼çš„è§„åˆ™å®šä¹‰ï¼Œä½¿å¾—è§„åˆ™ç¼–å†™å’Œç†è§£å˜å¾—å®¹æ˜“ã€‚æ‚¨å¯ä»¥æ ¹æ®ç‰¹å®šçš„éœ€æ±‚ç¼–å†™è‡ªå®šä¹‰è§„åˆ™ï¼Œæˆ–è€…ä½¿ç”¨ç¤¾åŒºç»´æŠ¤çš„è§„åˆ™åº“ã€‚</li>
    <li>
<strong>å¿«é€Ÿæ‰«æ</strong>: Semgrep ä½¿ç”¨é«˜æ•ˆçš„é™æ€åˆ†æç®—æ³•ï¼Œèƒ½å¤Ÿåœ¨å¤§å‹ä»£ç åº“ä¸­è¿›è¡Œå¿«é€Ÿæ‰«æã€‚å®ƒå…·æœ‰å¯æ‰©å±•æ€§ï¼Œé€‚ç”¨äºå°å‹é¡¹ç›®å’Œå¤§å‹ä¼ä¸šåº”ç”¨ç¨‹åºã€‚</li>
    <li>
<strong>å¹¿æ³›çš„è§„åˆ™åº“</strong>: Semgrep æä¾›äº†ä¸€ä¸ªä¸°å¯Œçš„è§„åˆ™åº“ï¼Œæ¶µç›–äº†å®‰å…¨æ¼æ´ã€å¸¸è§çš„ä»£ç é”™è¯¯ã€æœ€ä½³å®è·µå’Œæ€§èƒ½é—®é¢˜ç­‰å¤šä¸ªæ–¹é¢ã€‚æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›è§„åˆ™ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå®šåˆ¶å’Œæ‰©å±•ã€‚</li>
    <li>
<strong>å¤šè¯­è¨€æ”¯æŒ</strong>: Semgrep æ”¯æŒå¤šç§æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ Pythonã€JavaScriptã€Goã€Java ç­‰ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºè·¨å¤šä¸ªæŠ€æœ¯æ ˆçš„å›¢é˜Ÿæˆ–é¡¹ç›®çš„ç†æƒ³é€‰æ‹©ã€‚</li>
    <li>
<strong>é›†æˆå’Œæ‰©å±•æ€§</strong>: Semgrep å¯ä»¥ä¸å„ç§ CI/CD å·¥å…·å’Œä»£ç ç¼–è¾‘å™¨é›†æˆï¼Œä¾‹å¦‚ GitLabã€GitHub Actionsã€Jenkins ç­‰ã€‚æ­¤å¤–ï¼ŒSemgrep è¿˜æä¾›äº† API å’Œ CLI æ¥å£ï¼Œä½¿æ‚¨èƒ½å¤Ÿè½»æ¾é›†æˆåˆ°ç°æœ‰çš„å·¥ä½œæµç¨‹ä¸­ã€‚</li>
    <li>
<strong>å¯å®šåˆ¶æ€§</strong>: Semgrep å…è®¸æ‚¨æ ¹æ®è‡ªå·±çš„éœ€æ±‚åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Semgrep æä¾›çš„ä¸°å¯Œçš„æ¨¡å¼åŒ¹é…è¯­æ³•æ¥ç¼–å†™é€‚åˆç‰¹å®šä»£ç é£æ ¼å’Œè§„èŒƒçš„è§„åˆ™ã€‚</li>
    <li>
<strong>æ´»è·ƒçš„ç¤¾åŒº</strong>: Semgrep æ‹¥æœ‰æ´»è·ƒçš„å¼€æºç¤¾åŒºæ”¯æŒï¼Œç¤¾åŒºç»´æŠ¤äº†å¤§é‡çš„è§„åˆ™åº“ï¼Œå¹¶å®šæœŸæ›´æ–°å’Œæ”¹è¿› Semgrep çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚</li>
  </ol>
</blockquote>

<p>ä»¥ä¸Šä»‹ç»æ¥è‡ªäº ChatGPT <img class="emoji" title=":heart_eyes:" alt=":heart_eyes:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f60d.png" height="20" width="20">ï¼Œæœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯è®²è§£ Semgrep ä½¿ç”¨æ–¹æ³•ä»¥åŠæ³¨æ„äº‹é¡¹ã€‚</p>

<h1 id="semgrep-ç¯å¢ƒæ­å»º">Semgrep ç¯å¢ƒæ­å»º</h1>
<p>Semgrep çš„å®˜æ–¹æ–‡æ¡£æä¾›äº†è¯¦ç»†çš„å®‰è£…æ•™ç¨‹ ã€‚å¯å‚è€ƒ <a href="https://semgrep.dev/docs/getting-started/">Semgrep Privacy Policy - Semgrep</a></p>

<p>å®‰è£… semgrep</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> pip <span class="nb">install </span>semgrep
semgrep <span class="nt">--version</span>
</code></pre></div></div>
<p>æ›´æ–° semgrep</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> semgrep 
</code></pre></div></div>
<h1 id="semgrep-è¯­æ³•æ•™ç¨‹">Semgrep è¯­æ³•æ•™ç¨‹</h1>
<p>Semgrep çš„è¯­æ³•éå¸¸ç®€å•ï¼ŒæŠŠå®˜æ–¹çš„æ•™ç¨‹è¿‡ä¸€éå°±å¯ä»¥å…¥é—¨äº†ï¼Œå­¦ä¹ æˆæœ¬æ¯” CodeQL è¦å°å¾ˆå¤šã€‚</p>
<ul>
  <li><a href="https://semgrep.dev/learn">Learn - Semgrep</a></li>
</ul>

<h1 id="semgrep-ä½¿ç”¨">Semgrep ä½¿ç”¨</h1>

<h2 id="åœ¨ç»ˆç«¯ä½¿ç”¨">åœ¨ç»ˆç«¯ä½¿ç”¨</h2>
<p>ä½¿ç”¨ semgrep å‘½ä»¤è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ â€“help æŸ¥çœ‹ semgrep æ”¯æŒçš„åŠŸèƒ½ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>semgrep <span class="nt">--help</span>
Usage: semgrep <span class="o">[</span>OPTIONS] COMMAND <span class="o">[</span>ARGS]...

  To get started quickly, run <span class="sb">`</span>semgrep scan <span class="nt">--config</span> auto<span class="sb">`</span>

  Run <span class="sb">`</span>semgrep SUBCOMMAND <span class="nt">--help</span><span class="sb">`</span> <span class="k">for </span>more information on each subcommand

  If no subcommand is passed, will run <span class="sb">`</span>scan<span class="sb">`</span> subcommand by default

Options:
  <span class="nt">-h</span>, <span class="nt">--help</span>  Show this message and exit.

Commands:
  ci                   The recommended way to run semgrep <span class="k">in </span>CI
  install-semgrep-pro  Install the Semgrep Pro Engine
  login                Obtain and save credentials <span class="k">for </span>semgrep.dev
  <span class="nb">logout               </span>Remove locally stored credentials to semgrep.dev
  lsp                  <span class="o">[</span>EXPERIMENTAL] Start the Semgrep LSP server
  publish              Upload rule to semgrep.dev
  scan                 Run semgrep rules on files
  shouldafound         Report a <span class="nb">false </span>negative <span class="k">in </span>this project.
</code></pre></div></div>
<p>æ¯ä¸€ç§æ¨¡å¼å¯¹åº”ä¸åŒçš„åŠŸèƒ½ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯ scan åŠŸèƒ½ï¼Œç”¨äºæ‰«ææŒ‡å®šçš„æºç ï¼Œå…¶ä»–åŠŸèƒ½ä¼šåœ¨åç»­è¿›è¡Œä»‹ç»ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>semgrep scan <span class="nt">--help</span>                                                                             
Usage: semgrep scan <span class="o">[</span>OPTIONS] <span class="o">[</span>TARGETS]...

  Run semgrep rules on files

  Searches TARGET paths <span class="k">for </span>matches to rules or patterns. Defaults to searching entire
  current working directory.

  To get started quickly, run

      semgrep <span class="nt">--config</span> auto <span class="nb">.</span>

  This will automatically fetch rules <span class="k">for </span>your project from the Semgrep Registry. NOTE:
  Using <span class="sb">`</span><span class="nt">--config</span> auto<span class="sb">`</span> will log <span class="k">in </span>to the Semgrep Registry with your project URL.

  For more information about Semgrep, go to https://semgrep.dev.

  NOTE: By default, Semgrep will report pseudonymous usage metrics to its server <span class="k">if </span>you
  pull your configuration from the Semgrep registry. To learn more about how and why
  these metrics are collected, please see https://semgrep.dev/docs/metrics. To modify
  this behavior, see the <span class="nt">--metrics</span> option below.

Options:
  <span class="nt">--replacement</span> TEXT              An autofix expression that will be applied to any
                                  matches found with <span class="nt">--pattern</span><span class="nb">.</span> Only valid with a
                                  command-line specified pattern.
...
</code></pre></div></div>

<h3 id="ä½¿ç”¨å®˜æ–¹è§„åˆ™åº“registryè¿›è¡Œæ‰«æ">ä½¿ç”¨å®˜æ–¹è§„åˆ™åº“ï¼ˆRegistryï¼‰è¿›è¡Œæ‰«æ</h3>
<p>å®˜æ–¹ç»´æŠ¤äº†ä¸€ä¸ªè§„åˆ™åº“ï¼ˆRegistryï¼‰ä»¥ä¾¿ç”¨æˆ·æäº¤ã€æŸ¥æ‰¾ä»¥åŠé€‰æ‹©ç‰¹å®šçš„è§„åˆ™å»æ‰«æé¡¹ç›®ï¼š<a href="https://semgrep.dev/explore">Explore - Semgrep</a>ã€‚å…¶ä¸­åŒ…å«äº†ç¤¾åŒºè§„åˆ™ä»¥åŠä¸“ä¸šè§„åˆ™ï¼ˆProï¼‰ï¼Œç¤¾åŒºè§„åˆ™å­˜å‚¨åœ¨ github ä»“åº“ä¸­ <a href="https://github.com/returntocorp/semgrep-rules">returntocorp/semgrep-rules: Semgrep rules registry</a>ã€‚</p>

<p>Registryï¼Œæ ¹æ®å¸¸è§çš„æ‰«æéœ€æ±‚ï¼Œå®šåˆ¶äº†ä¸€äº›æ‰«æé›†åˆï¼Œä¾‹å¦‚ OWASP-TOP-10ã€CWE-TOP-25 ç­‰ã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710050409.png" alt="20230710050409"></p>

<p>æˆ–æ˜¯æ ¹æ®è¯­è¨€è¿›è¡Œåˆ†ç±»ï¼š</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710050628.png" alt="20230710050628"></p>

<p>å‡å¦‚æˆ‘ä»¬éœ€è¦æ‰«æ PHPï¼Œå¯ä»¥åœ¨ Registry ä¸­è¿›è¡Œæœç´¢ï¼ŒæŸ¥æ‰¾ç»“æœåŒ…æ‹¬ PHP ç›¸å…³çš„è§„åˆ™é›†åˆï¼Œä»¥åŠå…¶ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼š</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710050759.png" alt="20230710050759"></p>

<p>å¯ä»¥çœ‹åˆ°å®˜æ–¹ä¸º PHP å½’çº³äº†ä¸‰ä¸ªè§„åˆ™é›†åˆï¼Œåˆ†åˆ«æ˜¯ phpã€php-laravelã€phpcs-security-auditã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>semgrep <span class="nt">--config</span> <span class="s2">"p/phpcs-security-audit"</span> /mnt/share/project/ctf_archives/test/baijiacms
               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2787 files tracked by git with 10 Code rules:
  Scanning 748 files with 10 php rules.
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:03                                                                                                                     
                    
                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 89 Code Findings â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           
    /mnt/share/project/ctf_archives/test/baijiacms/includes/baijiacms/common.inc.php 
       php.lang.security.exec-use.exec-use                          
          Executing non-constant commands. This can lead to <span class="nb">command </span>injection.
          Details: https://sg.run/5Q1j                                        
                                                                              
          654â”† system<span class="o">(</span><span class="s1">'convert'</span>.<span class="nv">$quality_command</span>.<span class="s1">' '</span>.<span class="nv">$file_full_path</span>.<span class="s1">' '</span>.<span class="nv">$file_full_path</span><span class="o">)</span><span class="p">;</span>
            â‹®â”†----------------------------------------
       php.lang.security.weak-crypto.weak-crypto                             
          Detected usage of weak crypto <span class="k">function</span><span class="nb">.</span> Consider using stronger alternatives.
          Details: https://sg.run/KlBn                                                 
                                                                                       
          372â”† <span class="nv">$seed</span> <span class="o">=</span> base_convert<span class="o">(</span>md5<span class="o">(</span>microtime<span class="o">()</span> <span class="nb">.</span> <span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="o">])</span>, 16, <span class="nv">$numeric</span> ? 10 : 35<span class="o">)</span><span class="p">;</span>
            â‹®â”†----------------------------------------
         1049â”† <span class="nv">$package</span><span class="o">[</span><span class="s1">'sign'</span><span class="o">]</span> <span class="o">=</span> strtoupper<span class="o">(</span>md5<span class="o">(</span><span class="nv">$string1</span><span class="o">))</span><span class="p">;</span>
...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Summary â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Some files were skipped or only partially analyzed.
  Partially scanned: 2 files only partially analyzed due to parsing or internal Semgrep errors

Ran 10 rules on 748 files: 89 findings.

A new version of Semgrep is available. See https://semgrep.dev/docs/upgrading
</code></pre></div></div>

<h3 id="ä½¿ç”¨æœ¬åœ°è§„åˆ™åº“è¿›è¡Œæ‰«æ">ä½¿ç”¨æœ¬åœ°è§„åˆ™åº“è¿›è¡Œæ‰«æ</h3>
<p>ç¦»çº¿ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å°† semgrep å®˜æ–¹ç»´æŠ¤çš„ç¤¾åŒºè§„åˆ™åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">--config</code> å‚æ•°æŒ‡å®šè§„åˆ™åº“çš„è·¯å¾„è¿›è¡Œæ‰«æã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>semgrep <span class="nt">--config</span> /mnt/share/Tools/web/code_audit/semgrep-rules/php /mnt/share/project/ctf_archives/test/baijiacms
               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2788 files tracked by git with 57 Code rules:
  Scanning 748 files with 40 php rules.
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:12                                                                                                                     
                
                
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Summary â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Some files were skipped or only partially analyzed.
  Partially scanned: 2 files only partially analyzed due to parsing or internal Semgrep errors
  Scan skipped: 5 files larger than 1.0 MB, 195 files matching .semgrepignore patterns
  For a full list of skipped files, run semgrep with the <span class="nt">--verbose</span> flag.

Ran 57 rules on 748 files: 257 findings.

A new version of Semgrep is available. See https://semgrep.dev/docs/upgrading

</code></pre></div></div>

<p>semgrep æä¾›äº† -o å‚æ•°å¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä½†æ— è®ºæ˜¯å¦åŠ ä¸åŠ  <code class="language-plaintext highlighter-rouge">--force-color / --no-force-color</code> å‚æ•°ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ä¸­çš„å†…å®¹éƒ½ä¼šå¸¦ä¸Šé¢œè‰²å­—ç¬¦ï¼Œå¯¼è‡´åœ¨æ–‡ä»¶ä¸­æŸ¥çœ‹å¹¶ä¸æ–¹ä¾¿ï¼Œç¡®å®æœ‰ç‚¹å‘ï¼Œä½†å€ŸåŠ© sed å¯ä»¥æ¶ˆé™¤è¿™äº›å­—ç¬¦ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep scan <span class="nt">--config</span> /mnt/share/Tools/web/code_audit/semgrep-rules/php /mnt/share/project/ctf_archives/test/baijiacms <span class="nt">--no-force-color</span>  <span class="nt">--dataflow-traces</span> | <span class="nb">sed</span> <span class="s1">'s/\x1B\[[0-9;]*[mK]//g'</span> <span class="o">&gt;</span> result.txt
</code></pre></div></div>

<h2 id="åœ¨-vscode-ä¸­ä½¿ç”¨">åœ¨ vscode ä¸­ä½¿ç”¨</h2>
<p>vscode ä¸­çš„ semgrep æ’ä»¶ä¸»è¦ç”¨äºé…ç½®è§„åˆ™æ–‡ä»¶è·¯å¾„ã€æ’é™¤æ–‡ä»¶ç­‰ï¼Œé…ç½®é¡¹å¦‚ä¸‹ï¼š</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710044056.png" alt="20230710044056"></p>

<p>å…¶ä¸­ configuration å¯ä»¥é…ç½®è§„åˆ™æ–‡ä»¶è·¯å¾„ç”¨äºç¦»çº¿åœºæ™¯ä¸‹çš„æ‰«æï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œ semgrep ä¼šä»å®˜æ–¹ç¤¾åŒºè·å–è§„åˆ™æ–‡ä»¶å†…å®¹ã€‚</p>

<p>é…ç½®å®Œåï¼Œvscode ä¼šæ ¹æ®é…ç½®è§„åˆ™è‡ªåŠ¨æ‰«æå½“å‰ workspaceï¼Œæ‰«æç»“æœä¼šç›´æ¥æ˜¾ç¤ºåœ¨ vscode çš„ problem çª—å£ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ¼æ´ç±»å‹ï¼Œå¯ä»¥åˆ‡æ¢æ ‘è§†å›¾ã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710043746.png" alt="20230710043746"></p>

<p>æ ‘è§†å›¾ä¸‹çš„ç¬¬ä¸€åˆ—æ˜¾ç¤ºäº†åŒ¹é…çš„è§„åˆ™åï¼š</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710044004.png" alt="20230710044004"></p>

<p>å¦‚æœåŒæ—¶å®‰è£…äº†å¯¹åº”è¯­è¨€çš„æ’ä»¶ï¼ŒProblem çª—å£ä¹Ÿä¼šå‡ºç°å…¶ä»–çš„é”™è¯¯ä¿¡æ¯ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡å…³é”®è¯è¿‡æ»¤å‡º semgrep æ¡ç›®ã€‚</p>

<h2 id="åœ¨-semgrep-cloud-platform-scp-ä¸­ä½¿ç”¨">åœ¨ Semgrep Cloud Platform (SCP) ä¸­ä½¿ç”¨</h2>
<p>Semgrep äº‘å¹³å°æä¾›äº†æ‰€æœ‰ semgrep çš„æ”¯æŒï¼Œå…¶è‰¯å¥½çš„æŸ¥è¯¢ä»¥åŠç»“æœå±•ç¤ºåŠŸèƒ½æ˜¯ç»ˆç«¯ä»¥åŠ vscode æ’ä»¶æ‰€ä¸å…·å¤‡çš„ï¼Œç¼ºç‚¹åœ¨äºå¿…é¡»åœ¨çº¿ä½¿ç”¨ã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710223609.png" alt="20230710223609"></p>

<p>äº‘å¹³å°æ”¯æŒ Locally å’Œ CI/CD ä¸¤ç§æ–¹å¼ã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710235200.png" alt="20230710235200"></p>

<p>Locally æ–¹å¼å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œæ‰«æå‘½ä»¤ï¼Œç„¶åå°†ç»“æœå‘é€åˆ°äº‘å¹³å°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ–¹å¼éœ€è¦å…ˆå°†æºç ç›®å½•åˆå§‹åŒ–ä¸ºä¸€ä¸ª git é¡¹ç›®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”æ— æ³•æŒ‡å®šç‰¹å®šçš„æ‰«æè§„åˆ™ï¼Œé»˜è®¤ä½¿ç”¨æ‰€æœ‰çš„è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸€æ¬¡æ‰«æä½¿ç”¨äº†æ‰€æœ‰çš„ 1591 æ¡è§„åˆ™ï¼Œå…¶ä¸­åŒ…å«äº† 513 æ¡ Pro è§„åˆ™ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”€<span class="nv">$ </span>semgrep ci                                                                       

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2763 files tracked by git with 1591 Code rules, 513 Pro rules:
                                                                                                                        
  Language      Rules   Files          Origin      Rules                                                                
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               
  &lt;multilang&gt;      76    7689          Community    1078                                                                
  php              60     748          Pro rules     513                                                                
  js              242     273                                                                                           
  html              1      72                                                                                           
  yaml             27       2                                                                                           
  bash              4       2                                                                                           
  json              4       1                                                                                           
                                                                                                                        
Semgrep Pro Engine may be slower and show different results than Semgrep OSS.
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 100% 0:23:45 
  
  ...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Summary â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Some files were skipped or only partially analyzed.
  Scan was limited to files tracked by git.
  Partially scanned: 8 files only partially analyzed due to parsing or internal Semgrep errors
  Scan skipped: 196 files matching <span class="nt">--exclude</span> patterns, 4 files larger than 1.0 MB
  For a full list of skipped files, run semgrep with the <span class="nt">--verbose</span> flag.

CI scan completed successfully.
  Found 502 findings <span class="o">(</span>0 blocking<span class="o">)</span> from 22014 rules.
  Uploading scan results  
  Finalizing scan                                                                                                                                 
  View results <span class="k">in </span>Semgrep Cloud Platform:
    https://semgrep.dev/orgs/dr34d/findings
    https://semgrep.dev/orgs/dr34d/supply-chain
  No blocking findings so exiting with code 0
</code></pre></div></div>

<p>æ‰«æå®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨äº‘å¹³å°ä¸­æŸ¥çœ‹åˆ°æ‰«æç»“æœï¼š</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230711031208.png" alt="20230711031208"></p>

<p>äº‘å¹³å°ä¸­çš„æŸ¥æ‰¾åŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ã€‚</p>

<h2 id="pro-ç‰ˆæœ¬ä¸ç¤¾åŒºç‰ˆæœ¬">Pro ç‰ˆæœ¬ä¸ç¤¾åŒºç‰ˆæœ¬</h2>
<p>æ ¹æ®å®˜æ–¹å…¬å‘Šï¼š<a href="https://semgrep.dev/blog/2023/unlocking-advanced-security-for-all-with-semgrep?utm_source=product&amp;utm_medium=app&amp;utm_campaign=june6launch#semgrep-code%E2%80%99s-pro-features-for-all">Unlocking advanced security for all: Semgrepâ€™s latest update</a>ï¼Œ Semgrep å®˜æ–¹å°†å¯¹æ‰€æœ‰ç”¨æˆ·å¼€æ”¾å›¢é˜Ÿç‰ˆåŠŸèƒ½ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº† Pro å¼•æ“ã€è§„åˆ™çš„ä½¿ç”¨ã€‚</p>

<blockquote>
  <p>æˆ‘ä»¬è¿˜å°†å…è´¹å‘æ¯ä¸ªç”±æœ€å¤š10ä¸ªæœˆåº¦è´¡çŒ®è€…ç»„æˆçš„å›¢é˜Ÿæä¾› Semgrep Code çš„å›¢é˜Ÿç‰ˆåŠŸèƒ½ï¼ˆè¯·å‚é˜…å¸¸è§é—®é¢˜è§£ç­”ï¼‰ã€‚è¿™åŒ…æ‹¬é€šè¿‡ Pro å¼•æ“è¿›è¡Œé«˜çº§ä»£ç æ‰«æï¼Œè·¨æ–‡ä»¶å’Œå‡½æ•°è¾¹ç•ŒæŸ¥æ‰¾æ¼æ´ï¼Œå¹¶ä½¿ç”¨ç”±æˆ‘ä»¬çš„å®‰å…¨ç ”ç©¶å›¢é˜Ÿç¼–å†™çš„å…·æœ‰é«˜å¯ä¿¡åº¦çš„ Pro è§„åˆ™ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™äº›åŠŸèƒ½å¯¹äºè¿è¡Œç°ä»£å®‰å…¨ç¨‹åºè‡³å…³é‡è¦ã€‚<a href="https://semgrep.dev/orgs/-/settings">ç°åœ¨åœ¨â€œè®¾ç½®â€ä¸­æ‰“å¼€ Pro å¼•æ“ â†’</a></p>

  <p>ä¸ºäº†è®©ä¾›åº”é“¾å’ŒCodeçš„ä¸“ä¸šåŠŸèƒ½å¯¹æ‰€æœ‰äººéƒ½å¯ç”¨ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è´¦æˆ·å‡çº§åˆ°å›¢é˜Ÿç‰ˆï¼Œå¹¶åœç”¨ç¤¾åŒºç‰ˆï¼Œä»¥æ±‚ç®€å•æ˜äº†ã€‚æˆ‘ä»¬è®¤ä¸ºåœ¨ä¸åŒç­‰çº§ä¹‹é—´åˆ’åˆ†åŠŸèƒ½æˆ–ä¿ç•™åŠŸèƒ½æ˜¯ä¸åˆ©çš„ï¼Œå¹¶å¸Œæœ›æ¯ä¸ªç”¨æˆ·ä»ä¸€å¼€å§‹å°±ä½“éªŒåˆ°Semgrepçš„å…¨éƒ¨ä»·å€¼ã€‚æ­¤å¤–ï¼Œä¸ºäº†ä¸æˆ‘ä»¬çš„åˆ›ä¸šè®¡åˆ’ä¸ºå°å›¢é˜Ÿæä¾›çš„å®šä»·ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”å› ä¸ºæˆ‘ä»¬æä¾›æ›´å¤šå…è´¹çš„äº§å“å’ŒåŠŸèƒ½ï¼Œæˆ‘ä»¬è¿˜å°†è´¡çŒ®è€…é™åˆ¶é™ä½åˆ°10ä¸ªï¼ˆä»20ä¸ªï¼‰ã€‚</p>

  <p>å¯¹äºæˆ‘ä»¬ç°æœ‰çš„å›¢é˜Ÿç‰ˆç”¨æˆ·ï¼Œå¦‚æœæ‚¨çš„ä½¿ç”¨é‡åœ¨ä¿®æ”¹åçš„é™åˆ¶èŒƒå›´å†…ï¼Œå¹¶ä¸”å·²ç»ä»˜è´¹ï¼Œæˆ‘ä»¬å°†ä¸æ‚¨è”ç³»è°ƒæ•´è´¦å•ã€‚å¦‚æœæ‚¨è¶…è¿‡äº†æ–°çš„é™åˆ¶ï¼Œæ‚¨å°†æœ‰æ—¶é—´åˆ° 2023 å¹´ 7 æœˆ 31 æ—¥è°ƒæ•´ä½¿ç”¨é‡å’Œ/æˆ–è´­ä¹°é¢å¤–çš„å¸­ä½ã€‚æˆ‘ä»¬å¸Œæœ›ç¡®ä¿æ¯ä¸ªäººè¿‡æ¸¡é¡ºåˆ©ï¼›æ‚¨å¯ä»¥é€šè¿‡å‘é€ç”µå­é‚®ä»¶è‡³ support@semgrep.com å’¨è¯¢æˆ–åé¦ˆé—®é¢˜ï¼Œæˆ–é˜…è¯»æœ‰å…³å®šä»·ã€è®¡è´¹æˆ–ä½¿ç”¨é™åˆ¶çš„æ–‡æ¡£ã€‚</p>
</blockquote>

<h3 id="pro-è§„åˆ™æœ‰ä»€ä¹ˆä¸åŒ">Pro è§„åˆ™æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3>
<p>Pro è§„åˆ™æ˜¯ Semgrep å®˜æ–¹ç»´æŠ¤çš„é«˜å¯ä¿¡åº¦ã€ä¸“ä¸šçš„è§„åˆ™é›†åˆï¼Œä»…åœ¨å›¢é˜Ÿçº§åˆ«åŠä»¥ä¸Šçš„åŠŸèƒ½ä¸­å¯ç”¨ï¼Œç”±äºå®˜æ–¹å·²ç»å¯¹æ‰€æœ‰ç”¨æˆ·å¼€æ”¾çš„å›¢é˜Ÿç‰ˆåŠŸèƒ½ï¼Œæ‰€ä»¥ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p>

<p>ä»¥ php è§„åˆ™é›†åˆä¸ºä¾‹ï¼Œè¯¥è§„åˆ™é›†åˆä¸­æœ‰ 29 æ¡éƒ½æ˜¯ Pro è§„åˆ™ã€‚</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710231558.png" alt="20230710231558"></p>

<p>ä¸ç™»é™†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¯¥è§„åˆ™é›†åˆæ‰«æä¼šæ˜¾ç¤ºä»…æœ‰ 16 æ¡è§„åˆ™ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep scan <span class="nt">--config</span> <span class="s2">"p/php"</span> /mnt/share/project/ctf_archives/test/baijiacms  | <span class="nb">sed</span> <span class="s1">'s/\x1B\[[0-9;]*[mK]//g'</span> <span class="o">&gt;</span> result.txt   
               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2789 files tracked by git with 16 Code rules:
  Scanning 748 files with 16 php rules.
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:00 
</code></pre></div></div>
<p>ç™»é™†ä¹‹åå†è¿›è¡Œæ‰«æå°±å¯ä»¥ä½¿ç”¨æ‰€æœ‰è§„åˆ™äº†ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep scan <span class="nt">--config</span> <span class="s2">"p/php"</span> /mnt/share/project/ctf_archives/test/baijiacms  | <span class="nb">sed</span> <span class="s1">'s/\x1B\[[0-9;]*[mK]//g'</span> <span class="o">&gt;</span> result.txt
               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2789 files tracked by git with 45 Code rules, 29 Pro rules:
  Scanning 748 files with 43 php rules.
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:03
</code></pre></div></div>

<p>å¯¹æ¯”ç¤¾åŒºè§„åˆ™ä¸ Pro è§„åˆ™ä¸­å¯¹å‘½ä»¤æ³¨å…¥çš„åŒ¹é…è§„åˆ™ï¼š</p>

<p>ç¤¾åŒºè§„åˆ™ï¼šexec-use.yamlï¼Œä»…ä»…åªæ˜¯åŒ¹é…éƒ¨åˆ†å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„è°ƒç”¨ï¼Œæ—¢ä¸å…¨é¢ä¹Ÿæ²¡æœ‰ä½¿ç”¨æ±¡ç‚¹åˆ†æã€‚</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">patterns</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">$FUNC(...);</span>
  <span class="pi">-</span> <span class="na">pattern-not</span><span class="pi">:</span> <span class="s">$FUNC('...', ...);</span>
  <span class="pi">-</span> <span class="na">metavariable-regex</span><span class="pi">:</span>
      <span class="na">metavariable</span><span class="pi">:</span> <span class="s">$FUNC</span>
      <span class="na">regex</span><span class="pi">:</span> <span class="s">exec|passthru|proc_open|popen|shell_exec|system|pcntl_exec</span>
</code></pre></div></div>

<p>Pro è§„åˆ™ï¼štainted-command-injectionï¼Œå…¶ä¸­ä½¿ç”¨ pattern-sources åŒ¹é…æ¥è‡ª <code class="language-plaintext highlighter-rouge">$_REQUEST</code> ç­‰è¾“å…¥æºï¼Œ pattern-sinks é…ç½®äº†éƒ¨åˆ†å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä½†ç›¸æ¯”ä¹‹ä¸‹ä¹Ÿå¹¶ä¸æ˜¯ååˆ†å®Œå¤‡ã€‚</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">pattern-sources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">patterns</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">pattern-either</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">$_REQUEST</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">$_GET</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">$_POST</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">$_FILES</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">$_COOKIE</span>
    <span class="na">pattern-sinks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">patterns</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">pattern-either</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">exec(...)</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">system(...)</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">passthru(...)</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">shell_exec(...)</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="pi">|</span>
                  <span class="s">`...`</span>
              <span class="pi">-</span> <span class="na">patterns</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="na">focus-metavariable</span><span class="pi">:</span> <span class="s">$COMMAND</span>
                  <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">proc_open($COMMAND, ...)</span>
              <span class="pi">-</span> <span class="na">patterns</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="na">focus-metavariable</span><span class="pi">:</span> <span class="s">$COMMAND</span>
                  <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">popen($COMMAND, ...)</span>
              <span class="pi">-</span> <span class="na">pattern</span><span class="pi">:</span> <span class="s">pcntl_exec(...)</span>
</code></pre></div></div>

<h3 id="pro-å¼•æ“æœ‰ä»€ä¹ˆä¸åŒ">Pro å¼•æ“æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3>
<p>æƒ³è¦åœ¨äº‘å¹³å°ä¸­ä½¿ç”¨ Pro å¼•æ“ï¼Œéœ€è¦æŒ‰ç…§å¦‚ä¸‹çš„æ­¥éª¤è¿›è¡Œå¼€å¯ï¼š</p>

<p><img src="https://de34dnotespics.oss-cn-beijing.aliyuncs.com/img/20230710225638.png" alt="20230710225638"></p>

<p>æ ¹æ®å¼€å¯çš„æç¤ºï¼ŒPro å¼•æ“å¼•å…¥äº†æ–‡ä»¶é—´åˆ†æå¯ä»¥æ¶ˆé™¤è¯¯æŠ¥ã€å¼•å…¥æ–°çš„ç»“æœï¼Œå¹¶ä¸”å¯ä»¥å¢åŠ æ‰«ææ—¶é—´å’Œå†…å­˜ä½¿ç”¨é‡ã€‚ä½†ä»…åœ¨å®Œæ•´æ‰«ææ—¶å¯ç”¨ï¼Œä¸”ä»…åœ¨ Java å’Œ Javascript æ–‡ä»¶ä¸Šè¿è¡Œï¼Œä½†åœ¨å®é™…æµ‹è¯•æ—¶å‘ç°å…¶ä»–è¯­è¨€ä¹ŸåŒæ ·æœ‰æ•ˆã€‚</p>

<p>ç»ˆç«¯ä¸­ä½¿ç”¨ Pro å¼•æ“éœ€è¦å…ˆè¿›è¡Œç™»é™†ï¼š</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep login
</code></pre></div></div>
<p>æ ¹æ®è¾“å‡ºè®¿é—®å¯¹åº”çš„é“¾æ¥è¿›è¡Œç™»é™†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Login enables additional proprietary Semgrep Registry rules and running custom policies from Semgrep Cloud Platform.
Login at: xxxx
</code></pre></div></div>
<p>ç»ˆç«¯è·å¾— token ä¹‹åï¼Œå°±å¯ä»¥å®‰è£… pro å¼•æ“äº†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep install-semgrep-pro
</code></pre></div></div>

<p>å®‰è£…å®Œåå¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">--pro</code> å‚æ•°è°ƒç”¨ pro å¼•æ“ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep <span class="nt">--pro</span> <span class="nt">--config</span> <span class="s2">"p/default"</span> 
</code></pre></div></div>

<h2 id="pro-è§„åˆ™--pro-å¼•æ“æ‰«æ">Pro è§„åˆ™ + Pro å¼•æ“æ‰«æ</h2>
<p>Pro å¼•æ“å…·å¤‡è·¨æ–‡ä»¶åˆ†æèƒ½åŠ›ï¼ŒPro è§„åˆ™æ›´ä¸ºç²¾å‡†ï¼Œæ‰€ä»¥åŒæ—¶ä½¿ç”¨ Pro å¼•æ“ä¸ Pro è§„åˆ™è¿›è¡Œæ‰«ææ•ˆæœæ˜¯æœ€å¥½çš„ï¼Œå®é™…æµ‹è¯•æ—¶å¯ä»¥å…ˆè¿›è¡Œç™»é™†ï¼Œæ‰«ææ—¶æ·»åŠ  <code class="language-plaintext highlighter-rouge">--pro</code> å‚æ•°ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>semgrep scan <span class="nt">--config</span> <span class="s2">"p/php"</span> /mnt/share/project/ctf_archives/test/baijiacms <span class="nt">--pro</span> 
               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2789 files tracked by git with 45 Code rules, 29 Pro rules:
  Scanning 748 files with 43 php rules.
Semgrep Pro Engine may be slower and show different results than Semgrep OSS.
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:15   
</code></pre></div></div>
<p>æ‰«æåˆ°çš„ç»“æœç¡®å®ç›¸å¯¹æ›´å¤šï¼Œä½†è¾“å‡ºçš„æ ¼å¼ç¡®å®ä¸€è¨€éš¾å°½ï¼Œååˆ†ä¸æ–¹ä¾¿æŸ¥çœ‹ï¼Œè€Œ vscode æ’ä»¶ä¸­ä¹Ÿæ²¡æœ‰å†…ç½® pro å‚æ•°ã€‚ä¸ºäº†è‰¯å¥½çš„å±•ç¤ºæ•ˆæœä¼¼ä¹åªèƒ½é€šè¿‡ Semgrep äº‘å¹³å°äº†ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 16 Code Findings â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                    
    /mnt/share/project/ctf_archives/test/baijiacms/includes/baijiacms/common.inc.php 
       php.lang.security.injection.tainted-filename.tainted-filename
          File name based on user input risks server-side request forgery.    
          Details: https://sg.run/Ayqp                                        
                                                                              
          501â”† <span class="k">if</span><span class="o">(</span>is_uploaded_file<span class="o">(</span><span class="nv">$filename</span><span class="o">))</span> <span class="o">{</span>
    
            Taint comes from:
            597â”† <span class="nv">$filename</span> <span class="o">=</span> random<span class="o">(</span>15<span class="o">)</span> <span class="nb">.</span> <span class="s2">".{</span><span class="nv">$extention</span><span class="s2">}"</span><span class="p">;</span>
            Taint flows through these intermediate variables:
            372â”† <span class="nv">$seed</span> <span class="o">=</span> base_convert<span class="o">(</span>md5<span class="o">(</span>microtime<span class="o">()</span> <span class="nb">.</span> <span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="o">])</span>, 16, <span class="nv">$numeric</span> ? 10 :    
  35<span class="o">)</span><span class="p">;</span>                                                                                                               
            382â”† <span class="nv">$hash</span> .<span class="o">=</span> <span class="nv">$seed</span><span class="o">{</span>mt_rand<span class="o">(</span>0, <span class="nv">$max</span><span class="o">)}</span><span class="p">;</span>
            <span class="k">then </span>reaches:
            372â”† <span class="nv">$seed</span> <span class="o">=</span> base_convert<span class="o">(</span>md5<span class="o">(</span>microtime<span class="o">()</span> <span class="nb">.</span> <span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="o">])</span>, 16, <span class="nv">$numeric</span> ? 10 :    
  35<span class="o">)</span><span class="p">;</span>                                                                                                               
    
            Taint flows through these intermediate variables:
            597â”† <span class="nv">$filename</span> <span class="o">=</span> random<span class="o">(</span>15<span class="o">)</span> <span class="nb">.</span> <span class="s2">".{</span><span class="nv">$extention</span><span class="s2">}"</span><span class="p">;</span>
            602â”† <span class="nv">$file_tmp_name</span> <span class="o">=</span> SYSTEM_WEBROOT <span class="nb">.</span> <span class="nv">$path</span> <span class="nb">.</span> <span class="nv">$extpath</span><span class="nb">.</span> <span class="nv">$filename</span><span class="p">;</span>
    
            This is how taint reaches the sink:
            609â”† <span class="k">return </span>file_save<span class="o">(</span><span class="nv">$file_tmp_name</span>,<span class="nv">$filename</span>,<span class="nv">$extention</span>,<span class="nv">$file_full_path</span>,<span class="nv">$file_relative_path</span><span class="o">)</span><span class="p">;</span>
            Taint flows through these intermediate variables:
            637â”† <span class="k">function                                                                                            
  </span>file_save<span class="o">(</span><span class="nv">$file_tmp_name</span>,<span class="nv">$filename</span>,<span class="nv">$extention</span>,<span class="nv">$file_full_path</span>,<span class="nv">$file_relative_path</span>,<span class="nv">$allownet</span><span class="o">=</span><span class="nb">true</span><span class="o">)</span>        
            <span class="k">then </span>call to:
            642â”† <span class="k">if</span><span class="o">(!</span>file_move<span class="o">(</span><span class="nv">$file_tmp_name</span>, <span class="nv">$file_full_path</span><span class="o">))</span> <span class="o">{</span>
            Taint flows through these intermediate variables:
            499â”† <span class="k">function </span>file_move<span class="o">(</span><span class="nv">$filename</span>, <span class="nv">$dest</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">then </span>reaches:
            501â”† <span class="k">if</span><span class="o">(</span>is_uploaded_file<span class="o">(</span><span class="nv">$filename</span><span class="o">))</span> <span class="o">{</span>
    
            â‹®â”†----------------------------------------
          506â”† <span class="k">return </span>is_file<span class="o">(</span><span class="nv">$dest</span><span class="o">)</span><span class="p">;</span>
    
            Taint comes from:
            581â”† <span class="nv">$filename</span> <span class="o">=</span> random<span class="o">(</span>15<span class="o">)</span> <span class="nb">.</span> <span class="s2">".{</span><span class="nv">$extention</span><span class="s2">}"</span><span class="p">;</span>
            Taint flows through these intermediate variables:
            372â”† <span class="nv">$seed</span> <span class="o">=</span> base_convert<span class="o">(</span>md5<span class="o">(</span>microtime<span class="o">()</span> <span class="nb">.</span> <span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="o">])</span>, 16, <span class="nv">$numeric</span> ? 10 :    
  35<span class="o">)</span><span class="p">;</span>                                                                                                               
            382â”† <span class="nv">$hash</span> .<span class="o">=</span> <span class="nv">$seed</span><span class="o">{</span>mt_rand<span class="o">(</span>0, <span class="nv">$max</span><span class="o">)}</span><span class="p">;</span>
            <span class="k">then </span>reaches:
            372â”† <span class="nv">$seed</span> <span class="o">=</span> base_convert<span class="o">(</span>md5<span class="o">(</span>microtime<span class="o">()</span> <span class="nb">.</span> <span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'DOCUMENT_ROOT'</span><span class="o">])</span>, 16, <span class="nv">$numeric</span> ? 10 :    
  35<span class="o">)</span><span class="p">;</span>                                                                                                               
    
            Taint flows through these intermediate variables:
            581â”† <span class="nv">$filename</span> <span class="o">=</span> random<span class="o">(</span>15<span class="o">)</span> <span class="nb">.</span> <span class="s2">".{</span><span class="nv">$extention</span><span class="s2">}"</span><span class="p">;</span>
            584â”† <span class="nv">$file_full_path</span> <span class="o">=</span> WEB_ROOT <span class="nb">.</span> <span class="nv">$path</span> <span class="nb">.</span> <span class="nv">$extpath</span><span class="nb">.</span> <span class="nv">$filename</span><span class="p">;</span>
    
            This is how taint reaches the sink:
            586â”† <span class="k">return                                                                                              
  </span>file_save<span class="o">(</span><span class="nv">$file</span><span class="o">[</span><span class="s1">'tmp_name'</span><span class="o">]</span>,<span class="nv">$filename</span>,<span class="nv">$extention</span>,<span class="nv">$file_full_path</span>,<span class="nv">$file_relative_path</span><span class="o">)</span><span class="p">;</span>                   
            Taint flows through these intermediate variables:
            637â”† <span class="k">function                                                                                            
  </span>file_save<span class="o">(</span><span class="nv">$file_tmp_name</span>,<span class="nv">$filename</span>,<span class="nv">$extention</span>,<span class="nv">$file_full_path</span>,<span class="nv">$file_relative_path</span>,<span class="nv">$allownet</span><span class="o">=</span><span class="nb">true</span><span class="o">)</span>        
            <span class="k">then </span>call to:
            642â”† <span class="k">if</span><span class="o">(!</span>file_move<span class="o">(</span><span class="nv">$file_tmp_name</span>, <span class="nv">$file_full_path</span><span class="o">))</span> <span class="o">{</span>
            Taint flows through these intermediate variables:
            499â”† <span class="k">function </span>file_move<span class="o">(</span><span class="nv">$filename</span>, <span class="nv">$dest</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">then </span>reaches:
            506â”† <span class="k">return </span>is_file<span class="o">(</span><span class="nv">$dest</span><span class="o">)</span><span class="p">;</span>
            ...
</code></pre></div></div>

<p>åœ¨ç­‰å‡ºçš„æƒ…å†µä¸‹ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">--pro</code> å‚æ•°ï¼Œsemgrep ä¼šæç¤ºè¦æ±‚ç™»é™†åä½¿ç”¨ï¼Œ<strong>ä½†æ‰«ææ—¶é—´ä¸æ‰«æç»“æœä¸ä¸æ·»åŠ  <code class="language-plaintext highlighter-rouge">--pro</code> å‚æ•°æ—¶ä¹Ÿä¸ä¸€æ ·ã€‚</strong>ï¼Œé‡æ–°ç™»é™†ä¹‹åå†æ¬¡æ‰«æï¼Œå‘ç°ç»“æœå±…ç„¶ä¸ä¸ç™»é™†çš„æ—¶å€™ä¸€æ ·ï¼ˆï¼ï¼ï¼Ÿï¼‰</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â””â”€<span class="nv">$ </span>semgrep scan <span class="nt">--config</span> /mnt/share/Tools/web/code_audit/semgrep-rules/php /mnt/share/project/ctf_archives/test/baijiacms <span class="nt">--pro</span> 
               
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 2767 files tracked by git with 57 Code rules:
  Scanning 748 files with 40 php rules.
<span class="o">!!!</span>This is a proprietary extension of semgrep.!!!
<span class="o">!!!</span>You must be logged <span class="k">in </span>to access this extension!!!
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:30 
</code></pre></div></div>
<h1 id="æ³¨æ„éšç§ç­–ç•¥">æ³¨æ„ï¼šéšç§ç­–ç•¥</h1>
<p>æ ¹æ®å®˜æ–¹çš„éšç§ç­–ç•¥ <a href="https://semgrep.dev/docs/metrics/">Semgrep Privacy Policy - Semgrep</a> çš„ç›¸å…³æè¿°ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>semgrep <span class="nt">--config</span><span class="o">=</span>myrule.yaml  <span class="c"># â†’ no metrics (loading rules from local file)</span>
<span class="nv">$ </span>semgrep <span class="nt">--config</span><span class="o">=</span>p/python     <span class="c"># â†’ metrics enabled (fetching Registry)</span>
<span class="nv">$ </span>semgrep login <span class="o">&amp;&amp;</span> semgrep ci   <span class="c"># â†’ metrics enabled (logged in to semgrep.dev)</span>
</code></pre></div></div>
<ol>
  <li>å½“ä»…ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œæœç´¢æ¨¡å¼è¿è¡Œæ—¶ï¼Œå®˜æ–¹ä¸ä¼šæ”¶é›†ç›¸å…³ä¿¡æ¯ã€‚</li>
  <li>å½“ä½¿ç”¨ Registry ä¸­çš„è§„åˆ™æ—¶ï¼Œå®˜æ–¹ä¼šæ”¶é›†æ‰€éœ€æ•°æ®ä»¥å¸®åŠ©ç»´æŠ¤äººå‘˜å®Œå–„è§„åˆ™ã€‚</li>
  <li>å½“ä½¿ç”¨äº‘å¹³å°æ—¶ï¼Œå®˜æ–¹ä¹Ÿä¼šæ”¶é›†è¿™äº›æ•°æ®ï¼Œå¹¶ä¸”å°†ç»“æœå­˜æ”¾åœ¨äº‘å¹³å°ä¸­ã€‚</li>
</ol>

<p>æ”¶é›†æ•°æ®çš„å…·ä½“å†…å®¹å¯è§ï¼š<a href="https://semgrep.dev/docs/metrics/#data-collected-as-metrics">Data collected as metrics</a></p>

<p>ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š <code class="language-plaintext highlighter-rouge">--metrics</code> é€‰é¡¹æ¥æ§åˆ¶æ•°æ®çš„å‘é€ã€‚</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--metrics</span> autoï¼šï¼ˆé»˜è®¤ï¼‰æ¯å½“ä» Semgrep æ³¨å†Œè¡¨ä¸­æå–è§„åˆ™æ—¶éƒ½ä¼šå‘é€
<span class="nt">--metrics</span> onï¼šæ¯æ¬¡ Semgrep è¿è¡Œæ—¶éƒ½ä¼šå‘é€
<span class="nt">--metrics</span> offï¼šæ°¸è¿œä¸ä¼šå‘é€ 
</code></pre></div></div>
<p>å¦‚æœæœ‰éšç§è€ƒè™‘çš„è¯ï¼Œå»ºè®®ç¦»çº¿ä½¿ç”¨è§„åˆ™åº“ï¼Œå¹¶æ·»åŠ  <code class="language-plaintext highlighter-rouge">--metrics off</code> å‚æ•°ã€‚</p>

<h1 id="å…¶ä»–èµ„æº">å…¶ä»–èµ„æº</h1>

<h2 id="åœ¨çº¿æµ‹è¯•">åœ¨çº¿æµ‹è¯•</h2>
<p>å®˜æ–¹æä¾›äº†ä¸€ä¸ª Playground æ¥è¾…åŠ©è§„åˆ™çš„ç¼–å†™</p>
<ul>
  <li><a href="https://semgrep.dev/playground/new">Playground - Semgrep</a></li>
</ul>

<h2 id="ä¸€äº›å¼€æºè§„åˆ™åº“">ä¸€äº›å¼€æºè§„åˆ™åº“</h2>
<p>github ä¸­æœ‰ä¸€äº›å¼€æºå‡ºæ¥çš„è§„åˆ™åº“å¯ä¾›å‚è€ƒã€‚</p>
<ul>
  <li>
<a href="https://github.com/0xdea/semgrep-rules">0xdea/semgrep-rules: A collection of my Semgrep rules to facilitate vulnerability research.</a>: C\C++</li>
  <li><a href="https://github.com/federicodotta/semgrep-rules">federicodotta/semgrep-rules: A collection of my Semgrep rules</a></li>
  <li>
<a href="https://github.com/trailofbits/semgrep-rules">trailofbits/semgrep-rules: Semgrep queries developed by Trail of Bits.</a>: GOã€JavaScriptã€Pythonã€Rs</li>
  <li>
<a href="https://github.com/dgryski/semgrep-go">dgryski/semgrep-go: Go rules for semgrep and go-ruleguard</a>: GO</li>
  <li>
<a href="https://github.com/elttam/semgrep-rules">elttam/semgrep-rules</a>: Cã€C#ã€Javaã€Kotlinã€Pythonã€PHP</li>
  <li><a href="https://github.com/frappe/semgrep-rules">frappe/semgrep-rules: Semgrep rules specific to Frappe Framework</a></li>
  <li>
<a href="https://github.com/Decurity/semgrep-smart-contracts">Decurity/semgrep-smart-contracts: Semgrep rules for smart contracts based on DeFi exploits</a>:Solidity</li>
  <li>
<a href="https://github.com/mindedsecurity/semgrep-rules-android-security">mindedsecurity/semgrep-rules-android-security: A collection of Semgrep rules derived from the OWASP MASTG specifically for Android applications.</a>: Java</li>
  <li>
<a href="https://github.com/vmnguyen/semgrep-rules">vmnguyen/semgrep-rules: My custom semgrep rules</a>ï¼šJavaã€Golangã€Pythonã€Javascript</li>
</ul>

<h1 id="ç»“è¯­">ç»“è¯­</h1>
<p>æœ¬æ–‡å¯¹ semgrep çš„åŸºæœ¬ä½¿ç”¨ä»¥åŠæ³¨æ„äº‹é¡¹è¿›è¡Œäº†ä»‹ç»ï¼Œæœ¬äººä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œå¦‚æœ‰é”™è¯¯è¯·åŠæ—¶æŒ‡å‡ºã€‚ä»ç»“æœæ¥çœ‹ï¼Œsemgrep ä¼˜ç‚¹åœ¨äºè½»é‡çº§ï¼Œæ‰«æé€Ÿåº¦å¿«ã€è§„åˆ™å®šåˆ¶ç®€å•ï¼Œä½†æ±¡ç‚¹åˆ†æèƒ½åŠ›å¹¶ä¸ç®—å¼ºï¼Œå¦‚æœå»å®šåˆ¶ä¸€äº›è§„åˆ™å»åšå±é™©å‡½æ•°åŒ¹é…ï¼Œé…åˆ vscode æ’ä»¶ï¼Œå¯¹ä»£ç å®¡è®¡è¿˜æ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>

<p>ç¼–å†™è§„åˆ™å¦‚æœæƒ³çœäº‹ä¹Ÿå¯ä»¥äº¤ç»™ chatGPT <img class="emoji" title=":heart_eyes:" alt=":heart_eyes:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f60d.png" height="20" width="20"></p>
<blockquote>
  <p>I want you to act as a code audit expert specializing in semgrep rules. Your role will involve helping me understand and utilize semgrep effectively for code review purposes. You should be proficient in semgrepâ€™s syntax, rules, and patterns. Your tasks will include explaining the purpose and functionality of existing semgrep rules, assisting in the interpretation of semgrep scan results, and guiding me in the customization and creation of custom semgrep rules. Your expertise in code auditing and semgrep will be crucial in ensuring the thoroughness and accuracy of our code reviews, helping us identify and address potential security vulnerabilities, bugs, and best practice violations.</p>
</blockquote>

<p>prompt å–è‡ªï¼š<a href="https://github.com/DummyKitty/Cyber-Security-chatGPT-prompt">DummyKitty/Cyber-Security-chatGPT-prompt: some prompt about cyber security</a></p>

<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<ul>
  <li><a href="https://mp.weixin.qq.com/s?__biz=MzIzMjYzNTQwMA==&amp;mid=2247484260&amp;idx=1&amp;sn=d109621cc64576b631642c508537f7ef&amp;chksm=e890ae03dfe7271574b3d929629556ce535b3c725f0067f6b5f76d439dfb3fba5efb4b9a87a4&amp;scene=126&amp;sessionid=1648174256&amp;subscene=207&amp;key=c184f4d6bd516cbc00f9758355bacf18b4b94e6eea2a7952de3fccc8e44cd10a8a9c1762db8b923cd49976f85edd06fd6a0cb9489f007d16ee6ce88970f1be9e9e49b530d4a5b0cab8147199314bd3b3326c3904dff8dfcb97d4d8c1038f563d57bafa3ec4738815a7bcd36bde7433b04553086900c8e5f938840ce3404776b3&amp;ascene=0&amp;uin=NTY2NTA4NjQ%3D&amp;devicetype=Windows+Server+2016+x64&amp;version=6305002e&amp;lang=zh_CN&amp;exportkey=A5im">semgrep åˆ†ælog4j2</a></li>
  <li><a href="http://blog.nsfocus.net/rsa-2023insights/">æ´è§RSA 2023ï¼šå¼€å‘è€…åº”è¯¥çŸ¥é“çš„5ä¸ªå¼€æºå®‰å…¨å·¥å…·</a></li>
  <li><a href="https://www.gushiciku.cn/pl/aRy2">Semgrepä»£ç å®¡è®¡ä½“éªŒ_æ˜å¤©çš„ä¹Œäº‘ - MdEditor</a></li>
  <li><a href="https://semgrep.dev/blog/2023/unlocking-advanced-security-for-all-with-semgrep?utm_source=product&amp;utm_medium=app&amp;utm_campaign=june6launch#semgrep-code%E2%80%99s-pro-features-for-all">ä¸ºæ‰€æœ‰äººè§£é”é«˜çº§å®‰å…¨æ€§ï¼šSemgrep çš„æœ€æ–°æ›´æ–°</a></li>
  <li><a href="https://github.com/ASTTeam/Semgrep">ASTTeam/Semgrep: ã€Šæ·±å…¥ç†è§£Semgrepã€‹Finding vulnerabilities with Semgrep.</a></li>
</ul>
</div>
<section class="article__sharing d-print-none"></section><div class="d-print-none">
<footer class="article__footer"><meta itemprop="dateModified" content="2023-07-11T13:34:21+08:00">
<!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe">
<div class="subscribe">
<i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a>
</div>
</div>
<div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png">
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix">
<div class="previous">
<span>PREVIOUS</span><a href="/java/2023/07/04/Java-JNDI-%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0.html">Java JNDI å®‰å…¨ç¬”è®°</a>
</div>
<div class="next">
<span>NEXT</span><a href="/exchange/2023/07/14/BurpSuite-NTLM-%E6%8A%93%E5%8C%85%E9%97%AE%E9%A2%98.html">BurpSuite NTLM æŠ“åŒ…é—®é¢˜</a>
</div>
</div>
</div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div>
<section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div>
<div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main">
<div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DumKiy">
<meta itemprop="url" content="/">
<meta itemprop="description" content="Watch And Learn.">
<div class="footer__author-links">
<div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/DummyKitty" target="_blank">
          <div class="icon">
<svg fill="#000000" width="24px" height="24px" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z"></path>
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div>
<div class="site-info mt-2">
      <div>Â© DumKiy's blog 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div>
</div>
    </div>
<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal">
<script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text">
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  â¬…, 38  â¬†, 39  â¡, 40  â¬‡
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div>
</div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script>
<script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};_config.TeX = { equationNumbers: { autoNumber: "all" } };MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

