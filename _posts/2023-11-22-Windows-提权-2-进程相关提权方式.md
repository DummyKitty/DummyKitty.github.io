---
title: Windows 提权（二）进程相关提权方式
date: 2023-11-20 05:34:21
categories:
- Pentest
tags:
- windows
- LPE
- Info gathering

toc: true
notshow: true
---

# Windows 本地提权
## 进程相关提权方式
### 哪些进程在运行
```bash
tasklist /v
net start
sc query
Get-Service
Get-Process
Get-WmiObject -Query "Select * from Win32_Process" | where {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | ft -AutoSize
```

### 哪些进程以 system 权限运行
```bash
tasklist /v /fi "username eq system"
```
如果这些进程所在目录，或加载的 dll 所在目录可写的话，可利用 dll 劫持提权。

### Powershell 版本
```bash
REG QUERY "HKLM\SOFTWARE\Microsoft\PowerShell\1\PowerShellEngine" /v PowerShellVersion
```
### 枚举已安装程序
已安装程序可作为提权突破点。
```bash
Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
```

### 枚举已安装服务
```bat
net start
wmic service list brief
tasklist /SVC
```
### 枚举计划任务
```bat
schtasks /query /fo LIST 2>nul | findstr TaskName
schtasks /query /fo LIST /v > schtasks.txt; cat schtask.txt | grep "SYSTEM\|Task To Run" | grep -B 1 SYSTEM
Get-ScheduledTask | where {$_.TaskPath -notlike "\Microsoft*"} | ft TaskName,TaskPath,State
```
### 枚举自启动应用
```bat
wmic startup get caption,command
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\R
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
dir "C:\Documents and Settings\All Users\Start Menu\Programs\Startup"
dir "C:\Documents and Settings\%username%\Start Menu\Programs\Startup"
```
