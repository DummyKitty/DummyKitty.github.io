---
title: CTF Pyjail 沙箱逃逸绕过合集
date: 2023-05-30 10:23:57
categories:
- Python
tags:
- pyjail
toc: true
---

> 文章首发于先知社区：[CTF Pyjail 沙箱逃逸绕过合集 - 先知社区](https://xz.aliyun.com/t/12647)

承接上一篇CTF Pyjail 沙箱逃逸原理合集，本文主要来谈谈绕过手法，Pyjail 绕过过滤的手法千奇百怪, 本文在复现经典历史赛题的基础上，针对不同的沙箱类型对绕过手法进行了分类，篇幅较长敬请理解。
1. 绕过删除模块或方法
2. 绕过基于字符串匹配的过滤
3. 绕过长度限制
4. 绕过命名空间限制
5. 绕过多行限制
6. 变量覆盖与函数篡改
7. 绕过 audit hook
8. 绕过 AST 沙箱

> 原文太长了，为了方便编辑和及时补充，我将各个部分进行了切分。

## 绕过删除模块或方法
[redirect](../../posts/pyjail-bypass-01-绕过删除模块或方法/)

## 绕过基于字符串匹配的过滤

[redirect](../../posts/pyjail-bypass-02-字符串变换绕过/)

## 绕过命名空间限制

[redirect](../../posts/pyjail-bypass-03-绕过命名空间限制/)

## 绕过长度限制

[redirect](../../posts/pyjail-bypass-04-绕过多行限制/)

## 绕过多行限制
[redirect](../../posts/pyjail-bypass-05-绕过长度限制/)

## 变量覆盖与函数篡改

[redirect](../../posts/pyjail-bypass-06-变量覆盖与函数篡改/)

## 绕过 audit hook

[redirect](../../posts/pyjail-bypass-07-绕过-audit-hook/)

## 绕过 AST 沙箱

[redirect](../../posts/pyjail-bypass-08-绕过-AST-沙箱/)

## 其他技巧

### 模拟 no builitins 环境
no builtins 环境和 python 交互式解析器还是有所差异, 但交互式解析器并没有提供指定命名空间的功能,因此可以自己编写一个脚本进行模拟:
```py
def repl():
    global_namespace = {}
    local_namespace = {}

    while True:
        try:
            code = input('>>> ')
            try:
                # Try to eval the code first.
                result = eval(code, global_namespace, local_namespace)
            except SyntaxError:
                # If a SyntaxError occurs, this might be because the user entered a statement,
                # in which case we should use exec.
                exec(code, global_namespace, local_namespace)
            else:
                print(result)
        except EOFError:
            break
        except Exception as e:
            print(f"Error: {e}")

if __name__ == "__main__":
    repl()
```


## 参考资料
- [Python沙箱逃逸小结](https://www.mi1k7ea.com/2019/05/31/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%B0%8F%E7%BB%93/#%E8%BF%87%E6%BB%A4-globals)
- [Python 沙箱逃逸的经验总结](https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#%E5%89%8D%E8%A8%80)
- [Python 沙箱逃逸的通解探索之路](https://www.tr0y.wang/2022/09/28/common-exp-of-python-jail/)
- [python沙箱逃逸学习记录](https://xz.aliyun.com/t/12303#toc-11)
- [Bypass Python sandboxes](https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes)
- [[PyJail] python沙箱逃逸探究·上（HNCTF题解 - WEEK1）](https://zhuanlan.zhihu.com/p/578986988)
- [[PyJail] python沙箱逃逸探究·中（HNCTF题解 - WEEK2）](https://zhuanlan.zhihu.com/p/579057932)
- [[PyJail] python沙箱逃逸探究·下（HNCTF题解 - WEEK3）](https://zhuanlan.zhihu.com/p/579183067)
- [audited2](https://ctftime.org/writeup/31883)
- [【ctf】HNCTF Jail All In One](https://www.woodwhale.top/archives/hnctfj-ail-all-in-one)
- [HAXLAB — Endgame Pwn](https://ctftime.org/writeup/28286)
- [Python沙箱逃逸的n种姿势](https://ctftime.org/writeup/28286)
- [hxp2020-audited](https://pullp.github.io/writeup/2020/12/26/hxp2020-audited.html)